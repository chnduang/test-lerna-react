(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{441:function(n,e,t){"use strict";t.r(e);var r=t(18),a=Object(r.a)({},(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"react-fiberæ¶æ„æµ…æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#react-fiberæ¶æ„æµ…æ"}},[n._v("#")]),n._v(" React-Fiberæ¶æ„æµ…æ")]),n._v(" "),t("blockquote",[t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/UyuJEAPGSm8XKHXvNTdQyw",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://mp.weixin.qq.com/s/UyuJEAPGSm8XKHXvNTdQyw"),t("OutboundLink")],1)])]),n._v(" "),t("h2",{attrs:{id:"_1-æµè§ˆå™¨æ¸²æŸ“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-æµè§ˆå™¨æ¸²æŸ“"}},[n._v("#")]),n._v(" 1.æµè§ˆå™¨æ¸²æŸ“")]),n._v(" "),t("p",[n._v("ä¸ºäº†æ›´å¥½çš„ç†è§£ React Fiber, æˆ‘ä»¬å…ˆç®€å•äº†è§£ä¸‹æ¸²æŸ“å™¨è¿›ç¨‹çš„å†…éƒ¨å·¥ä½œåŸç†ã€‚")]),n._v(" "),t("blockquote",[t("p",[n._v("å‚è€ƒèµ„æ–™:")]),n._v(" "),t("ol",[t("li",[t("strong",[n._v("ä»å†…éƒ¨äº†è§£ç°ä»£æµè§ˆå™¨(3)")]),n._v("[1]")]),n._v(" "),t("li",[t("strong",[n._v("æ¸²æŸ“æ ‘æ„å»ºã€å¸ƒå±€åŠç»˜åˆ¶")]),n._v("[2]")])])]),n._v(" "),t("h3",{attrs:{id:"_1-1-æ¸²æŸ“å¸§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-æ¸²æŸ“å¸§"}},[n._v("#")]),n._v(" 1.1 æ¸²æŸ“å¸§")]),n._v(" "),t("p",[n._v("å¸§ (frame): åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€å¹…é™æ­¢çš„ç”»é¢å«åšå¸§ã€‚")]),n._v(" "),t("p",[n._v("å¸§ç‡ (frame per second): å³æ¯ç§’é’Ÿæ’­æ”¾çš„é™æ­¢ç”»é¢çš„æ•°é‡ã€‚")]),n._v(" "),t("p",[n._v("å¸§æ—¶é•¿ (frame running time): æ¯ä¸€å¹…é™æ­¢çš„ç”»é¢çš„åœç•™æ—¶é—´ã€‚")]),n._v(" "),t("p",[n._v("ä¸¢å¸§ (dropped frame): å½“æŸä¸€å¸§æ—¶é•¿é«˜äºå¹³å‡å¸§æ—¶é•¿ã€‚")]),n._v(" "),t("ul",[t("li",[n._v("ä¸€èˆ¬æ¥è¯´æµè§ˆå™¨åˆ·æ–°ç‡åœ¨60Hz, æ¸²æŸ“ä¸€å¸§æ—¶é•¿å¿…é¡»æ§åˆ¶åœ¨16.67ms (1s / 60 = 16.67ms)ã€‚")]),n._v(" "),t("li",[n._v("å¦‚æœæ¸²æŸ“è¶…è¿‡è¯¥æ—¶é—´, å¯¹ç”¨æˆ·è§†è§‰ä¸Šæ¥è¯´ï¼Œä¼šå‡ºç°å¡é¡¿ç°è±¡ï¼Œå³ä¸¢å¸§ (dropped frame)ã€‚")])]),n._v(" "),t("h3",{attrs:{id:"_1-2-å¸§ç”Ÿå‘½å‘¨æœŸ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-å¸§ç”Ÿå‘½å‘¨æœŸ"}},[n._v("#")]),n._v(" 1.2 å¸§ç”Ÿå‘½å‘¨æœŸ")]),n._v(" "),t("p",[t("img",{attrs:{src:"https://mmbiz.qpic.cn/mmbiz_png/ndgH50E7pIqnSvBHOnuOIY0B4DttcgibPLCnOYCNw8fkibD2aEm2QKZfwDW9bF6ibM7ZT09FufiaD7nqL9DDQSlTzA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("å›¾: ç®€å•æè¿°å¸§ç”Ÿå‘½å‘¨æœŸ")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("ç®€å•æè¿°ä¸€å¸§çš„ç”Ÿå‘½å‘¨æœŸ:\n\n1. ä¸€å¸§å¼€å§‹ã€‚\n\n2. ä¸»çº¿ç¨‹:\n\n- Event Handlers: UIäº¤äº’è¾“å…¥çš„äº‹ä»¶å›è°ƒ, ä¾‹å¦‚inputã€clickã€wheelç­‰ã€‚\n\n- RAF: æ‰§è¡ŒrequestAnimationFrameå›è°ƒã€‚\n\n- DOM Tree: è§£æHTML, æ„å»ºDOM Tree, å½“JSå¯¹DOMæœ‰å˜æ›´ä¼šé‡æ–°è§¦å‘è¯¥æµç¨‹ã€‚\n\n- CSS Tree: æ„å»ºCSS Treeã€‚è‡³æ­¤æ„å»ºå‡ºRender Treeã€‚\n\n- Layout: æ‰€æœ‰å…ƒç´ çš„positionã€sizeä¿¡æ¯ã€‚\n\n- Paint: åƒç´ å¡«å……, ä¾‹å¦‚é¢œè‰²ã€æ–‡å­—ã€è¾¹æ¡†ç­‰å¯è§†éƒ¨åˆ†ã€‚\n\n- Composite: ç»˜åˆ¶çš„æŒ‡ä»¤ä¿¡æ¯ä¼ åˆ°åˆæˆçº¿ç¨‹ä¸­ã€‚\n\n- RequestIdleCallback: å¦‚æœæ­¤æ—¶ä¸€å¸§è¿˜æœ‰ç©ºä½™æ—¶é—´, åˆ™æ‰§è¡Œè¯¥å›è°ƒã€‚\n\n3. åˆæˆçº¿ç¨‹:\n\n- Raster: åˆæˆçº¿ç¨‹å°†ä¿¡æ¯åˆ†å—, å¹¶æŠŠæ¯å—å‘é€ç»™å…‰æ …çº¿ç¨‹, å…‰æ …çº¿ç¨‹åˆ›å»ºä½å›¾, å¹¶é€šçŸ¥GPUè¿›ç¨‹åˆ·æ–°è¿™ä¸€å¸§ã€‚\n\n4. ä¸€å¸§ç»“æŸã€‚\n")])])]),t("h3",{attrs:{id:"_1-3-ä¸¢å¸§å®éªŒ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-ä¸¢å¸§å®éªŒ"}},[n._v("#")]),n._v(" 1.3 ä¸¢å¸§å®éªŒ")]),n._v(" "),t("p",[n._v("æ€ä¹ˆå°±ä¸¢å¸§äº†å‘¢?")]),n._v(" "),t("p",[n._v("å¯¹äºæµç•…çš„åŠ¨ç”»ï¼Œå¦‚æœä¸€å¸§å¤„ç†æ—¶é—´è¶…è¿‡16msï¼Œå°±èƒ½æ„Ÿåˆ°é¡µé¢çš„å¡é¡¿äº†ã€‚")]),n._v(" "),t("blockquote",[t("p",[n._v("Demo: https://linjiayu6.github.io/FE-RequestIdleCallback-demo/")])]),n._v(" "),t("blockquote",[t("p",[n._v("Github: "),t("strong",[n._v("RequestIdleCallback å®éªŒ")]),n._v("[3]")])]),n._v(" "),t("p",[n._v("å½“ç”¨æˆ·ç‚¹å‡»ä»»ä¸€æŒ‰é”® Aï¼ŒBï¼ŒCï¼Œå› ä¸ºä¸»çº¿ç¨‹æ‰§è¡ŒEvent Handlersä»»åŠ¡ï¼ŒåŠ¨ç”»å› ä¸ºæµè§ˆå™¨ä¸èƒ½åŠæ—¶å¤„ç†ä¸‹ä¸€å¸§ï¼Œå¯¼è‡´åŠ¨ç”»å‡ºç°å¡é¡¿çš„ç°è±¡ã€‚")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// å¤„ç†åŒæ­¥ä»»åŠ¡ï¼Œå¹¶å ç”¨ä¸»çº¿ç¨‹\n\nconst bindClick = id =>\n\nelement(id).addEventListener('click', Work.onSyncUnit)\n\n// ç»‘å®šclickäº‹ä»¶\n\nbindClick('btnA')\n\nbindClick('btnB')\n\nbindClick('btnC')\n\nvar Work = {\n\n// æœ‰1ä¸‡ä¸ªä»»åŠ¡\n\nunit: 10000,\n\n// å¤„ç†æ¯ä¸ªä»»åŠ¡\n\nonOneUnit: function () { for (var i = 0; i <= 500000; i++) {} },\n\n// åŒæ­¥å¤„ç†: ä¸€æ¬¡å¤„ç†å®Œæ‰€æœ‰ä»»åŠ¡\n\nonSyncUnit: function () {\n\nlet _u = 0\n\nwhile (_u < Work.unit) {\n\nWork.onOneUnit()\n\n_u ++\n\n}\n\n}\n\n}\n")])])]),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h3",{attrs:{id:"_1-4-è§£å†³ä¸¢å¸§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-è§£å†³ä¸¢å¸§"}},[n._v("#")]),n._v(" 1.4 è§£å†³ä¸¢å¸§")]),n._v(" "),t("p",[n._v("ä¸Šè¿°ï¼Œæˆ‘ä»¬å‘ç° JSè¿ç®—æ˜¯å ç”¨æ¸²æŸ“çš„æ—¶é—´çš„ã€‚")]),n._v(" "),t("p",[n._v("åœ¨è¿ç»­åŠ¨ç”»ä¸­ï¼Œè¦åšé«˜è€—æ—¶çš„æ“ä½œï¼Œå¦‚ä½•ä¿è¯å¸§å¹³ç¨³å‘¢ï¼Ÿ")]),n._v(" "),t("p",[t("strong",[n._v("è§£å†³ä¸¢å¸§æ€è€ƒå¦‚ä¸‹")]),n._v(":")]),n._v(" "),t("ol",[t("li",[n._v("åœ¨ä¸€å¸§ç©ºé—²æ—¶å¤„ç†, åˆ©ç”¨ "),t("strong",[n._v("RequestIdleCallback")]),n._v("[4] å¤„ç†ä»»åŠ¡ã€‚")])]),n._v(" "),t("blockquote",[t("p",[n._v("window.requestIdleCallback()æ–¹æ³•å°†åœ¨æµè§ˆå™¨çš„ç©ºé—²æ—¶æ®µå†…è°ƒç”¨çš„å‡½æ•°æ’é˜Ÿã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´timeoutï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåºã€‚")])]),n._v(" "),t("ol",[t("li",[n._v("å¯¹é«˜è€—æ—¶çš„ä»»åŠ¡ï¼Œè¿›è¡Œåˆ†æ­¥éª¤å¤„ç†ã€‚")])]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("ol",[t("li",[n._v("Web worker è²Œä¼¼ä¹Ÿå¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œè¿™é‡Œä¸åšæ‰©å±•ã€‚")]),n._v(" "),t("li",[n._v("...")])]),n._v(" "),t("p",[n._v("è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ "),t("strong",[n._v("RequestIdleCallback")]),n._v("[5] åšä¸ªå®éªŒå’©ã€‚")]),n._v(" "),t("blockquote",[t("p",[n._v("Demo: https://linjiayu6.github.io/FE-RequestIdleCallback-demo/")])]),n._v(" "),t("blockquote",[t("p",[n._v("Github: "),t("strong",[n._v("RequestIdleCallback å®éªŒ")]),n._v("[6]")])]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("const bindClick = id =>\n\nelement(id).addEventListener('click', Work.onAsyncUnit)\n\n// ç»‘å®šclickäº‹ä»¶\n\nbindClick('btnA')\n\nbindClick('btnB')\n\nbindClick('btnC')\n\nvar Work = {\n\n// æœ‰1ä¸‡ä¸ªä»»åŠ¡\n\nunit: 10000,\n\n// å¤„ç†æ¯ä¸ªä»»åŠ¡\n\nonOneUnit: function () { for (var i = 0; i <= 500000; i++) {} },\n\n// å¼‚æ­¥å¤„ç†\n\nonAsyncUnit: function () {\n\n// ç©ºé—²æ—¶é—´ 1ms\n\nconst FREE_TIME = 1\n\nlet _u = 0\n\nfunction cb(deadline) {\n\n// å½“ä»»åŠ¡è¿˜æ²¡æœ‰è¢«å¤„ç†å®Œ & ä¸€å¸§è¿˜æœ‰çš„ç©ºé—²æ—¶é—´ > 1ms\n\nwhile (_u < Work.unit && deadline.timeRemaining() > FREE_TIME) {\n\nWork.onOneUnit()\n\n_u ++\n\n}\n\n// ä»»åŠ¡å¹²å®Œ, æ‰§è¡Œå›è°ƒ\n\nif (_u >= Work.unit) {\n\n// æ‰§è¡Œå›è°ƒ\n\nreturn\n\n}\n\n// ä»»åŠ¡æ²¡å®Œæˆ, ç»§ç»­ç­‰ç©ºé—²æ‰§è¡Œ\n\nwindow.requestIdleCallback(cb)\n\n}\n\nwindow.requestIdleCallback(cb)\n\n}\n\n}\n")])])]),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("requestIdleCallback å¯å‘")]),n._v(" "),t("p",[n._v("å°†ä¸€ä¸ªå¤§ä»»åŠ¡åˆ†å‰²æˆNä¸ªå°ä»»åŠ¡ï¼Œåœ¨æ¯ä¸€å¸§æœ‰ç©ºä½™æ—¶é—´æƒ…å†µä¸‹ï¼Œé€æ­¥å»æ‰§è¡Œå°ä»»åŠ¡ã€‚")]),n._v(" "),t("h2",{attrs:{id:"_2-react15-æ¶æ„ç¼ºç‚¹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-react15-æ¶æ„ç¼ºç‚¹"}},[n._v("#")]),n._v(" 2.React15 (-) æ¶æ„ç¼ºç‚¹")]),n._v(" "),t("blockquote",[t("p",[t("strong",[n._v("React: stack reconcilerå®ç°")]),n._v("[7]")])]),n._v(" "),t("blockquote",[t("p",[t("strong",[n._v("React ç®—æ³•ä¹‹æ·±åº¦ä¼˜å…ˆéå†")]),n._v("[8]")])]),n._v(" "),t("p",[n._v("é€’å½’ Recursion: åˆ©ç”¨ "),t("strong",[n._v("è°ƒç”¨æ ˆ")]),n._v("[9]ï¼Œå®ç°è‡ªå·±è°ƒç”¨è‡ªå·±çš„æ–¹æ³•ã€‚")]),n._v(" "),t("p",[n._v("æœ€å¸¸è§çš„å°±æ˜¯ "),t("strong",[n._v("Leetcode: æ–æ³¢æ‹‰å¥‘æ•°åˆ—")]),n._v("[10] ã€"),t("strong",[n._v("Leetcode: 70. çˆ¬æ¥¼æ¢¯")]),n._v("[11]ã€‚")]),n._v(" "),t("h3",{attrs:{id:"_2-1-æ¦‚è¿°åŸå› "}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-æ¦‚è¿°åŸå› "}},[n._v("#")]),n._v(" 2.1 æ¦‚è¿°åŸå› ")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("è¯¥æƒ…å†µï¼Œç±»ä¼¼æˆ‘ä»¬ä¸Šè¿°# 1.3ä¸¢å¸§å®éªŒã€‚")]),n._v(" "),t("h3",{attrs:{id:"_2-2-æµç¨‹å’Œä»£ç è§£æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-æµç¨‹å’Œä»£ç è§£æ"}},[n._v("#")]),n._v(" 2.2 æµç¨‹å’Œä»£ç è§£æ")]),n._v(" "),t("blockquote",[t("p",[n._v("å¯èƒ½éœ€è¦ä½ æœ‰ç‚¹ æ·±åº¦ä¼˜å…ˆéå†ã€é€’å½’ã€å›æº¯æ€æƒ³ã€ğŸŒ² ç­‰æ•°æ®ç»“æ„çš„çŸ¥è¯†ã€‚")])]),n._v(" "),t("blockquote",[t("p",[n._v("è¿™é‡Œåªåšæµç¨‹è§£æï¼Œä»£ç ä¹Ÿä¸ºé˜‰å‰²ç‰ˆï¼Œé‡ç‚¹æ˜¯ç†è§£æ€æƒ³å“ˆã€‚")])]),n._v(" "),t("p",[n._v("æŸReactèŠ‚ç‚¹å¦‚ä¸‹:")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('  class A extends React.Component {\n\n    ...\n\n\n\n    render() {\n\n      return (\n\n        <div id="app">\n\n          <h1></h1>\n\n          <p><h2></h2></p>\n\n          <h3></h3>\n\n        </div>\n\n      )\n\n    }\n\n }\n')])])]),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("å›¾ DFS + é€’å½’éå†çš„è·¯å¾„")]),n._v(" "),t("p",[n._v("ä¸‹é¢æ˜¯ "),t("strong",[n._v("ReactFiberWorkLoop.old.js")]),n._v("[12] é˜‰å‰²ç‰ˆä»£ç ï¼Œä¸ºäº†ç®€è¦è¯´æ˜è¯¥æµç¨‹ã€‚")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// å·¥ä½œå¾ªç¯åŒæ­¥å¤„ç†\n\nfunction workLoopSync() {\n\n  // æœ‰ä»»åŠ¡\n\n  while (workInProgress !== null) {\n\n    performUnitOfWork(workInProgress);\n\n  }\n\n}\n\n\n\nfunction performUnitOfWork(unitOfWork: Fiber): void {\n\n  // å¯¹è¯¥èŠ‚ç‚¹ å¼€å§‹å·¥ä½œ: return workInProgress.child; è¿”å›çš„æ˜¯è¯¥èŠ‚ç‚¹çš„å­©å­\n\n  let next = beginWork(...);\n\n\n\n  if (next === null) {\n\n    // å¯¹æŸNode å®Œæˆå·¥ä½œ: å›æº¯å‘ä¸Š, å‘ä¸Šæ‰¾åˆ°æŸèŠ‚ç‚¹çš„å…„å¼Ÿ sibling æˆ– ç›´åˆ°å‘ä¸Šä¸ºrootä»£è¡¨, éå†ç»“æŸã€‚\n\n    completeUnitOfWork(unitOfWork);\n\n  } else {\n\n    // ä»ta å­©å­å…¥æ‰‹, ç»§ç»­å‘ä¸‹å·¥ä½œ\n\n    workInProgress = next;\n\n  }\n\n}\n\n\n\n/**\n\n * siblingFiber: å…„å¼ŸèŠ‚ç‚¹\n\n * returnFiber: çˆ¶äº²èŠ‚ç‚¹\n\n */\n\nfunction completeUnitOfWork(unitOfWork: Fiber): void {\n\n  let completedWork = unitOfWork;\n\n\n\n  // è¿™é‡Œåˆæ˜¯ä¸€ä¸ªå¾ªç¯\n\n  do {\n\n    // 1. åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆ, å®Œæˆå°±æ‰“ä¸ªå®Œæˆçš„æ ‡ç­¾, æ²¡æœ‰å®Œæˆå°±æŠ›å‡ºå¼‚å¸¸\n\n\n\n    // 2. å¦‚æœæœ‰å…„å¼ŸèŠ‚ç‚¹, é‚£ä¹ˆæ¥ä¸‹æ¥å·¥ä½œèŠ‚ç‚¹æ˜¯è¯¥ xd\n\n    if (completedWork.sibling !== null) {\n\n      workInProgress = siblingFiber;\n\n      return;\n\n    }\n\n\n\n    // 3. å¦åˆ™, è¿”å›çˆ¶äº²èŠ‚ç‚¹\n\n    completedWork = completedWork.return;\n\n    workInProgress = completedWork;\n\n  } while (completedWork !== null);\n\n\n\n  // æœ€å, æ˜¯rootèŠ‚ç‚¹, ç»“æŸ\n\n  if (workInProgressRootExitStatus === RootIncomplete) {\n\n    workInProgressRootExitStatus = RootCompleted;\n\n  }\n\n}\n")])])]),t("h2",{attrs:{id:"_3-ä¸Šè¿°æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä¸Šè¿°æ€»ç»“"}},[n._v("#")]),n._v(" 3.ä¸Šè¿°æ€»ç»“")]),n._v(" "),t("p",[t("strong",[n._v("å› æœå…³ç³»")])]),n._v(" "),t("p",[n._v("åŸºäºè¿™äº›åŸå› ï¼ŒReactä¸å¾—ä¸é‡æ„æ•´ä¸ªæ¡†æ¶ã€‚")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("1. React (15ver-) å¯¹åˆ›å»ºå’Œæ›´æ–°èŠ‚ç‚¹çš„å¤„ç†ï¼Œæ˜¯é€šè¿‡ é€’å½’ ğŸŒ²ã€‚\n\n2. é€’å½’ ï¼Œ åœ¨æœªå®Œæˆå¯¹æ•´ä¸ªğŸŒ² çš„éå†å‰ï¼Œæ˜¯ä¸ä¼šåœæ­¢çš„ã€‚\n\n3. è¯¥ ä»»åŠ¡ ä¸€ç›´å ç”¨æµè§ˆå™¨ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´æ—  å“åº”ä¼˜å…ˆçº§æ›´é«˜ çš„ä»»åŠ¡ã€‚\n\n4. æ•…ï¼Œæµè§ˆå™¨æ¸²æŸ“è¶…è¿‡ä¸´ç•Œæ—¶é—´ï¼Œä»è§†è§‰ä¸Šæ¥çœ‹ï¼Œå¡æ­» ğŸ¶ã€‚\n")])])]),t("p",[t("strong",[n._v("ä¸»åŠ¨æ€è€ƒ")])]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("ä¸ºäº†å¿«é€Ÿå“åº”ï¼Œé˜²æ­¢ä¸¢å¸§ï¼Œè§£å†³æ€è·¯:\n\n\n1. å°† ä»»åŠ¡ åˆ†è§£æˆ Nä¸ªå°ä»»åŠ¡ï¼›\n\n2. If ä¸€å¸§é‡Œæ²¡æœ‰ ä¼˜å…ˆçº§æ›´é«˜çš„ä»»åŠ¡ï¼Œåˆ™æ‰§è¡Œè‡ªå·±ã€‚\n\n   else æœ‰å…¶ä»– ä¼˜å…ˆçº§é«˜çš„äº‹åŠ¡, ä¼˜å…ˆæ‰§è¡Œå…¶ä»–ã€‚\n\n     If ç­‰ä¸€å¸§æœ‰ ç©ºé—² å†æ‰§è¡Œè‡ªå·±ã€‚\n\n     else ä¸‹ä¸€å¸§ã€‚\n")])])]),t("p",[n._v("æˆ‘ä»¬å†å›å¤´çœ‹ä¸‹è¿™ä¸ªå›¾ï¼Œé—®é¢˜å³è½¬æ¢å¦‚ä¸‹:")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("å¦‚ä½•å°†ä»»åŠ¡æ‹†åˆ†ï¼Ÿ\n\nå¦‚ä½•åˆ¤æ–­ä¼˜å…ˆçº§ï¼Ÿ\n\nå¦‚ä½•åˆ¤æ–­ä¸€å¸§ç©ºé—²æ—¶ï¼Œå†æ‰§è¡Œï¼Ÿ\n\n...\n")])])]),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h1",{attrs:{id:"fiber-æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#fiber-æ¶æ„"}},[n._v("#")]),n._v(" Fiber æ¶æ„")]),n._v(" "),t("blockquote",[t("p",[n._v("æ¨è ğŸ‘ https://github.com/7kms/react-illustration-series/tree/v17.0.1")])]),n._v(" "),t("blockquote",[t("p",[n._v("æ¨è ğŸ‘ https://react.iamkasong.com/preparation/oldConstructure.html")])]),n._v(" "),t("p",[n._v("ä¸‹é¢ï¼Œä¸ä¼šæœ‰å¤§æ®µå¤§æ®µä»£ç ï¼Œå»è®²å…·ä½“çš„å®ç°ã€‚")]),n._v(" "),t("p",[n._v("è€Œæ˜¯ï¼Œä»¥å› æœé€»è¾‘ï¼Œå¸¦ä½ å»äº†è§£ whyï¼Œhowï¼Œwhen (ä¸ºä»€ä¹ˆã€æ€ä¹ˆåšã€ä½•æ—¶åš)ã€‚")]),n._v(" "),t("h2",{attrs:{id:"_4-æŠ½è±¡é—®é¢˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-æŠ½è±¡é—®é¢˜"}},[n._v("#")]),n._v(" 4.æŠ½è±¡é—®é¢˜")]),n._v(" "),t("p",[n._v("ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº†ä»€ä¹ˆä»»åŠ¡ã€ä¼˜å…ˆçº§ç­‰ç­‰ï¼Œæˆ‘ä»¬é€šè¿‡å›¾çš„æ–¹å¼ï¼ŒæŠ½è±¡ä¸‹é—®é¢˜ã€‚")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("æè¿°:\n\n1. ä»»åŠ¡Aè¿›å…¥æ‰§è¡ŒåŒºåŸŸã€‚\n\n2. åœ¨æ‰§è¡Œä»»åŠ¡Açš„è¿‡ç¨‹ä¸­ï¼Œæ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡Bï¼Œè¯·æ±‚è¢«æ‰§è¡Œã€‚\n\n3. ä½†å› ä¸ºå…ˆæ¥ååˆ°å˜›ï¼Œæ­¤æ—¶ä»»åŠ¡Bå› ä¸ºæ— æ³•è¢«æ‰§è¡Œï¼Œè€Œæš‚æ—¶è¢«æŒ‚èµ·ï¼Œåªèƒ½ç­‰å¾…æ‰§è¡Œã€‚\n\n4. åªæœ‰æ‰§è¡Œå®Œä»»åŠ¡Aåï¼Œæ‰ä¼šæ‰§è¡Œä»»åŠ¡Bã€‚\n")])])]),t("p",[t("strong",[n._v("ä¸Šè¿°æµç¨‹å¯ç±»æ¯”:")]),n._v(" ä½ åœ¨åƒé¥­ï¼Œçªç„¶ä½ è€æ¿ ç»™ä½ æ‰“ç”µè¯ï¼Œä½ ä¸€å®šè¦åšæŒåƒå®Œé¥­ï¼Œæ‰æ¥ä½ è€æ¿çš„ç”µè¯ã€‚")]),n._v(" "),t("p",[n._v("(è„‘è¡¥ä¸€ä¸‹è€æ¿çš„è¡¨æƒ…ğŸ˜­)")]),n._v(" "),t("p",[n._v("å¾ˆæ˜æ˜¾ï¼Œè¿™æ ·å¤„ç†é—®é¢˜ï¼Œæ•ˆç‡å¥‡ä½æ— æ¯”ã€‚")]),n._v(" "),t("p",[n._v("æŒ‰ç…§æˆ‘ä»¬åœ¨å‰æƒ…æ€»ç»“éƒ¨åˆ†çš„è¯‰æ±‚ï¼Œå°†ä¸Šè¿°å›¾å˜æˆè¿™æ ·æ˜¯ä¸æ˜¯æ›´åˆç†äº›ã€‚")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("æè¿°:\n\n1. ä»»åŠ¡Aè¿›å…¥æ‰§è¡ŒåŒºåŸŸã€‚\n\n2. åœ¨æ‰§è¡Œä»»åŠ¡Açš„è¿‡ç¨‹ä¸­ï¼Œæ›´é«˜ä¼˜å…ˆçº§ä»»åŠ¡Bï¼Œè¯·æ±‚è¢«æ‰§è¡Œã€‚\n\n3. è€ƒè™‘åˆ°ä»»åŠ¡Bä¼˜å…ˆçº§æ›´é«˜ï¼Œåˆ™å°†ä»»åŠ¡Aæ²¡æœ‰æ‰§è¡Œå®Œæˆçš„éƒ¨åˆ†ï¼ŒStashæš‚å­˜ã€‚\n\n4. ä»»åŠ¡Bè¢«æ‰§è¡Œã€‚å½“ä»»åŠ¡Bè¢«æ‰§è¡Œå®Œæˆåï¼Œå»æ‰§è¡Œå‰©ä½™æ²¡æœ‰å®Œæˆçš„ä»»åŠ¡Aã€‚\n")])])]),t("p",[t("strong",[n._v("ä¸Šè¿°æµç¨‹å¯ç±»æ¯”:")]),n._v(" ä½ åœ¨åƒé¥­ï¼Œçªç„¶ä½ è€æ¿ç»™ä½ æ‰“ç”µè¯ï¼Œå³ä½¿ä½ æ²¡æœ‰åƒå®Œé¥­ï¼Œä¹Ÿæ¥èµ·äº†ä½ è€æ¿çš„ç”µè¯ï¼Œåç»§ç»­åƒé¥­ã€‚(è„‘è¡¥ä¸€ä¸‹è€æ¿çš„è¡¨æƒ…ğŸ˜Š)")]),n._v(" "),t("h2",{attrs:{id:"_5-æ ¸å¿ƒå…³æ³¨"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ ¸å¿ƒå…³æ³¨"}},[n._v("#")]),n._v(" 5.æ ¸å¿ƒå…³æ³¨")]),n._v(" "),t("h3",{attrs:{id:"_5-1-å¹¶å‘ã€è°ƒåº¦"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-å¹¶å‘ã€è°ƒåº¦"}},[n._v("#")]),n._v(" 5.1 å¹¶å‘ã€è°ƒåº¦")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("Concurrency & Scheduler")]),n._v(" "),t("p",[t("strong",[n._v("Concurrency å¹¶å‘:")]),n._v(" æœ‰èƒ½åŠ›ä¼˜å…ˆå¤„ç†æ›´é«˜ä¼˜äº‹åŠ¡ï¼ŒåŒæ—¶å¯¹æ­£åœ¨æ‰§è¡Œçš„ä¸­é€”ä»»åŠ¡å¯æš‚å­˜ï¼Œå¾…é«˜ä¼˜å®Œæˆåï¼Œå†å»æ‰§è¡Œã€‚")]),n._v(" "),t("blockquote",[t("p",[t("strong",[n._v("concurrency")]),n._v(" is the ability of different parts or units of a "),t("strong",[n._v("program")]),n._v("[13], "),t("strong",[n._v("algorithm")]),n._v("[14], or "),t("strong",[n._v("problem")]),n._v('[15] to be [executed](https://en.wikipedia.org/wiki/Execution_(computing "executed")) out-of-order or at the same time simultaneously '),t("strong",[n._v("partial order")]),n._v("[16], without affecting the final outcome.")])]),n._v(" "),t("blockquote",[t("p",[n._v("https://en.wikipedia.org/wiki/Concurrency_(computer_science)")])]),n._v(" "),t("p",[t("strong",[n._v("Scheduler åè°ƒè°ƒåº¦")]),n._v(": æš‚å­˜æœªæ‰§è¡Œä»»åŠ¡ï¼Œç­‰å¾…æ—¶æœºæˆç†Ÿåï¼Œå†å»å®‰æ’æ‰§è¡Œå‰©ä¸‹æœªå®Œæˆä»»åŠ¡ã€‚")]),n._v(" "),t("p",[n._v("è€ƒè™‘ æ‰€æœ‰ä»»åŠ¡å¯ä»¥è¢«å¹¶å‘æ‰§è¡Œï¼Œå°±éœ€è¦æœ‰ä¸ªåè°ƒä»»åŠ¡çš„è°ƒåº¦ç®—æ³•ã€‚")]),n._v(" "),t("p",[n._v("çœ‹åˆ°è¿™é‡Œï¼Œä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ä¸€ä¸ªå¤§bugã€‚")]),n._v(" "),t("p",[n._v("è‚¯å®šæ˜¯"),t("strong",[n._v("Call Stack")]),n._v("[17]ã€‚")]),n._v(" "),t("h3",{attrs:{id:"_5-2-è°ƒç”¨æ ˆã€è™šæ‹Ÿè°ƒç”¨æ ˆå¸§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-è°ƒç”¨æ ˆã€è™šæ‹Ÿè°ƒç”¨æ ˆå¸§"}},[n._v("#")]),n._v(" 5.2 è°ƒç”¨æ ˆã€è™šæ‹Ÿè°ƒç”¨æ ˆå¸§")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("è°ƒç”¨æ ˆè¿™é‡Œçœ‹èµ·æ¥å°±å¾ˆä¸åˆç†ã€‚")]),n._v(" "),t("p",[n._v("å› ä¸ºæµè§ˆå™¨æ˜¯åˆ©ç”¨è°ƒç”¨æ ˆæ¥ç®¡ç†å‡½æ•°æ‰§è¡Œé¡ºåºçš„ï¼Œç§‰æ‰¿ç€å…ˆè¿›åå‡ºåŸåˆ™ï¼Œæ˜¯å¦‚ä½•åšåˆ°æŸä»»åŠ¡éƒ½å…¥æ ˆäº†ï¼Œä½†æ˜¯å› ä¸ºä¸­é€”æœ‰å…¶ä»–äº‹å„¿ï¼Œå°±è¢«ä¸­æ–­ã€‚ä¸­æ–­å°±ä¸ç®—äº†ï¼Œè¿˜èƒ½ä¸­æ–­åï¼Œæ¥ç€åç»­å†æ‰§è¡Œã€‚")]),n._v(" "),t("p",[t("strong",[n._v("é—®é¢˜çªç„¶é—´å°±å˜æˆ: pause a functioin call (æš‚åœå¯¹ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨)ã€‚")])]),n._v(" "),t("p",[n._v("å·§äº†ï¼Œåƒ generator å’Œ æµè§ˆå™¨debugger å°±å¯ä»¥åšåˆ°ä¸­æ–­å‡½æ•°è°ƒç”¨ã€‚ä½†è€ƒè™‘åˆ°å¯ä¸­æ–­æ¸²æŸ“ï¼Œå¹¶å¯é‡å›æ„é€ ã€‚Reactè‡ªè¡Œå®ç°äº†ä¸€å¥—ä½“ç³»å«åš "),t("strong",[n._v("React fiber æ¶æ„ã€‚")])]),n._v(" "),t("p",[t("strong",[n._v("React Fiber æ ¸å¿ƒ: è‡ªè¡Œå®ç° è™šæ‹Ÿæ ˆå¸§ã€‚")])]),n._v(" "),t("blockquote",[t("p",[n._v("That's the purpose of React Fiber. Fiber is reimplementation of the stack, specialized for React components. You can think of a single fiber as a "),t("strong",[n._v("virtual stack frame")]),n._v(".")])]),n._v(" "),t("blockquote",[t("p",[n._v("https://github.com/acdlite/react-fiber-architecture")])]),n._v(" "),t("p",[n._v("çœ‹åˆ°è¿™é‡Œï¼Œæ˜¯ä¸æ˜¯è§‰å¾— React yydsã€‚ps: åæ­£çœ‹ä¸å¤ªæ‡‚çš„éƒ½æ˜¯ yydsã€‚")]),n._v(" "),t("h3",{attrs:{id:"_5-3-react-16-æ¶æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-react-16-æ¶æ„"}},[n._v("#")]),n._v(" 5.3 React 16 (+) æ¶æ„")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h2",{attrs:{id:"_6-æ•°æ®ç»“æ„"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-æ•°æ®ç»“æ„"}},[n._v("#")]),n._v(" 6.æ•°æ®ç»“æ„")]),n._v(" "),t("blockquote",[t("p",[t("strong",[n._v("FiberNode.js")]),n._v("[18]")])]),n._v(" "),t("p",[n._v("Fiberçš„æ•°æ®ç»“æ„æœ‰ä¸‰å±‚ä¿¡æ¯: å®ä¾‹å±æ€§ã€æ„å»ºå±æ€§ã€å·¥ä½œå±æ€§ã€‚")]),n._v(" "),t("p",[n._v("ä¸‹é¢ä»¥è¯¥demoä»£ç ä¸ºä¾‹:")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('<div id="linjiayu">123</div>\n\n<script type="text/babel">\n\n    const App = () => {\n\n        const [sum, onSetSum] = React.useState(0)\n\n\n\n        return (\n\n            <div id="app 1">\n\n                <h1 id="2-1 h1">æ ‡é¢˜ h1</h1>\n\n                <ul id="2-2 ul"> \n\n                    <li id="3-1 li" onClick={() => onSetSum(d => d + 1)}>ç‚¹å‡» h2</li>\n\n                    <li id="3-2 li">{sum}</li>\n\n                </ul>\n\n\n\n                <h3 id="2-3 h3">æ ‡é¢˜ h3</h3>\n\n            </div>\n\n        )\n\n    }\n\n\n\n    ReactDOM.render(\n\n        <App />,\n\n        document.getElementById(\'linjiayu\')\n\n    );\n\n<\/script>\n')])])]),t("h3",{attrs:{id:"_6-1-å®ä¾‹å±æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-å®ä¾‹å±æ€§"}},[n._v("#")]),n._v(" 6.1 å®ä¾‹å±æ€§")]),n._v(" "),t("p",[n._v("è¯¥Fiberçš„åŸºæœ¬ä¿¡æ¯ï¼Œä¾‹å¦‚ç»„ä»¶ç±»å‹ç­‰ã€‚")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h3",{attrs:{id:"_6-2-æ„å»ºå±æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-æ„å»ºå±æ€§"}},[n._v("#")]),n._v(" 6.2 æ„å»ºå±æ€§")]),n._v(" "),t("p",[n._v("æ„å»ºå±æ€§ (returnã€childã€sibling)ï¼Œæ ¹æ®ä¸Šé¢ä»£ç ï¼Œæˆ‘ä»¬æ„å»ºä¸€ä¸ªFiberæ ‘ğŸŒ²ã€‚")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h4",{attrs:{id:"æ„å»ºæµç¨‹"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#æ„å»ºæµç¨‹"}},[n._v("#")]),n._v(" æ„å»ºæµç¨‹")]),n._v(" "),t("p",[n._v("å’Œ 2.2 æµç¨‹å’Œä»£ç è§£æ éƒ¨åˆ†ä¸åŒçš„æ˜¯:")]),n._v(" "),t("ol",[t("li",[n._v("åˆ†ä¸ºåŒæ­¥æˆ–å¼‚æ­¥æ›´æ–°ã€‚")]),n._v(" "),t("li",[n._v("ä¸”å¢åŠ çš„å¼‚æ­¥æ›´æ–° ä½¿ç”¨è¯¥å­—æ®µ "),t("strong",[n._v("shouldYield")]),n._v(" æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ä¸­æ–­ã€‚")])]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// performSyncWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•\n\nfunction workLoopSync() {\n\n  while (workInProgress !== null) {\n\n    performUnitOfWork(workInProgress);\n\n  }\n\n}\n\n\n\n// performConcurrentWorkOnRootä¼šè°ƒç”¨è¯¥æ–¹æ³•\n\nfunction workLoopConcurrent() {\n\n  while (workInProgress !== null && ! shouldYield ()) {\n\n    performUnitOfWork(workInProgress);\n\n  }\n\n}\n")])])]),t("p",[n._v("åœ¨ä¸€ä¸ªé€’å½’å¾ªç¯é‡Œï¼Œé€’: "),t("strong",[n._v("beginWork()")]),n._v("[19], å½’ "),t("strong",[n._v("completeWork()")]),n._v("[20]")]),n._v(" "),t("blockquote",[t("p",[n._v("è™šçº¿: è¡¨è¾¾æ„å»ºå…³ç³»ï¼Œä½†æœªå®ŒæˆçŠ¶æ€ã€‚")])]),n._v(" "),t("blockquote",[t("p",[n._v("å®çº¿: å·²æ„å»ºå…³ç³»ï¼Œå¹¶å·²æ‰§è¡ŒæŸä¸ªçŠ¶æ€ã€‚")]),n._v(" "),t("ul",[t("li",[n._v("å®çº¿ child å’Œ sibling å·²æ‰§è¡ŒbeginWork()")]),n._v(" "),t("li",[n._v("å®çº¿ return å·²æ‰§è¡Œ completeUnitOfWork()")])])]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('1. åˆ›å»ºfiberNode FiberRootNode \n\n2. åˆ›å»ºfiberNode rootFiber (å³ç¤ºä¾‹ä¸­ <div id="linjiayu">)\n\n\n\nè¿›å…¥å¾ªç¯å·¥ä½œåŒºåŸŸ, workInProgress(å·¥ä½œæŒ‡é’ˆæŒ‡å‘ rootFiber)\n\n3. åˆ›å»ºfiberNode App \n\n   beginWork() -> åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ -> workInProgress(å·¥ä½œæŒ‡é’ˆæŒ‡å‘App) \n\n   \n\n4. åˆ›å»ºfiberNode div \n\n   beginWork() -> æœ‰å¤šä¸ªå­èŠ‚ç‚¹ -> workInProgress(å·¥ä½œæŒ‡é’ˆæŒ‡å‘div) \n')])])]),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("5. æ„å»ºå­©å­ä»¬èŠ‚ç‚¹\n\næŒ‰ç…§5.1 -> 5.2 -> 5.3 é¡ºåºå°†æ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºã€‚\n")])])]),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("6. workInProgress (å·¥ä½œæŒ‡é’ˆæŒ‡å‘h1)\n\n   beginWork() -> æ²¡æœ‰å­èŠ‚ç‚¹ -> completeUnitOfWork() -> æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œç»§ç»­ ...\n")])])]),t("h3",{attrs:{id:"_6-3-å·¥ä½œå±æ€§"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-å·¥ä½œå±æ€§"}},[n._v("#")]),n._v(" 6.3 å·¥ä½œå±æ€§")]),n._v(" "),t("ol",[t("li",[n._v("ã€æ•°æ®ã€‘æ•°æ®çš„å˜æ›´ä¼šå¯¼è‡´UIå±‚çš„å˜æ›´ã€‚")]),n._v(" "),t("li",[n._v("ã€åè°ƒã€‘ä¸ºäº†å‡å°‘å¯¹DOMçš„ç›´æ¥æ“ä½œï¼Œé€šè¿‡Reconcileè¿›è¡ŒdiffæŸ¥æ‰¾ï¼Œå¹¶å°†éœ€è¦å˜æ›´èŠ‚ç‚¹ï¼Œæ‰“ä¸Šæ ‡ç­¾ï¼Œå˜æ›´è·¯å¾„ä¿ç•™åœ¨effectListé‡Œã€‚")]),n._v(" "),t("li",[n._v("ã€è°ƒåº¦ã€‘å¾…å˜æ›´å†…å®¹è¦æœ‰Schedulerä¼˜å…ˆçº§å¤„ç†ã€‚")])]),n._v(" "),t("p",[n._v("æ•…ï¼Œæ¶‰åŠåˆ°diffç­‰æŸ¥æ‰¾æ“ä½œï¼Œæ˜¯éœ€è¦æœ‰ä¸ªé«˜æ•ˆæ‰‹æ®µæ¥å¤„ç†å‰åå˜åŒ–ï¼Œå³åŒç¼“å­˜æœºåˆ¶ã€‚")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("æœ‰å…³åŒç¼“å­˜æœºåˆ¶ã€æ•°æ®æ›´æ–°ã€diffç®—æ³•ç­‰ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚")]),n._v(" "),t("h2",{attrs:{id:"_7-reconciler-å’Œ-scheduler"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-reconciler-å’Œ-scheduler"}},[n._v("#")]),n._v(" 7.Reconciler å’Œ Scheduler")]),n._v(" "),t("p",[n._v("ä¸Šé¢ï¼Œæˆ‘ä»¬æ¦‚è¿°äº†fiberNodeçš„æ•°æ®ç»“æ„ï¼Œ"),t("strong",[n._v("é“¾è¡¨ç»“æ„å³å¯æ”¯æŒéšæ—¶éšæ—¶ä¸­æ–­çš„è¯‰æ±‚")]),n._v("ã€‚")]),n._v(" "),t("p",[n._v("ä¸‹é¢æˆ‘ä»¬ç®€è¿°ä¸‹æ¶æ„ä¸­ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—:")]),n._v(" "),t("ul",[t("li",[n._v("Reconciler (åè°ƒ): è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ã€‚")]),n._v(" "),t("li",[n._v("Scheduler (è°ƒåº¦): è´Ÿè´£æ‰¾å‡ºé«˜ä¼˜ä»»åŠ¡ã€‚")])]),n._v(" "),t("h3",{attrs:{id:"_7-1-reconciler-è¿è¡Œæµç¨‹æµ…æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-reconciler-è¿è¡Œæµç¨‹æµ…æ"}},[n._v("#")]),n._v(" 7.1 Reconciler è¿è¡Œæµç¨‹æµ…æ")]),n._v(" "),t("ol",[t("li",[t("strong",[n._v("ã€è¾“å…¥ã€‘")]),n._v(" å½“æ•°æ®åˆå§‹åŒ–æˆ–å˜åŒ–ï¼Œæœ€åä¼šè°ƒç”¨"),t("code",[n._v("schedulerUpdateOnFiber")]),n._v("è¯¥æ–¹æ³•ã€‚")])]),n._v(" "),t("ul",[t("li",[n._v("ä¸éœ€è¦è°ƒåº¦ï¼Œç›´æ¥å»æ„é€ fiberæ ‘ã€‚")]),n._v(" "),t("li",[n._v("éœ€è¦è°ƒåº¦ï¼Œæ³¨å†Œè°ƒåº¦ä»»åŠ¡ã€‚")])]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// scheduleUpdateOnFiber(fiber, lane, eventTime) ä»¥ä¸‹ä¸ºé˜‰å‰²ç‰ˆä»£ç \n\n// åŒæ­¥\n\nif (lane === SyncLane) {\n\n    if ( \n\n       // Check if we're inside unbatchedUpdates (æ²¡æœ‰ä¸€æ¬¡äº‹ä»¶å›è°ƒä¸­è§¦å‘å¤šæ¬¡æ›´æ–°)\n\n      (executionContext & LegacyUnbatchedContext) !== NoContext && \n\n      // Check if we're not already rendering (æ˜¯å¦å°šæœªæ¸²æŸ“)\n\n      (executionContext & (RenderContext | CommitContext)) === NoContext) {\n\n      // ä¸è°ƒåº¦, ç›´æ¥å»æ„é€ fiberæ ‘\n\n      performSyncWorkOnRoot(root);\n\n   }\n\n}\n\n\n\n// å¦åˆ™ï¼Œéœ€è¦è°ƒåº¦äº¤ç»™Scheduleråï¼Œå†å»æ„é€ fiberæ ‘\n\nensureRootIsScheduled(root, eventTime);\n")])])]),t("ol",[t("li",[t("strong",[n._v("ã€æ³¨å†Œä»»åŠ¡ã€‘")]),n._v(" "),t("code",[n._v("ensureRootIsScheduled")])])]),n._v(" "),t("p",[n._v("ä¸¤ç±»ä»»åŠ¡:")]),n._v(" "),t("ul",[t("li",[n._v("performSyncWorkOnRoot åŒæ­¥æ„å»ºtreeã€‚")]),n._v(" "),t("li",[n._v("performConcurrentWorkOnRoot å¼‚æ­¥æ„å»ºtreeã€‚")])]),n._v(" "),t("p",[n._v("scheduleSyncCallback æˆ– scheduleCallback: å°†ä¸Šè¿°ä¸¤ç±»ä»»åŠ¡å°è£…åˆ°äº†å¯¹åº”çš„"),t("strong",[n._v("ä»»åŠ¡é˜Ÿåˆ—")]),n._v("ä¸­ã€‚")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// ensureRootIsScheduled\n\nfunction ensureRootIsScheduled(root, currentTime) {\n\n    // ....\n\n    \n\n    // 1. ä¼˜å…ˆçº§æœ€é«˜ï¼Œç«‹åˆ»é©¬ä¸Šè¦åŒæ­¥æ‰§è¡Œ\n\n    if (newCallbackPriority === SyncLanePriority) {\n\n      newCallbackNode = scheduleSyncCallback(performSyncWorkOnRoot.bind(null, root));\n\n     // 2. åŒæ­¥æ‰¹é‡æ›´æ–°\n\n    } else if (newCallbackPriority === SyncBatchedLanePriority) {\n\n      newCallbackNode = scheduleCallback(ImmediatePriority$1, performSyncWorkOnRoot.bind(null, root));\n\n    } else {\n\n      // 3. å¼‚æ­¥ä¼˜å…ˆçº§ç™»è®°\n\n      var schedulerPriorityLevel = lanePriorityToSchedulerPriority(newCallbackPriority);\n\n      newCallbackNode = scheduleCallback(schedulerPriorityLevel, performConcurrentWorkOnRoot.bind(null, root));\n\n    }\n\n    \n\n    // ...\n\n    \n\n    // æ›´æ–°rootFiber ä»»åŠ¡\n\n    root.callbackNode = newCallbackNode;\n\n}\n")])])]),t("p",[n._v("åŒæ­¥ä»»åŠ¡ä¼šæ”¾åˆ°syncQueue é˜Ÿåˆ—ï¼Œä¼šè¢«ç«‹å³è¢«æ‰§è¡Œã€‚")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("var _queue = syncQueue;\n\n\n\n// æ‰§è¡Œæ‰€æœ‰åŒæ­¥ä»»åŠ¡\n\nrunWithPriority(ImmediatePriority, () => {\n\n    for (; i < queue.length; i++) {\n\n    let callback = queue[i];\n\n    do {\n\n        callback = callback(isSync);\n\n    } while (callback !== null);\n\n    }\n\n});\n\n// æ¸…ç©ºåŒæ­¥ä»»åŠ¡\n\nsyncQueue = null;\n")])])]),t("p",[n._v("å¼‚æ­¥å¤„ç†ä¼šè°ƒç”¨ scheduleræ–¹æ³• "),t("code",[n._v("unstable_scheduleCallback")]),n._v("ï¼Œå…¶å®æ˜¯requestIdleCallbackæ›¿ä»£å“ï¼Œè¯¥æ–¹æ³•ä¼ å…¥å›è°ƒä»»åŠ¡ï¼Œå’Œè¿‡æœŸæ—¶é—´ï¼Œæ¥å®‰æ’ä»»åŠ¡çš„æ‰§è¡Œã€‚")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("function unstable_scheduleCallback(callback, deprecated_options) {}\n")])])]),t("ol",[t("li",[t("strong",[n._v("ã€æ‰§è¡Œä»»åŠ¡å›è°ƒã€‘")])])]),n._v(" "),t("p",[n._v("ä¸‹é¢ "),t("code",[n._v("performSyncWorkOnRoot")]),n._v(" å’Œ "),t("code",[n._v("performConcurrentWorkOnRoot")]),n._v(" ä¸åŒçš„æ˜¯: å¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œå¯éšæ—¶ä¸­æ–­æ¸²æŸ“ shouldYield()")]),n._v(" "),t("p",[n._v("åŒæ­¥æ‰§è¡Œæ„å»ºæ ‘")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("function performSyncWorkOnRoot(root) {\n\n  // 1. æ„å»ºæ ‘\n\n  /*\n\n    renderRootSync ä¼š è°ƒç”¨è¯¥æ–¹æ³• workLoopSync\n\n    while (workInProgress !== null) {\n\n      performUnitOfWork(workInProgress);\n\n    }\n\n  */\n\n  renderRootSync(root, lanes)\n\n  \n\n  // 2. è¾“å‡ºæ ‘ (å¯çœ‹ä¸‹åŒç¼“å­˜æœºåˆ¶)\n\n  finishedWork = root.current.alternate;\n\n}\n")])])]),t("p",[n._v("å¼‚æ­¥æ‰§è¡Œæ„å»ºæ ‘")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("function performConcurrentWorkOnRoot(root) {\n\n   // 1. æ„å»ºæ ‘\n\n   /*\n\n    renderRootConcurrent ä¼š è°ƒç”¨è¯¥æ–¹æ³• workLoopConcurrent\n\n    while (workInProgress !== null &&  !shouldYield() ) {\n\n      performUnitOfWork(workInProgress);\n\n    }\n\n  */\n\n   renderRootConcurrent(root, lanes);\n\n   // 2. è¾“å‡ºæ ‘ (å¯çœ‹ä¸‹åŒç¼“å­˜æœºåˆ¶)\n\n   finishConcurrentRender(root, exitStatus, lanes);\n\n   \n\n   // 3. check æ˜¯å¦è¿˜æœ‰å…¶ä»–æ›´æ–°, æ˜¯å¦éœ€è¦å‘èµ·æ–°è°ƒåº¦\n\n   ensureRootIsScheduled(root, now());\n\n    if (root.callbackNode === originalCallbackNode) {\n\n      // å½“å‰æ‰§è¡Œçš„ä»»åŠ¡è¢«ä¸­æ–­ï¼Œè¿”å›ä¸ªæ–°çš„ï¼Œå†æ¬¡æ¸²æŸ“ã€‚\n\n      return performConcurrentWorkOnRoot.bind(null, root);\n\n    }\n\n\n\n    return null;\n\n}\n")])])]),t("ol",[t("li",[n._v("ã€"),t("strong",[n._v("è¾“å‡º")]),n._v("ã€‘")])]),n._v(" "),t("p",[n._v("å°†å˜æ›´å†…å®¹ï¼Œè¾“å‡ºè‡³ç•Œé¢ã€‚è¯¦ç»†çœ‹ "),t("code",[n._v("commitRoot")]),n._v("æ–¹æ³•çš„å®ç°ã€‚è¿™é‡Œä¸åšæ‰©å±•ã€‚")]),n._v(" "),t("ol",[t("li",[n._v("å°æ€»ç»“")])]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h3",{attrs:{id:"_7-2-scheduler-è¿è¡Œæµç¨‹æµ…æ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-scheduler-è¿è¡Œæµç¨‹æµ…æ"}},[n._v("#")]),n._v(" 7.2 Scheduler è¿è¡Œæµç¨‹æµ…æ")]),n._v(" "),t("blockquote",[t("p",[t("strong",[n._v("workloop.js")]),n._v("[21]")])]),n._v(" "),t("p",[n._v("ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº†åŒæ­¥å’Œå¼‚æ­¥çš„ä»»åŠ¡ï¼Œå¼‚æ­¥ä»»åŠ¡æ˜¯å¯ä»¥ä¸­æ–­ä¸”éœ€è¦Scheduleré…åˆå¤„ç†ã€‚")]),n._v(" "),t("p",[n._v("æ³¨æ„åªæœ‰å¼‚æ­¥ä»»åŠ¡å³å¼€å¯äº†å¹¶å‘æ¨¡å¼ï¼Œæ‰ä¼šæœ‰æ—¶é—´åˆ†ç‰‡ã€‚")]),n._v(" "),t("p",[n._v("workLoopæ˜¯ å®ç°æ—¶é—´åˆ‡ç‰‡ å’Œ å¯ä¸­æ–­æ¸²æŸ“çš„æ ¸å¿ƒã€‚ä¹Ÿæ˜¯æˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„"),t("strong",[n._v("è™šæ‹Ÿæ ˆå¸§")]),n._v("çš„èƒ½åŠ› "),t("strong",[n._v("ã€‚")])]),n._v(" "),t("p",[n._v("ä»¥ä¸‹ä¸ºäº†è¯´æ˜ï¼Œç®€åŒ–æµç¨‹:")]),n._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("// å¹¶å‘ä»»åŠ¡çš„å…¥å£\n\nfunction workLoopConcurrent() {\n\n  // Perform work until Scheduler asks us to yield\n\n  // æœ‰ä»»åŠ¡ & æ˜¯å¦éœ€è¦ä¸­æ–­\n\n  while (workInProgress !== null && !shouldYield() ) {\n\n    performUnitOfWork(workInProgress);\n\n  }\n\n}\n\nconst scheduler = {\n\n    // ä»»åŠ¡æ”¾åˆ°é˜Ÿåˆ—é‡Œï¼Œç­‰å¾…ç©ºé—²æ‰§è¡Œ\n\n    taskQueue: [\n\n       {\n\n          // æ¯ä¸ªä»»åŠ¡æ˜¯ä¸ªå›è°ƒçš„æ¦‚å¿µ, ä¸”å›è°ƒä»»åŠ¡æ˜¯å¯ä¸­æ–­çš„\n\n          callback: workLoopConcurrent\n\n       }\n\n    ],\n\n\n    // åˆ¤æ–­: æ˜¯å¦éœ€è¦ä¸­æ–­, å°†æ§åˆ¶æƒäº¤ç»™ä¸»è¿›ç¨‹\n\n    shouldYieldToHost () {\n\n        // æ²¡æœ‰å‰©ä½™æ—¶é—´\n\n        if (currentTime >= deadline) {\n\n            // ä½†éœ€è¦æ¸²æŸ“ å’Œ æœ‰æ›´é«˜ä¼˜ä»»åŠ¡\n\n            if (needsPaint || scheduling.isInputPending()) {\n\n                return true; // ä¸­æ–­\n\n            }\n\n            // æ˜¯å¦è¶…è¿‡ 300ms\n\n            return currentTime >= maxYieldInterval;\n\n        }\n\n\n        // è¿˜æœ‰å‰©ä½™æ—¶é—´\n\n        return false;\n\n    },\n\n\n    // æ‰§è¡Œå…¥å£å¯è§\n\n    workLoop () {\n\n        // å½“å‰ç¬¬ä¸€ä¸ªä»»åŠ¡\n\n        currentTask = taskQueue[0];\n\n \n        // æ¯æ¬¡ currentTask é€€å‡º å°±æ˜¯ä¸€ä¸ªæ—¶é—´åˆ‡åˆ‡ç‰‡\n\n        while(currentTask !== null) {\n\n            // ä»»åŠ¡æ²¡æœ‰è¿‡æœŸ, ä½†ä¸€å¸§å·²ç»æ— å¯ç”¨æ—¶é—´ æˆ– éœ€è¦è¢«ä¸­æ–­, åˆ™è®©å‡ºä¸»çº¿ç¨‹\n\n            // æ¯ä¸€æ¬¡æ‰§è¡Œå‡è¿›è¡Œè¶…æ—¶æ£€æµ‹ï¼Œåšåˆ°è®©å‡ºä¸»çº¿ç¨‹ã€‚\n\n            if (currentTask.expirationTime > currentTime\n\n && (!hasTimeRemaining || shouldYieldToHost())) {\n\n break\n\n }\n\n            // æ‰§è¡Œä»»åŠ¡\n\n            const callback = currentTask.callback;\n\n            const continuationCallback = callback(didUserCallbackTimeout);\n\n            // å¦‚æœè¯¥ä»»åŠ¡å, è¿˜æœ‰è¿ç»­å›è°ƒ\n\n            if (typeof continuationCallback === 'function') {\n\n                // åˆ™ä¿ç•™å½“å‰\n\n                currentTask.callback = continuationCallback;\n\n            } else  {\n\n                // å°†currentTaskç§»é™¤è¯¥é˜Ÿåˆ—\n\n                pop(taskQueue);\n\n            }\n\n\n            // æ›´æ–°currentTask\n\n            currentTask = peek(taskQueue);\n\n        }\n\n    },\n\n}\n")])])]),t("p",[n._v("ç®€è€Œè¨€ä¹‹:")]),n._v(" "),t("ol",[t("li",[t("p",[n._v("æœ‰ä¸ªä»»åŠ¡é˜Ÿåˆ— queueï¼Œè¯¥é˜Ÿåˆ—å­˜æ”¾å¯ä¸­æ–­çš„ä»»åŠ¡ã€‚")])]),n._v(" "),t("li",[t("p",[t("code",[n._v("workLoop")]),n._v("å¯¹é˜Ÿåˆ—é‡Œå–ç¬¬ä¸€ä¸ªä»»åŠ¡currentTaskï¼Œè¿›å…¥å¾ªç¯å¼€å§‹æ‰§è¡Œã€‚")])]),n._v(" "),t("li",[t("ul",[t("li",[n._v("å¦‚æœä»»åŠ¡æ‰§è¡Œå®Œåï¼Œè¿˜æœ‰è¿ç»­çš„å›è°ƒï¼Œåˆ™ currentTask.callback = continuationCallback")]),n._v(" "),t("li",[n._v("å¦åˆ™ç§»é™¤å·²å®Œæˆçš„ä»»åŠ¡")]),n._v(" "),t("li",[n._v("å½“è¯¥ä»»åŠ¡æ²¡æœ‰æ—¶é—´ æˆ– éœ€è¦ä¸­æ–­ (æ¸²æŸ“ä»»åŠ¡ æˆ– å…¶ä»–é«˜ä¼˜ä»»åŠ¡æ’å…¥ç­‰)ï¼Œåˆ™è®©å‡ºä¸»çº¿ç¨‹ã€‚")]),n._v(" "),t("li",[n._v("å¦åˆ™æ‰§è¡Œä»»åŠ¡ currentTask.callback()")]),n._v(" "),t("li",[n._v("æ›´æ–°ä»»åŠ¡currentTaskï¼Œç»§ç»­å¾ªç¯èµ°èµ·ã€‚")])])])]),n._v(" "),t("p",[n._v("è¿™é‡Œè¿˜æ¶‰åŠæ›´å¤šç»†èŠ‚ï¼Œä¾‹å¦‚:")]),n._v(" "),t("ul",[t("li",[n._v("requestAnimationFrame è®¡ç®—ä¸€å¸§çš„ç©ºä½™æ—¶é—´ï¼›")]),n._v(" "),t("li",[n._v("ä½¿ç”¨new MessageChannel () æ‰§è¡Œå®ä»»åŠ¡;")]),n._v(" "),t("li",[n._v("ä¼˜å…ˆçº§;")]),n._v(" "),t("li",[n._v("...")])]),n._v(" "),t("p",[n._v("è¿™é‡Œä¸åšè¯¦ç»†è¯´æ˜ã€‚")]),n._v(" "),t("h2",{attrs:{id:"_8-å°æ€»ç»“"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-å°æ€»ç»“"}},[n._v("#")]),n._v(" 8.å°æ€»ç»“")]),n._v(" "),t("ul",[t("li",[n._v("æˆ‘ä»¬æƒ³è¦å®ç°"),t("strong",[n._v("å¹¶å‘")]),n._v("è¯‰æ±‚ï¼Œå°±éœ€è¦ä»åº•å±‚é‡æ„ï¼Œå³"),t("strong",[n._v("FiberNode")]),n._v("çš„å®ç°ã€‚")]),n._v(" "),t("li",[n._v("è°ƒç”¨æ ˆcall stackæ˜¯æ— æ³•åšåˆ°å¹¶å‘ (å¼‚æ­¥å¯ä¸­æ–­) è¯‰æ±‚ï¼Œæ•…Reactè‡ªè¡Œå®ç°äº†ä¸€å¥—"),t("strong",[n._v("è™šæ‹Ÿæ ˆå¸§ã€‚")])]),n._v(" "),t("li",[t("strong",[n._v("è™šæ‹Ÿæ ˆå¸§")]),n._v(" æ˜¯è¦å…·å¤‡"),t("strong",[n._v("è°ƒåº¦")]),n._v("èƒ½åŠ›çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚ä½•åœ¨é€‚å½“çš„æ—¶å€™å»æ‰§è¡Œä»»åŠ¡ã€‚")]),n._v(" "),t("li",[t("strong",[n._v("scheduler")]),n._v(" å¯åšåˆ°å¼‚æ­¥å¯ä¸­æ–­ï¼Œå¹¶å¯è‡ªä¸»åˆ†é…ä¼˜å…ˆçº§é«˜ä½çš„ä»»åŠ¡ã€‚")])]),n._v(" "),t("p",[n._v("(å³ä»»åŠ¡ (çŠ¶æ€: è¿è¡Œ/ä¸­æ–­/ç»§ç»­) "),t("strong",[n._v("Lane")]),n._v("è¿è¡Œç­–ç•¥)")]),n._v(" "),t("p",[n._v("(å®é™…ä¸Šï¼Œscheduler + Lane è°ƒåº¦ç­–ç•¥è¿œæ¯”è¯¥å¤„ç†å¤æ‚çš„å¤šğŸ˜­)")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("å›¾: å‰åå¯¹æ¯” (ä¸ªäººç†è§£, é”™è¯¯è¯·æŒ‡æ­£)")]),n._v(" "),t("p",[n._v("ä»¥ä¸Šï¼ŒåŒå­¦ä»¬æ˜¯ä¸æ˜¯å¯¹React Fiberæ¶æ„æœ‰äº†åˆæ­¥çš„ç†è§£å“¦~")]),n._v(" "),t("h1",{attrs:{id:"å…¶ä»–è¯´æ˜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å…¶ä»–è¯´æ˜"}},[n._v("#")]),n._v(" å…¶ä»–è¯´æ˜")]),n._v(" "),t("h3",{attrs:{id:"åŒç¼“å­˜æœºåˆ¶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#åŒç¼“å­˜æœºåˆ¶"}},[n._v("#")]),n._v(" åŒç¼“å­˜æœºåˆ¶")]),n._v(" "),t("blockquote",[t("p",[n._v("å‚è€ƒ: "),t("strong",[n._v("åŒç¼“å­˜Fiberæ ‘")]),n._v("[22]")])]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("è‡³å¤šæœ‰ä¸¤æ£µ Fiber Treeã€‚")]),n._v(" "),t("p",[n._v("åˆ†åˆ«å«åšcurrent fiber tree å’Œ workInProgress fiber treeã€‚")]),n._v(" "),t("p",[n._v("å³åœ¨å±å¹•ä¸Šå·²å»ºç«‹çš„fiber tree å’Œ å› ä¸ºæ•°æ®å˜åŒ–é‡æ–°åœ¨å†…å­˜é‡Œåˆ›å»ºçš„fiber treeã€‚")]),n._v(" "),t("p",[n._v("ä»–ä»¬ä¹‹é—´æ˜¯é€šè¿‡ alternateå±æ€§(æŒ‡é’ˆ) å»ºç«‹è¿æ¥ã€‚")]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("p",[n._v("ç®€å•çš„è¯´:")]),n._v(" "),t("ol",[t("li",[n._v("å°±æ˜¯workInProgress fiberçš„åˆ›å»º "),t("strong",[n._v("æ˜¯å¦å¯å¤ç”¨")]),n._v(" current fiberçš„èŠ‚ç‚¹ã€‚åç»­å¯å†è¯¦çœ‹diffç®—æ³•ã€‚")]),n._v(" "),t("li",[n._v("workInProgress fiber tree å°†ç¡®å®šè¦å˜æ›´èŠ‚ç‚¹ï¼Œæ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚")]),n._v(" "),t("li",[n._v("workInProgress fiber tree æ™‹å‡ä¸º current fiber treeã€‚")])]),n._v(" "),t("p",[t("img",{attrs:{src:"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==",alt:"å›¾ç‰‡"}})]),n._v(" "),t("h3",{attrs:{id:"å‚è€ƒèµ„æ–™"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#å‚è€ƒèµ„æ–™"}},[n._v("#")]),n._v(" å‚è€ƒèµ„æ–™")]),n._v(" "),t("p",[n._v("[1]ä»å†…éƒ¨äº†è§£ç°ä»£æµè§ˆå™¨(3): "),t("em",[n._v("https://juejin.cn/post/6844903687383416840")]),n._v("[2]æ¸²æŸ“æ ‘æ„å»ºã€å¸ƒå±€åŠç»˜åˆ¶: "),t("em",[n._v("https://developers.google.com/web/fundamentals/performance/critical-rendering-path/render-tree-construction")]),n._v("[3]RequestIdleCallback å®éªŒ: "),t("em",[n._v("https://github.com/Linjiayu6/FE-RequestIdleCallback-demo")]),n._v("[4]RequestIdleCallback: "),t("em",[n._v("https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback")]),n._v("[5]RequestIdleCallback: "),t("em",[n._v("https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback")]),n._v("[6]RequestIdleCallback å®éªŒ: "),t("em",[n._v("https://github.com/Linjiayu6/FE-RequestIdleCallback-demo")]),n._v("[7]React: stack reconcilerå®ç°: "),t("em",[n._v("https://zh-hans.reactjs.org/docs/implementation-notes.html")]),n._v("[8]React ç®—æ³•ä¹‹æ·±åº¦ä¼˜å…ˆéå†: "),t("em",[n._v("https://juejin.cn/post/6912280245055782920")]),n._v("[9]è°ƒç”¨æ ˆ: "),t("em",[n._v("https://segmentfault.com/a/1190000010360316")]),n._v("[10]Leetcode: æ–æ³¢æ‹‰å¥‘æ•°åˆ—: "),t("em",[n._v("https://leetcode-cn.com/problems/fei-bo-na-qi-shu-lie-lcof/")]),n._v("[11]Leetcode: 70. çˆ¬æ¥¼æ¢¯: "),t("em",[n._v("https://leetcode-cn.com/problems/climbing-stairs/")]),n._v("[12]ReactFiberWorkLoop.old.js: "),t("em",[n._v("https://github.com/facebook/react/blob/v17.0.1/packages/react-reconciler/src/ReactFiberWorkLoop.old.js#L1558")]),n._v("[13]program: "),t("em",[n._v("https://en.wikipedia.org/wiki/Computer_program")]),n._v("[14]algorithm: "),t("em",[n._v("https://en.wikipedia.org/wiki/Algorithm")]),n._v("[15]problem: "),t("em",[n._v("https://en.wikipedia.org/wiki/Problem_solving")]),n._v("[16]partial order: "),t("em",[n._v("https://en.wikipedia.org/wiki/Partial_Order")]),n._v("[17]Call Stack: "),t("em",[n._v("https://segmentfault.com/a/1190000021456103")]),n._v("[18]FiberNode.js: "),t("em",[n._v("https://github.com/facebook/react/blob/1fb18e22ae66fdb1dc127347e169e73948778e5a/packages/react-reconciler/src/ReactFiber.new.js#L117")]),n._v("[19]beginWork(): "),t("em",[n._v("https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberBeginWork.new.js#L3058")]),n._v("[20]completeWork(): "),t("em",[n._v("https://github.com/facebook/react/blob/970fa122d8188bafa600e9b5214833487fbf1092/packages/react-reconciler/src/ReactFiberCompleteWork.new.js#L652")]),n._v("[21]workloop.js: "),t("em",[n._v("https://github.com/facebook/react/blob/v17.0.1/packages/scheduler/src/Scheduler.js#L164")]),n._v("[22]åŒç¼“å­˜Fiberæ ‘: "),t("em",[n._v("https://react.iamkasong.com/process/doubleBuffer.html#update%E6%97%B6")])])])}),[],!1,null,null,null);e.default=a.exports}}]);