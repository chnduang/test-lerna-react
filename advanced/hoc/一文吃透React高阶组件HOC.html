<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶HOC | duangdongçš„react</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="reactç›¸å…³çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="react,reactè¿›é˜¶,reactæ€§èƒ½ä¼˜åŒ–,react-hooks,reactæºç ">
    
    <link rel="preload" href="/assets/css/0.styles.a427ee9b.css" as="style"><link rel="preload" href="/assets/js/app.c06c5691.js" as="script"><link rel="preload" href="/assets/js/2.e21ead49.js" as="script"><link rel="preload" href="/assets/js/10.b9a4c71a.js" as="script"><link rel="prefetch" href="/assets/js/11.f55d2255.js"><link rel="prefetch" href="/assets/js/12.fe15bcdc.js"><link rel="prefetch" href="/assets/js/13.87a3c5ce.js"><link rel="prefetch" href="/assets/js/14.ebf89fa4.js"><link rel="prefetch" href="/assets/js/15.cda0a8ba.js"><link rel="prefetch" href="/assets/js/16.f9dc23dc.js"><link rel="prefetch" href="/assets/js/17.84340ca0.js"><link rel="prefetch" href="/assets/js/18.bd273a95.js"><link rel="prefetch" href="/assets/js/19.81155919.js"><link rel="prefetch" href="/assets/js/20.9fd76e46.js"><link rel="prefetch" href="/assets/js/21.ace06104.js"><link rel="prefetch" href="/assets/js/22.90ade980.js"><link rel="prefetch" href="/assets/js/23.0666abd7.js"><link rel="prefetch" href="/assets/js/24.a72c373a.js"><link rel="prefetch" href="/assets/js/25.b969cb94.js"><link rel="prefetch" href="/assets/js/26.de056b27.js"><link rel="prefetch" href="/assets/js/27.c42084cb.js"><link rel="prefetch" href="/assets/js/28.4837174d.js"><link rel="prefetch" href="/assets/js/29.ff25f8d5.js"><link rel="prefetch" href="/assets/js/3.860eacbd.js"><link rel="prefetch" href="/assets/js/30.713760c5.js"><link rel="prefetch" href="/assets/js/31.7c617c61.js"><link rel="prefetch" href="/assets/js/32.d175bcfe.js"><link rel="prefetch" href="/assets/js/33.74590403.js"><link rel="prefetch" href="/assets/js/34.83533364.js"><link rel="prefetch" href="/assets/js/35.074e3e13.js"><link rel="prefetch" href="/assets/js/36.1ccfc83b.js"><link rel="prefetch" href="/assets/js/37.a396d472.js"><link rel="prefetch" href="/assets/js/38.db4bd748.js"><link rel="prefetch" href="/assets/js/39.df82dded.js"><link rel="prefetch" href="/assets/js/4.8f6f0475.js"><link rel="prefetch" href="/assets/js/40.c748e8b5.js"><link rel="prefetch" href="/assets/js/5.8b87f02a.js"><link rel="prefetch" href="/assets/js/6.2f86309f.js"><link rel="prefetch" href="/assets/js/7.f1cc41de.js"><link rel="prefetch" href="/assets/js/8.9c653580.js"><link rel="prefetch" href="/assets/js/9.af331656.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a427ee9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdongçš„react</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fiber/" class="nav-link">
  Fiber
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link router-link-active">
  è¿›é˜¶
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fiber/" class="nav-link">
  Fiber
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link router-link-active">
  è¿›é˜¶
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/advanced/" aria-current="page" class="sidebar-link">è¿›é˜¶</a></li><li><a href="/advanced/Renderå¦‚ä½•å¼ºåˆ¶å®ƒ.html" class="sidebar-link">ä»€ä¹ˆæ˜¯ React ä¸­çš„ Render ä»¥åŠå¦‚ä½•å¼ºåˆ¶å®ƒï¼Ÿ</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>hoc</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced/hoc/ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶HOC.html" class="active sidebar-link">ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶HOC</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-1.html" class="sidebar-link">ä»mixinåˆ°hocå†åˆ°hook-1</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-2.html" class="sidebar-link">ä» mixin åˆ° hoc å†åˆ° hook-2</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-3.html" class="sidebar-link">ä» mixin åˆ° hoc å†åˆ° hook-3</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-4.html" class="sidebar-link">ä» mixin åˆ° hoc å†åˆ° hook-4</a></li><li><a href="/advanced/hoc/è¯´è¯´å¯¹é«˜é˜¶ç»„ä»¶çš„ç†è§£.html" class="sidebar-link">è¯´è¯´å¯¹é«˜é˜¶ç»„ä»¶çš„ç†è§£ï¼Ÿåº”ç”¨åœºæ™¯?</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>keys</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/advanced/react-svelteå…¥é—¨.html" class="sidebar-link">å†™ç»™ React å¼€å‘è€…çœ‹çš„ Svelteå…¥é—¨</a></li><li><a href="/advanced/react16å¸¸è§apiä»¥åŠåŸç†å‰–æ.html" class="sidebar-link">react16å¸¸è§apiä»¥åŠåŸç†å‰–æ</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>setstate</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/advanced/äº”åˆ†é’Ÿå¸¦ä½ æŒæ¡ä¼˜å…ˆé˜Ÿåˆ—.html" class="sidebar-link">äº”åˆ†é’Ÿå¸¦ä½ æŒæ¡ä¼˜å…ˆé˜Ÿåˆ—</a></li><li><a href="/advanced/å‰ç«¯æ¶æ„ä¹‹Reacté¢†åŸŸé©±åŠ¨è®¾è®¡.html" class="sidebar-link">å‰ç«¯æ¶æ„ä¹‹ React é¢†åŸŸé©±åŠ¨è®¾è®¡</a></li><li><a href="/advanced/å­¦å¥½è¿™äº›Reactè®¾è®¡æ¨¡å¼.html" class="sidebar-link">å­¦å¥½è¿™äº›Reactè®¾è®¡æ¨¡å¼-èƒ½è®©ä½ çš„ React é¡¹ç›®é£èµ·æ¥</a></li><li><a href="/advanced/æµ…è°ˆReactä¸­çš„XSSæ”»å‡».html" class="sidebar-link">æµ…è°ˆ React ä¸­çš„ XSS æ”»å‡»</a></li><li><a href="/advanced/é”™è¯¯è¾¹ç•Œ.html" class="sidebar-link">é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ä¸€æ–‡åƒé€reacté«˜é˜¶ç»„ä»¶hoc"><a href="#ä¸€æ–‡åƒé€reacté«˜é˜¶ç»„ä»¶hoc" class="header-anchor">#</a> ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶HOC</h1> <blockquote><p><a href="https://mp.weixin.qq.com/s/W5pk2fuCHuRqPizwlnUnIQ" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/W5pk2fuCHuRqPizwlnUnIQ<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h1 id="ä¸€-å‰è¨€"><a href="#ä¸€-å‰è¨€" class="header-anchor">#</a> ä¸€ å‰è¨€</h1> <p><code>React</code>é«˜é˜¶ç»„ä»¶(<code>HOC</code>)ï¼Œå¯¹äºå¾ˆå¤š<code>react</code>å¼€å‘è€…æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œå®ƒæ˜¯çµæ´»ä½¿ç”¨<code>react</code>ç»„ä»¶çš„ä¸€ç§æŠ€å·§ï¼Œé«˜é˜¶ç»„ä»¶æœ¬èº«ä¸æ˜¯ç»„ä»¶ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‚æ•°ä¸ºç»„ä»¶ï¼Œè¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªç»„ä»¶çš„å‡½æ•°ã€‚é«˜é˜¶ä½œç”¨ç”¨äº<strong>å¼ºåŒ–ç»„ä»¶ï¼Œå¤ç”¨é€»è¾‘ï¼Œæå‡æ¸²æŸ“æ€§èƒ½ç­‰</strong>ä½œç”¨ã€‚é«˜é˜¶ç»„ä»¶ä¹Ÿå¹¶ä¸æ˜¯å¾ˆéš¾ç†è§£ï¼Œå…¶å®æ¥è§¦è¿‡åè¿˜æ˜¯è›®ç®€å•çš„ï¼Œæ¥ä¸‹æ¥æˆ‘å°†æŒ‰ç…§ï¼Œ<strong>é«˜é˜¶ç»„ä»¶ç†è§£ï¼Ÿ</strong>ï¼Œ<strong>é«˜é˜¶ç»„ä»¶å…·ä½“æ€ä¹ˆä½¿ç”¨ï¼Ÿåº”ç”¨åœºæ™¯</strong>ï¼Œ <strong>é«˜é˜¶ç»„ä»¶å®è·µ(æºç çº§åˆ«)</strong> ä¸ºçªç ´å£ï¼Œå¸¦å¤§å®¶è¯¦ç»†äº†è§£ä¸€ä¸‹é«˜é˜¶ç»„ä»¶ã€‚æœ¬æ–‡ç¯‡å¹…æ¯”è¾ƒé•¿ï¼Œå»ºè®®æ”¶è—è§‚çœ‹</p> <p>æˆ‘ä»¬å¸¦ç€é—®é¢˜å»å¼€å§‹ä»Šå¤©çš„è®¨è®ºï¼š</p> <ul><li>1 ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶ï¼Œå®ƒè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</li> <li>2 æœ‰å‡ ç§é«˜é˜¶ç»„ä»¶ï¼Œå®ƒä»¬ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li> <li>3 å¦‚ä½•å†™ä¸€ä¸ªä¼˜ç§€é«˜é˜¶ç»„ä»¶ï¼Ÿ</li> <li>4 <code>hoc</code>æ€ä¹ˆå¤„ç†é™æ€å±æ€§ï¼Œè·¨å±‚çº§<code>ref</code>ç­‰é—®é¢˜ï¼Ÿ</li> <li>5 é«˜é˜¶ç»„ä»¶æ€ä¹ˆæ§åˆ¶æ¸²æŸ“ï¼Œéš”ç¦»æ¸²æŸ“ï¼Ÿ</li> <li>6 é«˜é˜¶ç»„ä»¶æ€ä¹ˆç›‘æ§åŸå§‹ç»„ä»¶çš„çŠ¶æ€ï¼Ÿ</li> <li>...</li></ul> <blockquote><p>é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰æ˜¯ React ä¸­ç”¨äºå¤ç”¨ç»„ä»¶é€»è¾‘çš„ä¸€ç§é«˜çº§æŠ€å·§ã€‚HOC è‡ªèº«ä¸æ˜¯ React API çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä¸€ç§åŸºäº React çš„ç»„åˆç‰¹æ€§è€Œå½¢æˆçš„è®¾è®¡æ¨¡å¼ã€‚</p></blockquote> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdwcFr2v6wCVYKr2wsh0KZRXvHqmbKib3PNgQiaxiaJ5dZYicz6nNNIzJR8beFsTUbDcvrh8hxSYMFGQXw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h1 id="äºŒ-å…¨æ–¹ä½çœ‹é«˜é˜¶ç»„ä»¶"><a href="#äºŒ-å…¨æ–¹ä½çœ‹é«˜é˜¶ç»„ä»¶" class="header-anchor">#</a> äºŒ å…¨æ–¹ä½çœ‹é«˜é˜¶ç»„ä»¶</h1> <h2 id="_1-å‡ ç§åŒ…è£…å¼ºåŒ–ç»„ä»¶çš„æ–¹å¼"><a href="#_1-å‡ ç§åŒ…è£…å¼ºåŒ–ç»„ä»¶çš„æ–¹å¼" class="header-anchor">#</a> 1 å‡ ç§åŒ…è£…å¼ºåŒ–ç»„ä»¶çš„æ–¹å¼</h2> <h3 id="_1-mixinæ¨¡å¼"><a href="#_1-mixinæ¨¡å¼" class="header-anchor">#</a> â‘  mixinæ¨¡å¼</h3> <p><strong>åŸå‹å›¾</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdwcFr2v6wCVYKr2wsh0KZRXFKuSNPhezUhs2TNsfnfIjmeqFfqQdM6zcOxANCuNEcBwAaR928UtsQ/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <h4 id="è€ç‰ˆæœ¬çš„react-mixins"><a href="#è€ç‰ˆæœ¬çš„react-mixins" class="header-anchor">#</a> è€ç‰ˆæœ¬çš„<code>react-mixins</code></h4> <p>åœ¨<code>react</code>åˆæœŸæä¾›ä¸€ç§ç»„åˆæ–¹æ³•ã€‚é€šè¿‡<code>React.createClass</code>,åŠ å…¥<code>mixins</code>å±æ€§ï¼Œå…·ä½“ç”¨æ³•å’Œ<code>vue</code> ä¸­<code>mixins</code>ç›¸ä¼¼ã€‚å…·ä½“å®ç°å¦‚ä¸‹ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>const customMixin = {  componentDidMount(){    console.log( '------componentDidMount------' )  },  say(){    console.log(this.state.name)  }}
const APP = React.createClass({  mixins: [ customMixin ],  getInitialState(){    return {      name:'alien'    }  },  render(){    const { name  } = this.state    return &lt;div&gt; hello ,world , my name is { name } &lt;/div&gt;  }})
</code></pre></div><p>è¿™ç§<code>mixins</code>åªèƒ½å­˜åœ¨<code>createClass</code>ä¸­ï¼Œåæ¥<code>React.createClass</code>è¿åŒ<code>mixins</code>è¿™ç§æ¨¡å¼è¢«åºŸå¼ƒäº†ã€‚<code>mixins</code>ä¼šå¸¦æ¥ä¸€äº›è´Ÿé¢çš„å½±å“ã€‚</p> <ul><li>1 mixinå¼•å…¥äº†éšå¼ä¾èµ–å…³ç³»ã€‚</li> <li>2 ä¸åŒmixinsä¹‹é—´å¯èƒ½ä¼šæœ‰å…ˆåé¡ºåºç”šè‡³ä»£ç å†²çªè¦†ç›–çš„é—®é¢˜</li> <li>3 mixinä»£ç ä¼šå¯¼è‡´æ»šé›ªçƒå¼çš„å¤æ‚æ€§</li></ul> <h4 id="è¡ç”Ÿæ–¹å¼"><a href="#è¡ç”Ÿæ–¹å¼" class="header-anchor">#</a> è¡ç”Ÿæ–¹å¼</h4> <p><code>createClass</code>çš„åºŸå¼ƒï¼Œä¸ä»£è¡¨<code>mixin</code>æ¨¡å¼é€€å‡º<code>react</code>èˆå°ï¼Œåœ¨æœ‰çŠ¶æ€ç»„ä»¶<code>class</code>ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<strong>åŸå‹é“¾ç»§æ‰¿</strong>æ¥å®ç°<code>mixins</code>ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>const customMixin = {  /* è‡ªå®šä¹‰ mixins */  componentDidMount(){    console.log( '------componentDidMount------' )  },  say(){    console.log(this.state.name)  }}
function componentClassMixins(Component,mixin){ /* ç»§æ‰¿ */  for(let key in mixin){    Component.prototype[key] = mixin[key]  }}
class Index extends React.Component{  constructor(){    super()    this.state={  name:'alien' }  }  render(){    return &lt;div&gt; hello,world      &lt;button onClick={ this.say.bind(this) } &gt; to say &lt;/button&gt;    &lt;/div&gt;  }}componentClassMixins(Index,customMixin)
</code></pre></div><h3 id="_2extendsç»§æ‰¿æ¨¡å¼"><a href="#_2extendsç»§æ‰¿æ¨¡å¼" class="header-anchor">#</a> â‘¡extendsç»§æ‰¿æ¨¡å¼</h3> <p><strong>åŸå‹å›¾</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdwcFr2v6wCVYKr2wsh0KZRXy6wIa4Xf7Sdop92zIlibRNia5ufhqNanetpjPSb4Kx5uvaBThWNicwpjw/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p>åœ¨<code>class</code>ç»„ä»¶ç››è¡Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»§æ‰¿çš„æ–¹å¼è¿›ä¸€æ­¥çš„å¼ºåŒ–æˆ‘ä»¬çš„ç»„ä»¶ã€‚è¿™ç§æ¨¡å¼çš„å¥½å¤„åœ¨äºï¼Œå¯ä»¥å°è£…åŸºç¡€åŠŸèƒ½ç»„ä»¶ï¼Œç„¶åæ ¹æ®éœ€è¦å»<code>extends</code>æˆ‘ä»¬çš„åŸºç¡€ç»„ä»¶ï¼ŒæŒ‰éœ€å¼ºåŒ–ç»„ä»¶ï¼Œä½†æ˜¯å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¿…é¡»è¦å¯¹åŸºç¡€ç»„ä»¶æœ‰è¶³å¤Ÿçš„æŒæ¡ï¼Œå¦åˆ™ä¼šé€ æˆä¸€äº›åˆ—æ„æƒ³ä¸åˆ°çš„æƒ…å†µå‘ç”Ÿã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>class Base extends React.Component{  constructor(){    super()    this.state={      name:'alien'    }  }  say(){    console.log('base components')  }  render(){    return &lt;div&gt; hello,world &lt;button onClick={ this.say.bind(this) } &gt;ç‚¹å‡»&lt;/button&gt;  &lt;/div&gt;  }}class Index extends Base{  componentDidMount(){    console.log( this.state.name )  }  say(){ /* ä¼šè¦†ç›–åŸºç±»ä¸­çš„ say  */    console.log('extends components')  }}export default Index
</code></pre></div><h3 id="_3hocæ¨¡å¼"><a href="#_3hocæ¨¡å¼" class="header-anchor">#</a> â‘¢HOCæ¨¡å¼</h3> <p><strong>åŸå‹å›¾</strong></p> <p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/2KticQlBJtdwcFr2v6wCVYKr2wsh0KZRXYs6OvOe4Jzm27Vl3bXG29H12prn2V3n5IicRuicMJJvUciagxmiamn5SPg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="å›¾ç‰‡"></p> <p><code>HOC</code>æ˜¯æˆ‘ä»¬æœ¬ç« ä¸»è¦çš„è®²çš„å†…å®¹ï¼Œå…·ä½“ç”¨æ³•ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šæ…¢æ…¢é“æ¥ï¼Œæˆ‘ä»¬å…ˆç®€å•å°è¯•ä¸€ä¸ª<code>HOC</code>ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC(Component) {  return class wrapComponent extends React.Component{     constructor(){       super()       this.state={         name:'alien'       }     }     render=()=&gt;&lt;Component { ...this.props } { ...this.state } /&gt;  }}
@HOCclass Index extends React.Component{  say(){    const { name } = this.props    console.log(name)  }  render(){    return &lt;div&gt; hello,world &lt;button onClick={ this.say.bind(this) } &gt;ç‚¹å‡»&lt;/button&gt;  &lt;/div&gt;  }}
</code></pre></div><h3 id="_4è‡ªå®šä¹‰hooksæ¨¡å¼"><a href="#_4è‡ªå®šä¹‰hooksæ¨¡å¼" class="header-anchor">#</a> â‘£è‡ªå®šä¹‰hooksæ¨¡å¼</h3> <p><strong>åŸå‹å›¾</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p><code>hooks</code>çš„è¯ç”Ÿï¼Œä¸€å¤§éƒ¨åˆ†åŸå› æ˜¯è§£å†³<strong>æ— çŠ¶æ€ç»„ä»¶æ²¡æœ‰<code>state</code>**å’Œ**é€»è¾‘éš¾ä»¥å¤ç”¨</strong>é—®é¢˜ã€‚<code>hooks</code>å¯ä»¥å°†ä¸€æ®µé€»è¾‘å°è£…èµ·æ¥ï¼Œåšåˆ°å¼€ç®±å³ç”¨ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¤šè®²äº†ï¼Œæ¥ä¸‹æ¥ä¼šå‡º<code>react-hooks</code>åŸç†çš„æ–‡ç« ï¼Œå®Œæˆ<code>react-hooks</code>ä¸‰éƒ¨æ›²ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ç¬”è€…çš„å¦å¤–äºŒç¯‡æ–‡ç« ï¼Œé‡Œé¢è¯¦ç»†ä»‹ç»äº†<code>react-hooks</code>å¤ç”¨ä»£ç é€»è¾‘çš„åŸåˆ™å’Œæ–¹æ¡ˆã€‚</p> <p>ä¼ é€é—¨ï¼š</p> <p>ç©è½¬react-hooks,è‡ªå®šä¹‰hooksè®¾è®¡æ¨¡å¼åŠå…¶å®æˆ˜</p> <p>react-hookså¦‚ä½•ä½¿ç”¨ï¼Ÿ</p> <h2 id="_2-é«˜é˜¶ç»„ä»¶äº§ç”Ÿåˆè¡·"><a href="#_2-é«˜é˜¶ç»„ä»¶äº§ç”Ÿåˆè¡·" class="header-anchor">#</a> 2 é«˜é˜¶ç»„ä»¶äº§ç”Ÿåˆè¡·</h2> <p>ç»„ä»¶æ˜¯æŠŠ<code>prop</code>æ¸²æŸ“æˆ<code>UI</code>,è€Œé«˜é˜¶ç»„ä»¶æ˜¯å°†ç»„ä»¶è½¬æ¢æˆå¦å¤–ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬æ›´åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç»è¿‡åŒ…è£…åçš„ç»„ä»¶ï¼Œè·å¾—äº†é‚£äº›å¼ºåŒ–,èŠ‚çœå¤šå°‘é€»è¾‘ï¼Œæˆ–æ˜¯è§£å†³äº†åŸæœ‰ç»„ä»¶çš„é‚£äº›ç¼ºé™·ï¼Œè¿™å°±æ˜¯é«˜é˜¶ç»„ä»¶çš„æ„ä¹‰ã€‚æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹é«˜é˜¶ç»„ä»¶ç©¶ç«Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ğŸ¤”ğŸ¤”ğŸ¤”ï¼Ÿ</p> <p><strong>â‘  å¤ç”¨é€»è¾‘</strong>ï¼šé«˜é˜¶ç»„ä»¶æ›´åƒæ˜¯ä¸€ä¸ªåŠ å·¥<code>react</code>ç»„ä»¶çš„å·¥å‚ï¼Œæ‰¹é‡å¯¹åŸæœ‰ç»„ä»¶è¿›è¡Œ<strong>åŠ å·¥</strong>ï¼Œ<strong>åŒ…è£…</strong>å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶åŒ–ä¸“å±çš„<code>HOC</code>,è¿™æ ·å¯ä»¥è§£å†³å¤ç”¨é€»è¾‘ã€‚</p> <p><strong>â‘¡ å¼ºåŒ–props</strong>ï¼šè¿™ä¸ªæ˜¯<code>HOC</code>æœ€å¸¸ç”¨çš„ç”¨æ³•ä¹‹ä¸€ï¼Œé«˜é˜¶ç»„ä»¶è¿”å›çš„ç»„ä»¶ï¼Œå¯ä»¥åŠ«æŒä¸Šä¸€å±‚ä¼ è¿‡æ¥çš„<code>props</code>,ç„¶åæ··å…¥æ–°çš„<code>props</code>,æ¥å¢å¼ºç»„ä»¶çš„åŠŸèƒ½ã€‚ä»£è¡¨ä½œ<code>react-router</code>ä¸­çš„<code>withRouter</code>ã€‚</p> <p><strong>â‘¢ èµ‹èƒ½ç»„ä»¶</strong>ï¼š<code>HOC</code>æœ‰ä¸€é¡¹ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥ç»™è¢«<code>HOC</code>åŒ…è£¹çš„ä¸šåŠ¡ç»„ä»¶ï¼Œæä¾›ä¸€äº›æ‹“å±•åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´<strong>é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¢å¤–çš„äº‹ä»¶</strong>ï¼Œä½†æ˜¯è¿™ç§<code>HOC</code>ï¼Œå¯èƒ½éœ€è¦å’Œä¸šåŠ¡ç»„ä»¶ç´§å¯†ç»“åˆã€‚å…¸å‹æ¡ˆä¾‹<code>react-keepalive-router</code>ä¸­çš„ <code>keepaliveLifeCycle</code>å°±æ˜¯é€šè¿‡<code>HOC</code>æ–¹å¼ï¼Œç»™ä¸šåŠ¡ç»„ä»¶å¢åŠ äº†é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸã€‚</p> <p><strong>â‘£ æ§åˆ¶æ¸²æŸ“</strong>ï¼šåŠ«æŒæ¸²æŸ“æ˜¯<code>hoc</code>ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨<code>wrapComponent</code>åŒ…è£…ç»„ä»¶ä¸­ï¼Œå¯ä»¥å¯¹åŸæ¥çš„ç»„ä»¶ï¼Œè¿›è¡Œ<code>æ¡ä»¶æ¸²æŸ“</code>ï¼Œ<code>èŠ‚æµæ¸²æŸ“</code>ï¼Œ<code>æ‡’åŠ è½½</code>ç­‰åŠŸèƒ½ï¼Œåé¢ä¼šè¯¦ç»†è®²è§£ï¼Œå…¸å‹ä»£è¡¨åš<code>react-redux</code>ä¸­<code>connect</code>å’Œ <code>dva</code>ä¸­ <code>dynamic</code> ç»„ä»¶æ‡’åŠ è½½ã€‚</p> <p>æˆ‘ä¼šé’ˆå¯¹é«˜é˜¶ç»„ä»¶çš„åˆè¡·å±•å¼€ï¼Œè¯¦ç»†ä»‹ç»å…¶åŸç†å·²ç»ç”¨æ³•ã€‚è·Ÿä¸Šæˆ‘çš„æ€è·¯ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œé«˜é˜¶ç»„ä»¶<strong>å¦‚ä½•åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ä¸­ä½¿ç”¨çš„</strong>ã€‚</p> <h2 id="_3-é«˜é˜¶ç»„ä»¶ä½¿ç”¨å’Œç¼–å†™ç»“æ„"><a href="#_3-é«˜é˜¶ç»„ä»¶ä½¿ç”¨å’Œç¼–å†™ç»“æ„" class="header-anchor">#</a> 3 é«˜é˜¶ç»„ä»¶ä½¿ç”¨å’Œç¼–å†™ç»“æ„</h2> <p><code>HOC</code>ä½¿ç”¨æŒ‡å—æ˜¯éå¸¸ç®€å•çš„ï¼Œåªéœ€è¦å°†æˆ‘ä»¬çš„ç»„ä»¶è¿›è¡ŒåŒ…è£¹å°±å¯ä»¥äº†ã€‚</p> <h3 id="ä½¿ç”¨-è£…é¥°å™¨æ¨¡å¼å’Œå‡½æ•°åŒ…è£¹æ¨¡å¼"><a href="#ä½¿ç”¨-è£…é¥°å™¨æ¨¡å¼å’Œå‡½æ•°åŒ…è£¹æ¨¡å¼" class="header-anchor">#</a> ä½¿ç”¨ï¼šè£…é¥°å™¨æ¨¡å¼å’Œå‡½æ•°åŒ…è£¹æ¨¡å¼</h3> <p>å¯¹äº<code>class</code>å£°æ˜çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œå¯¹ç±»ç»„ä»¶è¿›è¡ŒåŒ…è£…ï¼š</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>@withStyles(styles)@withRouter@keepaliveLifeCycleclass Index extends React.Componen{    /* ... */}
</code></pre></div><p><strong>æˆ‘ä»¬è¦æ³¨æ„ä¸€ä¸‹åŒ…è£…é¡ºåºï¼Œè¶Šé è¿‘<code>Index</code>ç»„ä»¶çš„ï¼Œå°±æ˜¯è¶Šå†…å±‚çš„<code>HOC</code>,ç¦»ç»„ä»¶<code>Index</code>ä¹Ÿå°±è¶Šè¿‘ã€‚</strong></p> <p>å¯¹äºæ— çŠ¶æ€ç»„ä»¶(å‡½æ•°å£°æ˜ï¼‰æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š</p> <ul><li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function Index(){    /* .... */}export default withStyles(styles)(withRouter( keepaliveLifeCycle(Index) )) 
</code></pre></div><h3 id="æ¨¡å‹-åµŒå¥—hoc"><a href="#æ¨¡å‹-åµŒå¥—hoc" class="header-anchor">#</a> æ¨¡å‹ï¼šåµŒå¥—HOC</h3> <p>å¯¹äºä¸éœ€è¦ä¼ é€’å‚æ•°çš„<code>HOC</code>ï¼Œæˆ‘ä»¬ç¼–å†™æ¨¡å‹æˆ‘ä»¬åªéœ€è¦åµŒå¥—ä¸€å±‚å°±å¯ä»¥ï¼Œæ¯”å¦‚<code>withRouter</code>,</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function withRouter(){    return class wrapComponent extends React.Component{        /* ç¼–å†™é€»è¾‘ */    }}
</code></pre></div><p>å¯¹äºéœ€è¦å‚æ•°çš„<code>HOC</code>ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å±‚ä»£ç†ï¼Œå¦‚ä¸‹ï¼š</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function connect (mapStateToProps){    /* æ¥å—ç¬¬ä¸€ä¸ªå‚æ•° */    return function connectAdvance(wrapCompoent){        /* æ¥å—ç»„ä»¶ */        return class WrapComponent extends React.Component{  }    }}
</code></pre></div><p>æˆ‘ä»¬çœ‹å‡ºä¸¤ç§<code>hoc</code>æ¨¡å‹å¾ˆç®€å•ï¼Œå¯¹äºä»£ç†å‡½æ•°ï¼Œå¯èƒ½æœ‰ä¸€å±‚ï¼Œå¯èƒ½æœ‰å¾ˆå¤šå±‚ï¼Œä¸è¿‡ä¸è¦æ€•ï¼Œæ— è®ºå¤šå°‘å±‚æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€å±‚ä¸€å±‚å‰¥ç¦»å¼€ï¼Œåˆ†æç»“æ„ï¼Œæ•´ä¸ª<code>hoc</code>ç»“æ„å’Œè„‰ç»œå°±ä¼šæ¸…æ™°å¯è§ã€‚åƒé€<code>hoc</code>ä¹Ÿå°±æ˜“å¦‚åæŒã€‚</p> <h2 id="_4-ä¸¤ç§ä¸åŒçš„é«˜é˜¶ç»„ä»¶"><a href="#_4-ä¸¤ç§ä¸åŒçš„é«˜é˜¶ç»„ä»¶" class="header-anchor">#</a> 4 ä¸¤ç§ä¸åŒçš„é«˜é˜¶ç»„ä»¶</h2> <p>å¸¸ç”¨çš„é«˜é˜¶ç»„ä»¶æœ‰ä¸¤ç§æ–¹å¼<strong>æ­£å‘çš„å±æ€§ä»£ç†</strong>å’Œ<strong>åå‘çš„ç»„ä»¶ç»§æ‰¿</strong>ï¼Œä¸¤è€…ä¹‹å‰æœ‰ä¸€äº›å…±æ€§å’ŒåŒºåˆ«ã€‚æ¥ä¸‹å…·ä½“ä»‹ç»ä¸¤è€…åŒºåˆ«ï¼Œåœ¨ç¬¬ä¸‰éƒ¨åˆ†ä¼šè¯¦ç»†ä»‹ç»å…·ä½“å®ç°ã€‚</p> <h3 id="æ­£å‘å±æ€§ä»£ç†"><a href="#æ­£å‘å±æ€§ä»£ç†" class="header-anchor">#</a> æ­£å‘å±æ€§ä»£ç†</h3> <p>æ‰€è°“æ­£å‘å±æ€§ä»£ç†ï¼Œå°±æ˜¯ç”¨ç»„ä»¶åŒ…è£¹ä¸€å±‚ä»£ç†ç»„ä»¶ï¼Œåœ¨ä»£ç†ç»„ä»¶ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›ï¼Œå¯¹æºç»„ä»¶çš„ä»£ç†æ“ä½œã€‚åœ¨<code>fiber tree</code> ä¸Šï¼Œå…ˆ<code>mounted</code>ä»£ç†ç»„ä»¶ï¼Œç„¶åæ‰æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºçˆ¶å­ç»„ä»¶å…³ç³»ï¼Œçˆ¶ç»„ä»¶å¯¹å­ç»„ä»¶è¿›è¡Œä¸€ç³»åˆ—å¼ºåŒ–æ“ä½œã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC(WrapComponent){    return class Advance extends React.Component{       state={           name:'alien'       }       render(){           return &lt;WrapComponent  { ...this.props } { ...this.state }  /&gt;       }    }}
</code></pre></div><h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="header-anchor">#</a> ä¼˜ç‚¹</h4> <ul><li>â‘  æ­£å¸¸å±æ€§ä»£ç†å¯ä»¥å’Œä¸šåŠ¡ç»„ä»¶ä½è€¦åˆï¼Œé›¶è€¦åˆï¼Œå¯¹äº<code>æ¡ä»¶æ¸²æŸ“</code>å’Œ<code>propså±æ€§å¢å¼º</code>,åªè´Ÿè´£æ§åˆ¶å­ç»„ä»¶æ¸²æŸ“å’Œä¼ é€’é¢å¤–çš„<code>props</code>å°±å¯ä»¥ï¼Œæ‰€ä»¥æ— é¡»çŸ¥é“ï¼Œä¸šåŠ¡ç»„ä»¶åšäº†äº›ä»€ä¹ˆã€‚æ‰€ä»¥æ­£å‘å±æ€§ä»£ç†ï¼Œæ›´é€‚åˆåšä¸€äº›å¼€æºé¡¹ç›®çš„<code>hoc</code>ï¼Œç›®å‰å¼€æºçš„<code>HOC</code>åŸºæœ¬éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¨¡å¼å®ç°çš„ã€‚</li> <li>â‘¡ åŒæ ·é€‚ç”¨äº<code>class</code>å£°æ˜ç»„ä»¶ï¼Œå’Œ<code>function</code>å£°æ˜çš„ç»„ä»¶ã€‚</li> <li>â‘¢ å¯ä»¥å®Œå…¨éš”ç¦»ä¸šåŠ¡ç»„ä»¶çš„æ¸²æŸ“,ç›¸æ¯”åå‘ç»§æ‰¿ï¼Œå±æ€§ä»£ç†è¿™ç§æ¨¡å¼ã€‚å¯ä»¥å®Œå…¨æ§åˆ¶ä¸šåŠ¡ç»„ä»¶æ¸²æŸ“ä¸å¦ï¼Œå¯ä»¥é¿å…<code>åå‘ç»§æ‰¿</code>å¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œã€‚</li> <li>â‘£ å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œå¤šä¸ª<code>hoc</code>æ˜¯å¯ä»¥åµŒå¥—ä½¿ç”¨çš„ï¼Œè€Œä¸”ä¸€èˆ¬ä¸ä¼šé™åˆ¶åŒ…è£…<code>HOC</code>çš„å…ˆåé¡ºåºã€‚</li></ul> <h4 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="header-anchor">#</a> ç¼ºç‚¹</h4> <ul><li>â‘  ä¸€èˆ¬æ— æ³•ç›´æ¥è·å–ä¸šåŠ¡ç»„ä»¶çš„çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦è·å–ï¼Œéœ€è¦<code>ref</code>è·å–ç»„ä»¶å®ä¾‹ã€‚</li> <li>â‘¡ æ— æ³•ç›´æ¥ç»§æ‰¿é™æ€å±æ€§ã€‚å¦‚æœéœ€è¦ç»§æ‰¿éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œæˆ–è€…å¼•å…¥ç¬¬ä¸‰æ–¹åº“ã€‚</li></ul> <p><strong>ä¾‹å­ï¼š</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{  render(){    return &lt;div&gt; hello,world  &lt;/div&gt;  }}Index.say = function(){  console.log('my name is alien')}function HOC(Component) {  return class wrapComponent extends React.Component{     render(){       return &lt;Component { ...this.props } { ...this.state } /&gt;     }  }}const newIndex =  HOC(Index) console.log(newIndex.say)
</code></pre></div><p><strong>æ‰“å°ç»“æœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h3 id="åå‘ç»§æ‰¿"><a href="#åå‘ç»§æ‰¿" class="header-anchor">#</a> åå‘ç»§æ‰¿</h3> <p>åå‘ç»§æ‰¿å’Œå±æ€§ä»£ç†æœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œåœ¨äºåŒ…è£…åçš„ç»„ä»¶ç»§æ‰¿äº†ä¸šåŠ¡ç»„ä»¶æœ¬èº«ï¼Œæ‰€ä»¥æˆ‘ä»¬æˆ‘æ— é¡»åœ¨å»å®ä¾‹åŒ–æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ã€‚å½“å‰é«˜é˜¶ç»„ä»¶å°±æ˜¯ç»§æ‰¿åï¼ŒåŠ å¼ºå‹çš„ä¸šåŠ¡ç»„ä»¶ã€‚è¿™ç§æ–¹å¼ç±»ä¼¼äºç»„ä»¶çš„å¼ºåŒ–ï¼Œæ‰€ä»¥ä½ å¿…è¦è¦çŸ¥é“å½“å‰</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{  render(){    return &lt;div&gt; hello,world  &lt;/div&gt;  }}function HOC(Component){    return class wrapComponent extends Component{ /* ç›´æ¥ç»§æ‰¿éœ€è¦åŒ…è£…çš„ç»„ä»¶ */
    }}export default HOC(Index)
</code></pre></div><h4 id="ä¼˜ç‚¹-2"><a href="#ä¼˜ç‚¹-2" class="header-anchor">#</a> ä¼˜ç‚¹</h4> <ul><li><p>â‘  æ–¹ä¾¿è·å–ç»„ä»¶å†…éƒ¨çŠ¶æ€ï¼Œæ¯”å¦‚<code>state</code>ï¼Œ<code>props</code> ,ç”Ÿå‘½å‘¨æœŸ,ç»‘å®šçš„äº‹ä»¶å‡½æ•°ç­‰</p></li> <li><p>â‘¡ <code>es6</code>ç»§æ‰¿å¯ä»¥è‰¯å¥½ç»§æ‰¿é™æ€å±æ€§ã€‚æˆ‘ä»¬æ— é¡»å¯¹é™æ€å±æ€§å’Œæ–¹æ³•è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚</p></li> <li><ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{  render(){    return &lt;div&gt; hello,world  &lt;/div&gt;  }}Index.say = function(){  console.log('my name is alien')}function HOC(Component) {  return class wrapComponent extends Component{  }}const newIndex =  HOC(Index) console.log(newIndex.say)
</code></pre></div></li></ul> <p><strong>æ‰“å°ç»“æœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h4 id="ç¼ºç‚¹-2"><a href="#ç¼ºç‚¹-2" class="header-anchor">#</a> ç¼ºç‚¹</h4> <ul><li>â‘  æ— çŠ¶æ€ç»„ä»¶æ— æ³•ä½¿ç”¨ã€‚</li> <li>â‘¡ å’Œè¢«åŒ…è£…çš„ç»„ä»¶å¼ºè€¦åˆï¼Œéœ€è¦çŸ¥é“è¢«åŒ…è£…çš„ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ï¼Œå…·ä½“æ˜¯åšä»€ä¹ˆï¼Ÿ</li> <li>â‘¢ å¦‚æœå¤šä¸ªåå‘ç»§æ‰¿<code>hoc</code>åµŒå¥—åœ¨ä¸€èµ·ï¼Œå½“å‰çŠ¶æ€ä¼šè¦†ç›–ä¸Šä¸€ä¸ªçŠ¶æ€ã€‚è¿™æ ·å¸¦æ¥çš„éšæ‚£æ˜¯éå¸¸å¤§çš„ï¼Œæ¯”å¦‚è¯´æœ‰å¤šä¸ª<code>componentDidMount</code>ï¼Œå½“å‰<code>componentDidMount</code>ä¼šè¦†ç›–ä¸Šä¸€ä¸ª<code>componentDidMount</code>ã€‚è¿™æ ·å‰¯ä½œç”¨ä¸²è”èµ·æ¥ï¼Œå½±å“å¾ˆå¤§ã€‚</li></ul> <h1 id="ä¸‰-å¦‚ä½•ç¼–å†™é«˜é˜¶ç»„ä»¶"><a href="#ä¸‰-å¦‚ä½•ç¼–å†™é«˜é˜¶ç»„ä»¶" class="header-anchor">#</a> ä¸‰ å¦‚ä½•ç¼–å†™é«˜é˜¶ç»„ä»¶</h1> <p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚ä½•ç¼–å†™ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œä½ å¯ä»¥å‚è€ƒå¦‚ä¸‹çš„æƒ…æ™¯ï¼Œå»ç¼–å†™å±äºè‡ªå·±çš„<code>HOC</code>ã€‚</p> <h2 id="_1-å¼ºåŒ–props"><a href="#_1-å¼ºåŒ–props" class="header-anchor">#</a> 1 å¼ºåŒ–props</h2> <h3 id="_1-æ··å…¥props"><a href="#_1-æ··å…¥props" class="header-anchor">#</a> â‘  æ··å…¥props</h3> <p>è¿™ä¸ªæ˜¯é«˜é˜¶ç»„ä»¶æœ€å¸¸ç”¨çš„åŠŸèƒ½ï¼Œæ‰¿æ¥ä¸Šå±‚çš„<code>props</code>,åœ¨æ··å…¥è‡ªå·±çš„<code>props</code>ï¼Œæ¥å¼ºåŒ–ç»„ä»¶ã€‚</p> <p><strong>æœ‰çŠ¶æ€ç»„ä»¶(å±æ€§ä»£ç†)</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function classHOC(WrapComponent){    return class  Idex extends React.Component{        state={            name:'alien'        }        componentDidMount(){           console.log('HOC')        }        render(){            return &lt;WrapComponent { ...this.props }  { ...this.state }   /&gt;        }    }}function Index(props){  const { name } = props  useEffect(()=&gt;{     console.log( 'index' )  },[])  return &lt;div&gt;    hello,world , my name is { name }  &lt;/div&gt;}
export default classHOC(Index)
</code></pre></div><p><strong>æœ‰çŠ¶æ€ç»„ä»¶(å±æ€§ä»£ç†)</strong></p> <p>åŒæ ·ä¹Ÿé€‚ç”¨ä¸æ— çŠ¶æ€ç»„ä»¶ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function functionHoc(WrapComponent){    return function Index(props){        const [ state , setState ] = useState({ name :'alien'  })               return  &lt;WrapComponent { ...props }  { ...state }   /&gt;    }}
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h3 id="_2-æŠ½ç¦»stateæ§åˆ¶æ›´æ–°"><a href="#_2-æŠ½ç¦»stateæ§åˆ¶æ›´æ–°" class="header-anchor">#</a> â‘¡ æŠ½ç¦»stateæ§åˆ¶æ›´æ–°</h3> <p>é«˜é˜¶ç»„ä»¶å¯ä»¥å°†<code>HOC</code>çš„<code>state</code>çš„é…åˆèµ·æ¥ï¼Œæ§åˆ¶ä¸šåŠ¡ç»„ä»¶çš„æ›´æ–°ã€‚è¿™ç§ç”¨æ³•åœ¨<code>react-redux</code>ä¸­<code>connect</code>é«˜é˜¶ç»„ä»¶ä¸­ç”¨åˆ°è¿‡ï¼Œç”¨äºå¤„ç†æ¥è‡ª<code>redux</code>ä¸­<code>state</code>æ›´æ”¹ï¼Œå¸¦æ¥çš„è®¢é˜…æ›´æ–°ä½œç”¨ã€‚</p> <p>æˆ‘ä»¬å°†ä¸Šè¿°ä»£ç è¿›è¡Œæ”¹é€ ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function classHOC(WrapComponent){  return class  Idex extends React.Component{      constructor(){        super()        this.state={          name:'alien'        }      }      changeName(name){        this.setState({ name })      }      render(){          return &lt;WrapComponent { ...this.props }  { ...this.state } changeName={this.changeName.bind(this)  }  /&gt;      }  }}function Index(props){  const [ value ,setValue ] = useState(null)  const { name ,changeName } = props  return &lt;div&gt;    &lt;div&gt;   hello,world , my name is { name }&lt;/div&gt;    æ”¹å˜name &lt;input onChange={ (e)=&gt; setValue(e.target.value)  }  /&gt;    &lt;button onClick={ ()=&gt;  changeName(value) }  &gt;ç¡®å®š&lt;/button&gt;  &lt;/div&gt;}
export default classHOC(Index)
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h2 id="_2-æ§åˆ¶æ¸²æŸ“"><a href="#_2-æ§åˆ¶æ¸²æŸ“" class="header-anchor">#</a> 2 æ§åˆ¶æ¸²æŸ“</h2> <p>æ§åˆ¶æ¸²æŸ“æ˜¯é«˜é˜¶ç»„ä»¶çš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§ï¼Œä¸Šè¾¹è¯´åˆ°çš„ä¸¤ç§é«˜é˜¶ç»„ä»¶ï¼Œéƒ½èƒ½å®Œæˆå¯¹ç»„ä»¶æ¸²æŸ“çš„æ§åˆ¶ã€‚å…·ä½“å®ç°è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥æ¢ç´¢ä¸€ä¸‹ã€‚</p> <h3 id="_2-1-æ¡ä»¶æ¸²æŸ“"><a href="#_2-1-æ¡ä»¶æ¸²æŸ“" class="header-anchor">#</a> 2.1 æ¡ä»¶æ¸²æŸ“</h3> <h4 id="_1-åŸºç¡€-åŠ¨æ€æ¸²æŸ“"><a href="#_1-åŸºç¡€-åŠ¨æ€æ¸²æŸ“" class="header-anchor">#</a> â‘  åŸºç¡€ ï¼šåŠ¨æ€æ¸²æŸ“</h4> <p>å¯¹äºå±æ€§ä»£ç†çš„é«˜é˜¶ç»„ä»¶ï¼Œè™½ç„¶ä¸èƒ½åœ¨å†…éƒ¨æ“æ§æ¸²æŸ“çŠ¶æ€ï¼Œä½†æ˜¯å¯ä»¥åœ¨å¤–å±‚æ§åˆ¶å½“å‰ç»„ä»¶æ˜¯å¦æ¸²æŸ“ï¼Œè¿™ç§æƒ…å†µåº”ç”¨äºï¼Œ<strong>æƒé™éš”ç¦»</strong>ï¼Œ<strong>æ‡’åŠ è½½</strong> ï¼Œ<strong>å»¶æ—¶åŠ è½½</strong>ç­‰åœºæ™¯ã€‚</p> <p><strong>å®ç°ä¸€ä¸ªåŠ¨æ€æŒ‚è½½ç»„ä»¶çš„HOC</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function renderHOC(WrapComponent){  return class Index  extends React.Component{      constructor(props){        super(props)        this.state={ visible:true }        }      setVisible(){         this.setState({ visible:!this.state.visible })      }      render(){         const {  visible } = this.state          return &lt;div className=&quot;box&quot;  &gt;           &lt;button onClick={ this.setVisible.bind(this) } &gt; æŒ‚è½½ç»„ä»¶ &lt;/button&gt;           { visible ? &lt;WrapComponent { ...this.props } setVisible={ this.setVisible.bind(this) }   /&gt;  : &lt;div className=&quot;icon&quot; &gt;&lt;SyncOutlined spin  className=&quot;theicon&quot;  /&gt;&lt;/div&gt; }         &lt;/div&gt;      }  }}
class Index extends React.Component{  render(){    const { setVisible } = this.props    return &lt;div className=&quot;box&quot; &gt;        &lt;p&gt;hello,my name is alien&lt;/p&gt;        &lt;img  src='https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=294206908,2427609994&amp;fm=26&amp;gp=0.jpg'   /&gt;         &lt;button onClick={() =&gt; setVisible()}  &gt; å¸è½½å½“å‰ç»„ä»¶ &lt;/button&gt;    &lt;/div&gt;  }}export default renderHOC(Index)
</code></pre></div><p>æ•ˆæœï¼š</p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h4 id="_2-è¿›é˜¶-åˆ†ç‰‡æ¸²æŸ“"><a href="#_2-è¿›é˜¶-åˆ†ç‰‡æ¸²æŸ“" class="header-anchor">#</a> â‘¡ è¿›é˜¶ ï¼šåˆ†ç‰‡æ¸²æŸ“</h4> <p>æ˜¯ä¸æ˜¯æ„Ÿè§‰ä¸æ˜¯å¾ˆè¿‡ç˜¾ï¼Œä¸ºäº†è®©å¤§å®¶åŠ å¼ºå¯¹<code>HOC</code>æ¡ä»¶æ¸²æŸ“çš„ç†è§£ï¼Œæˆ‘å†åšä¸€ä¸ª<strong>åˆ†ç‰‡æ¸²æŸ“+æ‡’åŠ è½½</strong>åŠŸèƒ½ã€‚ä¸ºäº†è®©å¤§å®¶æ˜ç™½ï¼Œæˆ‘ä¹Ÿæ˜¯ç»å°½è„‘æ±å•ŠğŸ˜‚ğŸ˜‚ğŸ˜‚ã€‚</p> <p><strong>è¿›é˜¶ï¼šå®ç°ä¸€ä¸ªæ‡’åŠ è½½åŠŸèƒ½çš„HOCï¼Œå¯ä»¥å®ç°ç»„ä»¶çš„åˆ†ç‰‡æ¸²æŸ“,ç”¨äºåˆ†ç‰‡æ¸²æŸ“é¡µé¢ï¼Œä¸è‡³äºä¸€æ¬¡æ¸²æŸ“å¤§é‡ç»„ä»¶é€ æˆç™½å±æ•ˆæœ</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>const renderQueue = []let isFirstrender = false
const tryRender = ()=&gt;{  const render = renderQueue.shift()  if(!render) return  setTimeout(()=&gt;{    render() /* æ‰§è¡Œä¸‹ä¸€æ®µæ¸²æŸ“ */  },300)} /* HOC */function renderHOC(WrapComponent){    return function Index(props){      const [ isRender , setRender ] = useState(false)      useEffect(()=&gt;{        renderQueue.push(()=&gt;{  /* æ”¾å…¥å¾…æ¸²æŸ“é˜Ÿåˆ—ä¸­ */          setRender(true)        })        if(!isFirstrender) {          tryRender() /**/          isFirstrender = true        }      },[])      return isRender ? &lt;WrapComponent tryRender={tryRender}  { ...props }  /&gt; : &lt;div className='box' &gt;&lt;div className=&quot;icon&quot; &gt;&lt;SyncOutlined   spin /&gt;&lt;/div&gt;&lt;/div&gt;    }}/* ä¸šåŠ¡ç»„ä»¶ */class Index extends React.Component{  componentDidMount(){    const { name , tryRender} = this.props    /* ä¸Šä¸€éƒ¨åˆ†æ¸²æŸ“å®Œæ¯•ï¼Œè¿›è¡Œä¸‹ä¸€éƒ¨åˆ†æ¸²æŸ“ */    tryRender()    console.log( name+'æ¸²æŸ“')  }  render(){    return &lt;div&gt;        &lt;img src=&quot;https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=294206908,2427609994&amp;amp;fm=26&amp;amp;gp=0.jpg&quot; /&gt;    &lt;/div&gt;  }}/* é«˜é˜¶ç»„ä»¶åŒ…è£¹ */const Item = renderHOC(Index)
export default () =&gt; {  return &lt;React.Fragment&gt;      &lt;Item name=&quot;ç»„ä»¶ä¸€&quot; /&gt;      &lt;Item name=&quot;ç»„ä»¶äºŒ&quot; /&gt;      &lt;Item name=&quot;ç»„ä»¶ä¸‰&quot; /&gt;  &lt;/React.Fragment&gt;}
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>å¤§è‡´æµç¨‹ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œ<code>HOC</code>ä¸­å°†æ¸²æŸ“çœŸæ­£ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼Œæ”¾å…¥<code>renderQueue</code>é˜Ÿåˆ—ä¸­ï¼Œç„¶ååˆå§‹åŒ–æ¸²æŸ“ä¸€æ¬¡ï¼Œæ¥ä¸‹æ¥ï¼Œæ¯ä¸€ä¸ªé¡¹ç›®ç»„ä»¶ï¼Œå®Œæˆ <code>didMounted</code> çŠ¶æ€åï¼Œä¼šä»é˜Ÿåˆ—ä¸­å–å‡ºä¸‹ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œæ¸²æŸ“ä¸‹ä¸€ä¸ªç»„ä»¶, ä¸€ç›´åˆ°æ‰€æœ‰çš„æ¸²æŸ“ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œæ¸²æŸ“é˜Ÿåˆ—æ¸…ç©ºï¼Œæœ‰æ•ˆçš„è¿›è¡Œåˆ†ç‰‡çš„æ¸²æŸ“ï¼Œè¿™ç§æ–¹å¼å¯¹æµ·é‡æ•°æ®å±•ç¤ºï¼Œå¾ˆå¥æ•ˆã€‚</p> <p>ç”¨<code>HOC</code>å®ç°äº†æ¡ä»¶æ¸²æŸ“-åˆ†ç‰‡æ¸²æŸ“çš„åŠŸèƒ½ï¼Œå®é™…æ¡ä»¶æ¸²æŸ“ç†è§£èµ·æ¥å¾ˆå®¹æ˜“ï¼Œå°±æ˜¯é€šè¿‡å˜é‡ï¼Œæ§åˆ¶æ˜¯å¦æŒ‚è½½ç»„ä»¶ï¼Œä»è€Œæ»¡è¶³é¡¹ç›®æœ¬èº«éœ€æ±‚ï¼Œæ¡ä»¶æ¸²æŸ“å¯ä»¥æ¼”å˜æˆå¾ˆå¤šæ¨¡å¼ï¼Œæˆ‘è¿™é‡Œä»‹ç»äº†æ¡ä»¶æ¸²æŸ“çš„äºŒç§æ–¹å¼ï¼Œå¸Œæœ›å¤§å®¶èƒ½å¤Ÿç†è§£ç²¾é«“æ‰€åœ¨ã€‚</p> <h4 id="_3-è¿›é˜¶-å¼‚æ­¥ç»„ä»¶-æ‡’åŠ è½½"><a href="#_3-è¿›é˜¶-å¼‚æ­¥ç»„ä»¶-æ‡’åŠ è½½" class="header-anchor">#</a> â‘¢ è¿›é˜¶ï¼šå¼‚æ­¥ç»„ä»¶(æ‡’åŠ è½½)</h4> <p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰ç”¨è¿‡<code>dva</code>,é‡Œé¢çš„<code>dynamic</code>å°±æ˜¯åº”ç”¨<code>HOC</code>æ¨¡å¼å®ç°çš„ç»„ä»¶å¼‚æ­¥åŠ è½½ï¼Œæˆ‘è¿™é‡Œç®€åŒ–äº†ä¸€ä¸‹ï¼Œæç‚¼æ ¸å¿ƒä»£ç ï¼Œå¦‚ä¸‹ï¼š</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>/* è·¯ç”±æ‡’åŠ è½½HOC */export default function AsyncRouter(loadRouter) {  return class Content extends React.Component {    state = {Component: null}    componentDidMount() {      if (this.state.Component) return      loadRouter()        .then(module =&gt; module.default)        .then(Component =&gt; this.setState({Component},         ))    }    render() {      const {Component} = this.state      return Component ? &lt;Component {      ...this.props      }      /&gt; : null    }  }}
</code></pre></div><p>ä½¿ç”¨</p> <ul><li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>const Index = AsyncRouter(()=&gt;import('../pages/index'))
</code></pre></div><p><code>hoc</code>è¿˜å¯ä»¥é…åˆå…¶ä»–<code>API</code>ï¼Œåšä¸€ä¸‹è¡ç”Ÿçš„åŠŸèƒ½ã€‚å¦‚ä¸Šé…åˆ<code>import</code>å®ç°å¼‚æ­¥åŠ è½½åŠŸèƒ½ã€‚<code>HOC</code>ç”¨èµ·æ¥éå¸¸çµæ´»ï¼Œ</p> <h4 id="_4-åå‘ç»§æ‰¿-æ¸²æŸ“åŠ«æŒ"><a href="#_4-åå‘ç»§æ‰¿-æ¸²æŸ“åŠ«æŒ" class="header-anchor">#</a> â‘£ åå‘ç»§æ‰¿ ï¼šæ¸²æŸ“åŠ«æŒ</h4> <p><strong>HOCåå‘ç»§æ‰¿æ¨¡å¼ï¼Œå¯ä»¥å®ç°é¢—ç²’åŒ–çš„æ¸²æŸ“åŠ«æŒï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ§åˆ¶åŸºç±»ç»„ä»¶çš„<code>render</code>å‡½æ•°ï¼Œè¿˜å¯ä»¥ç¯¡æ”¹propsï¼Œæˆ–è€…æ˜¯<code>children</code>ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ï¼Œè¿™ç§çŠ¶æ€ä¸‹ï¼Œæ€ä¹ˆä½¿ç”¨é«˜é˜¶ç»„ä»¶ã€‚</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>const HOC = (WrapComponent) =&gt;  class Index  extends WrapComponent {    render() {      if (this.props.visible) {        return super.render()      } else {        return &lt;div&gt;æš‚æ— æ•°æ®&lt;/div&gt;      }    }  }
</code></pre></div><h4 id="_5-åå‘ç»§æ‰¿-ä¿®æ”¹æ¸²æŸ“æ ‘"><a href="#_5-åå‘ç»§æ‰¿-ä¿®æ”¹æ¸²æŸ“æ ‘" class="header-anchor">#</a> â‘¤ åå‘ç»§æ‰¿ï¼šä¿®æ”¹æ¸²æŸ“æ ‘</h4> <p><strong>ä¿®æ”¹æ¸²æŸ“çŠ¶æ€(åŠ«æŒrenderæ›¿æ¢å­èŠ‚ç‚¹)</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{  render(){    return &lt;div&gt;       &lt;ul&gt;         &lt;li&gt;react&lt;/li&gt;         &lt;li&gt;vue&lt;/li&gt;         &lt;li&gt;Angular&lt;/li&gt;       &lt;/ul&gt;    &lt;/div&gt;  }}
function HOC (Component){  return class Advance extends Component {    render() {      const element = super.render()      const otherProps = {        name:'alien'      }      /* æ›¿æ¢ Angular å…ƒç´ èŠ‚ç‚¹ */      const appendElement = React.createElement('li' ,{} , `hello ,world , my name  is ${ otherProps.name }` )      const newchild =  React.Children.map(element.props.children.props.children,(child,index)=&gt;{           if(index === 2) return appendElement           return  child      })       return  React.cloneElement(element, element.props, newchild)    }  }}export  default HOC(Index)
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>æˆ‘ä»¬ç”¨åŠ«æŒæ¸²æŸ“çš„æ–¹å¼ï¼Œæ¥æ“çºµ<code>super.render()</code>åçš„<code>React.element</code>å…ƒç´ ï¼Œç„¶åé…åˆ <code>createElement</code> , <code>cloneElement</code> , <code>React.Children</code> ç­‰ <code>api</code>,å¯ä»¥çµæ´»æ“çºµï¼ŒçœŸæ­£çš„æ¸²æŸ“<code>react.element</code>ï¼Œå¯ä»¥è¯´æ˜¯å·å¤©æ¢æ—¥ï¼Œä¸äº¦ä¹ä¹ã€‚</p> <h3 id="_2-2èŠ‚æµæ¸²æŸ“"><a href="#_2-2èŠ‚æµæ¸²æŸ“" class="header-anchor">#</a> 2.2èŠ‚æµæ¸²æŸ“</h3> <p><code>hoc</code>é™¤äº†å¯ä»¥è¿›è¡Œ<strong>æ¡ä»¶æ¸²æŸ“</strong>ï¼Œ<strong>æ¸²æŸ“åŠ«æŒ</strong>åŠŸèƒ½å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡ŒèŠ‚æµæ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä¼˜åŒ–æ€§èƒ½ï¼Œå…·ä½“æ€ä¹ˆåšï¼Œè¯·è·Ÿä¸Šæˆ‘çš„èŠ‚å¥å¾€ä¸‹çœ‹ã€‚</p> <h4 id="_1-åŸºç¡€-èŠ‚æµåŸç†"><a href="#_1-åŸºç¡€-èŠ‚æµåŸç†" class="header-anchor">#</a> â‘  åŸºç¡€: èŠ‚æµåŸç†</h4> <p><code>hoc</code>å¯ä»¥é…åˆ<code>hooks</code>çš„<code>useMemo</code>ç­‰<code>API</code>é…åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°å¯¹ä¸šåŠ¡ç»„ä»¶çš„æ¸²æŸ“æ§åˆ¶ï¼Œå‡å°‘æ¸²æŸ“æ¬¡æ•°ï¼Œä»è€Œè¾¾åˆ°ä¼˜åŒ–æ€§èƒ½çš„æ•ˆæœã€‚å¦‚ä¸‹æ¡ˆä¾‹ï¼Œæˆ‘ä»¬æœŸæœ›å½“ä¸”ä»…å½“<code>num</code>æ”¹å˜çš„æ—¶å€™ï¼Œæ¸²æŸ“ç»„ä»¶ï¼Œä½†æ˜¯ä¸å½±å“æ¥æ”¶çš„<code>props</code>ã€‚æˆ‘ä»¬åº”è¯¥è¿™æ ·å†™æˆ‘ä»¬çš„<code>HOC</code>ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC (Component){     return function renderWrapComponent(props){       const { num } = props       const RenderElement = useMemo(() =&gt;  &lt;Component {...props}  /&gt; ,[ num ])       return RenderElement     }}class Index extends React.Component{  render(){     console.log(`å½“å‰ç»„ä»¶æ˜¯å¦æ¸²æŸ“`,this.props)     return &lt;div&gt;hello,world, my name is alien &lt;/div&gt;  }}const IndexHoc = HOC(Index)
export default ()=&gt; {    const [ num ,setNumber ] = useState(0)    const [ num1 ,setNumber1 ] = useState(0)    const [ num2 ,setNumber2 ] = useState(0)    return &lt;div&gt;        &lt;IndexHoc  num={ num } num1={num1} num2={ num2 }  /&gt;        &lt;button onClick={() =&gt; setNumber(num + 1) } &gt;num++&lt;/button&gt;        &lt;button onClick={() =&gt; setNumber1(num1 + 1) } &gt;num1++&lt;/button&gt;        &lt;button onClick={() =&gt; setNumber2(num2 + 1) } &gt;num2++&lt;/button&gt;    &lt;/div&gt;}
</code></pre></div><p><strong>æ•ˆæœï¼š</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>å¦‚å›¾æ‰€ç¤º,å½“æˆ‘ä»¬åªæœ‰ç‚¹å‡» <code>num++</code>æ—¶å€™ï¼Œæ‰é‡æ–°æ¸²æŸ“å­ç»„ä»¶ï¼Œç‚¹å‡»å…¶ä»–æŒ‰é’®ï¼Œåªæ˜¯è´Ÿè´£ä¼ é€’äº†<code>props</code>,è¾¾åˆ°äº†æœŸæœ›çš„æ•ˆæœã€‚</p> <h4 id="_2-è¿›é˜¶-å®šåˆ¶åŒ–æ¸²æŸ“æµ"><a href="#_2-è¿›é˜¶-å®šåˆ¶åŒ–æ¸²æŸ“æµ" class="header-anchor">#</a> â‘¡ è¿›é˜¶ï¼šå®šåˆ¶åŒ–æ¸²æŸ“æµ</h4> <p>æ€è€ƒï¼šğŸ¤”ä¸Šè¿°çš„æ¡ˆä¾‹åªæ˜¯ä»‹ç»äº†åŸç†ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ˜¯é‡åŒ–ç”Ÿäº§ä¸äº†çš„ï¼ŒåŸå› æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒ<code>props</code>å˜åŒ–ï¼Œå†™ä¸åŒçš„<code>HOC</code>ç»„ä»¶ï¼Œè¿™æ ·æ ¹æœ¬èµ·ä¸äº†<code>Hoc</code>çœŸæ­£çš„ç”¨é€”ï¼Œä¹Ÿå°±æ˜¯<code>HOC</code>äº§ç”Ÿçš„åˆè¡·ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ä¸Šè¿°<code>hoc</code>è¿›è¡Œæ”¹é€ å‡çº§ï¼Œæ˜¯ç»„ä»¶å¯ä»¥æ ¹æ®å®šåˆ¶åŒ–æ–¹å‘ï¼Œå»æ¸²æŸ“ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯<code>Hoc</code>ç”Ÿæˆçš„æ—¶å€™ï¼Œå·²ç»æŒ‰ç…§æŸç§å¥‘çº¦å»æ‰§è¡Œæ¸²æŸ“ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC (rule){     return function (Component){        return function renderWrapComponent(props){          const dep = rule(props)          const RenderElement = useMemo(() =&gt;  &lt;Component {...props}  /&gt; ,[ dep ])          return RenderElement        }     }}/* åªæœ‰ props ä¸­ num å˜åŒ– ï¼Œæ¸²æŸ“ç»„ä»¶  */@HOC( (props)=&gt; props['num'])class IndexHoc extends React.Component{  render(){     console.log(`ç»„ä»¶ä¸€æ¸²æŸ“`,this.props)     return &lt;div&gt; ç»„ä»¶ä¸€ ï¼šhello,world &lt;/div&gt;  }}
/* åªæœ‰ props ä¸­ num1 å˜åŒ– ï¼Œæ¸²æŸ“ç»„ä»¶  */@HOC((props)=&gt; props['num1'])class IndexHoc1 extends React.Component{  render(){     console.log(`ç»„ä»¶äºŒæ¸²æŸ“`,this.props)     return &lt;div&gt; ç»„ä»¶äºŒ ï¼šmy name is alien &lt;/div&gt;  }}export default ()=&gt; {    const [ num ,setNumber ] = useState(0)    const [ num1 ,setNumber1 ] = useState(0)    const [ num2 ,setNumber2 ] = useState(0)    return &lt;div&gt;        &lt;IndexHoc  num={ num } num1={num1} num2={ num2 }  /&gt;        &lt;IndexHoc1  num={ num } num1={num1} num2={ num2 }  /&gt;        &lt;button onClick={() =&gt; setNumber(num + 1) } &gt;num++&lt;/button&gt;        &lt;button onClick={() =&gt; setNumber1(num1 + 1) } &gt;num1++&lt;/button&gt;        &lt;button onClick={() =&gt; setNumber2(num2 + 1) } &gt;num2++&lt;/button&gt;    &lt;/div&gt;}
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>å®Œç¾å®ç°äº†æ•ˆæœã€‚è¿™ç”¨é«˜é˜¶ç»„ä»¶æ¨¡å¼ï¼Œå¯ä»¥çµæ´»æ§åˆ¶<code>React</code>ç»„ä»¶å±‚é¢ä¸Šçš„ï¼Œ<strong><code>props</code>æ•°æ®æµ</strong>å’Œ<strong>æ›´æ–°æµ</strong>ï¼Œä¼˜ç§€çš„é«˜é˜¶ç»„ä»¶æœ‰ <code>mobx</code> ä¸­<code>observer</code> ,<code>inject</code> , <code>react-redux</code>ä¸­çš„<code>connect</code>,æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥æŠ½æ—¶é—´ç ”ç©¶ä¸€ä¸‹ã€‚</p> <h2 id="_3-èµ‹èƒ½ç»„ä»¶"><a href="#_3-èµ‹èƒ½ç»„ä»¶" class="header-anchor">#</a> 3 èµ‹èƒ½ç»„ä»¶</h2> <p>é«˜é˜¶ç»„ä»¶é™¤äº†ä¸Šè¿°ä¸¤ç§åŠŸèƒ½ä¹‹å¤–ï¼Œè¿˜å¯ä»¥èµ‹èƒ½ç»„ä»¶ï¼Œæ¯”å¦‚åŠ ä¸€äº›<strong>é¢å¤–<code>ç”Ÿå‘½å‘¨æœŸ</code></strong>ï¼Œ<strong>åŠ«æŒäº‹ä»¶</strong>ï¼Œ<strong>ç›‘æ§æ—¥å¿—</strong>ç­‰ç­‰ã€‚</p> <h3 id="_3-1-åŠ«æŒåŸå‹é“¾-åŠ«æŒç”Ÿå‘½å‘¨æœŸ-äº‹ä»¶å‡½æ•°"><a href="#_3-1-åŠ«æŒåŸå‹é“¾-åŠ«æŒç”Ÿå‘½å‘¨æœŸ-äº‹ä»¶å‡½æ•°" class="header-anchor">#</a> 3.1 åŠ«æŒåŸå‹é“¾-åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼Œäº‹ä»¶å‡½æ•°</h3> <h4 id="_1-å±æ€§ä»£ç†å®ç°"><a href="#_1-å±æ€§ä»£ç†å®ç°" class="header-anchor">#</a> â‘  å±æ€§ä»£ç†å®ç°</h4> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC (Component){  const proDidMount = Component.prototype.componentDidMount   Component.prototype.componentDidMount = function(){     console.log('åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼šcomponentDidMount')     proDidMount.call(this)  }  return class wrapComponent extends React.Component{      render(){        return &lt;Component {...this.props}  /&gt;      }  }}@HOCclass Index extends React.Component{   componentDidMount(){     console.log('â€”â€”â€”didMountedâ€”â€”â€”')   }   render(){     return &lt;div&gt;hello,world&lt;/div&gt;   }}
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h4 id="_2-åå‘ç»§æ‰¿å®ç°"><a href="#_2-åå‘ç»§æ‰¿å®ç°" class="header-anchor">#</a> â‘¡ åå‘ç»§æ‰¿å®ç°</h4> <p>åå‘ç»§æ‰¿ï¼Œå› ä¸ºåœ¨ç»§æ‰¿åŸæœ‰ç»„ä»¶çš„åŸºç¡€ä¸Šï¼Œå¯ä»¥å¯¹åŸæœ‰ç»„ä»¶çš„<strong>ç”Ÿå‘½å‘¨æœŸ</strong>æˆ–<strong>äº‹ä»¶</strong>è¿›è¡ŒåŠ«æŒï¼Œç”šè‡³æ˜¯æ›¿æ¢ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC (Component){  const didMount = Component.prototype.componentDidMount  return class wrapComponent extends Component{      componentDidMount(){        console.log('------åŠ«æŒç”Ÿå‘½å‘¨æœŸ------')        if (didMount) {           didMount.apply(this) /* æ³¨æ„ `this` æŒ‡å‘é—®é¢˜ã€‚*/        }      }      render(){        return super.render()      }  }}
@HOCclass Index extends React.Component{   componentDidMount(){     console.log('â€”â€”â€”didMountedâ€”â€”â€”')   }   render(){     return &lt;div&gt;hello,world&lt;/div&gt;   }}
</code></pre></div><h3 id="_3-2-äº‹ä»¶ç›‘æ§"><a href="#_3-2-äº‹ä»¶ç›‘æ§" class="header-anchor">#</a> 3.2 äº‹ä»¶ç›‘æ§</h3> <p><code>HOC</code>è¿˜å¯ä»¥å¯¹åŸæœ‰ç»„ä»¶è¿›è¡Œç›‘æ§ã€‚æ¯”å¦‚å¯¹ä¸€äº›<code>äº‹ä»¶ç›‘æ§</code>ï¼Œ<code>é”™è¯¯ç›‘æ§</code>ï¼Œ<code>äº‹ä»¶ç›‘å¬</code>ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚</p> <h4 id="_1-ç»„ä»¶å†…çš„äº‹ä»¶ç›‘å¬"><a href="#_1-ç»„ä»¶å†…çš„äº‹ä»¶ç›‘å¬" class="header-anchor">#</a> â‘  ç»„ä»¶å†…çš„äº‹ä»¶ç›‘å¬</h4> <p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åšä¸€ä¸ª<code>HOC</code>,åªå¯¹ç»„ä»¶å†…çš„ç‚¹å‡»äº‹ä»¶åšä¸€ä¸ªç›‘å¬æ•ˆæœã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function ClickHoc (Component){  return  function Wrap(props){    const dom = useRef(null)    useEffect(()=&gt;{     const handerClick = () =&gt; console.log('å‘ç”Ÿç‚¹å‡»äº‹ä»¶')      dom.current.addEventListener('click',handerClick)     return () =&gt; dom.current.removeEventListener('click',handerClick)    },[])    return  &lt;div ref={dom}  &gt;&lt;Component  {...props} /&gt;&lt;/div&gt;  }}
@ClickHocclass Index extends React.Component{   render(){     return &lt;div  className='index'  &gt;       &lt;p&gt;helloï¼Œworld&lt;/p&gt;       &lt;button&gt;ç»„ä»¶å†…éƒ¨ç‚¹å‡»&lt;/button&gt;    &lt;/div&gt;   }}export default ()=&gt;{  return &lt;div className='box'  &gt;     &lt;Index /&gt;     &lt;button&gt;ç»„ä»¶å¤–éƒ¨ç‚¹å‡»&lt;/button&gt;  &lt;/div&gt;}
</code></pre></div><p><strong>æ•ˆæœ</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <h3 id="_3-refåŠ©åŠ›æ“æ§ç»„ä»¶å®ä¾‹"><a href="#_3-refåŠ©åŠ›æ“æ§ç»„ä»¶å®ä¾‹" class="header-anchor">#</a> 3 refåŠ©åŠ›æ“æ§ç»„ä»¶å®ä¾‹</h3> <p>å¯¹äºå±æ€§ä»£ç†æˆ‘ä»¬è™½ç„¶ä¸èƒ½ç›´æ¥è·å–ç»„ä»¶å†…çš„çŠ¶æ€ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>ref</code>è·å–ç»„ä»¶å®ä¾‹,è·å–åˆ°ç»„ä»¶å®ä¾‹ï¼Œå°±å¯ä»¥è·å–ç»„ä»¶çš„ä¸€äº›çŠ¶æ€ï¼Œæˆ–æ˜¯æ‰‹åŠ¨è§¦å‘ä¸€äº›äº‹ä»¶ï¼Œè¿›ä¸€æ­¥å¼ºåŒ–ç»„ä»¶ï¼Œä½†æ˜¯æ³¨æ„çš„æ˜¯ï¼š<code>class</code>å£°æ˜çš„æœ‰çŠ¶æ€ç»„ä»¶æ‰æœ‰å®ä¾‹ï¼Œ<code>function</code>å£°æ˜çš„æ— çŠ¶æ€ç»„ä»¶ä¸å­˜åœ¨å®ä¾‹ã€‚</p> <h4 id="_1-å±æ€§ä»£ç†-æ·»åŠ é¢å¤–ç”Ÿå‘½å‘¨æœŸ"><a href="#_1-å±æ€§ä»£ç†-æ·»åŠ é¢å¤–ç”Ÿå‘½å‘¨æœŸ" class="header-anchor">#</a> â‘  å±æ€§ä»£ç†-æ·»åŠ é¢å¤–ç”Ÿå‘½å‘¨æœŸ</h4> <p>æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æŸä¸€ç§æƒ…å†µ, ç»™ç»„ä»¶å¢åŠ é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œæˆ‘åšäº†ä¸€ä¸ªç®€å•çš„<code>demo</code>ï¼Œç›‘å¬<code>number</code>æ”¹å˜ï¼Œå¦‚æœ<code>number</code>æ”¹å˜ï¼Œå°±è‡ªåŠ¨è§¦å‘ç»„ä»¶çš„ç›‘å¬å‡½æ•°<code>handerNumberChange</code>ã€‚å…·ä½“å†™æ³•å¦‚ä¸‹</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function Hoc(Component){  return class WrapComponent extends React.Component{      constructor(){        super()        this.node = null      }      UNSAFE_componentWillReceiveProps(nextprops){          if(nextprops.number !== this.props.number ){            this.node.handerNumberChange  &amp;&amp;  this.node.handerNumberChange.call(this.node)          }      }      render(){        return &lt;Component {...this.props} ref={(node) =&gt; this.node = node }  /&gt;      }  }}@Hocclass Index extends React.Component{  handerNumberChange(){      /* ç›‘å¬ number æ”¹å˜ */  }  render(){    return &lt;div&gt;hello,world&lt;/div&gt;  }}
</code></pre></div><p>è¿™ç§å†™æ³•æœ‰ç‚¹ä¸å°½äººæ„ï¼Œå¤§å®¶ä¸è¦ç€æ€¥ï¼Œåœ¨ç¬¬å››éƒ¨åˆ†ï¼Œæºç å®æˆ˜ä¸­ï¼Œæˆ‘ä¼šä»‹ç»ä¸€ç§æ›´å¥½çš„åœºæ™¯ã€‚æ–¹ä¾¿å¤§å®¶ç†è§£<code>Hoc</code>å¯¹åŸæœ‰ç»„ä»¶çš„èµ‹èƒ½ã€‚</p> <h2 id="_4-æ€»ç»“"><a href="#_4-æ€»ç»“" class="header-anchor">#</a> 4 æ€»ç»“</h2> <p>ä¸Šé¢æˆ‘åˆ†åˆ«æŒ‰ç…§<code>hoc</code>ä¸»è¦åŠŸèƒ½ï¼Œ<strong>å¼ºåŒ–props</strong> ï¼Œ <strong>æ§åˆ¶æ¸²æŸ“</strong> ï¼Œ<strong>èµ‹èƒ½ç»„ä»¶</strong> ä¸‰ä¸ªæ–¹å‘å¯¹<code>HOC</code>ç¼–å†™åšäº†ä¸€ä¸ªè¯¦ç»†ä»‹ç»ï¼Œå’Œåº”ç”¨åœºæ™¯çš„ä»‹ç»ï¼Œç›®çš„<strong>è®©å¤§å®¶åœ¨ç†è§£é«˜é˜¶ç»„ä»¶çš„æ—¶å€™ï¼Œæ›´æ˜ç™½ä»€ä¹ˆæ—¶å€™ä¼šç”¨åˆ°ï¼Ÿ,æ€ä¹ˆæ ·å»å†™ï¼Ÿ`</strong> é‡Œé¢æ¶µç›–çš„çŸ¥è¯†ç‚¹æˆ‘æ€»ä¸€ä¸ªæ€»ç»“ã€‚</p> <p>å¯¹äºå±æ€§ä»£ç†HOCï¼Œæˆ‘ä»¬å¯ä»¥ï¼š</p> <ul><li>å¼ºåŒ–props &amp; æŠ½ç¦»stateã€‚</li> <li>æ¡ä»¶æ¸²æŸ“ï¼Œæ§åˆ¶æ¸²æŸ“ï¼Œåˆ†ç‰‡æ¸²æŸ“ï¼Œæ‡’åŠ è½½ã€‚</li> <li>åŠ«æŒäº‹ä»¶å’Œç”Ÿå‘½å‘¨æœŸ</li> <li>refæ§åˆ¶ç»„ä»¶å®ä¾‹</li> <li>æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œæ—¥å¿—</li></ul> <p>å¯¹äºåå‘ä»£ç†çš„HOC,æˆ‘ä»¬å¯ä»¥ï¼š</p> <ul><li>åŠ«æŒæ¸²æŸ“ï¼Œæ“çºµæ¸²æŸ“æ ‘</li> <li>æ§åˆ¶/æ›¿æ¢ç”Ÿå‘½å‘¨æœŸï¼Œç›´æ¥è·å–ç»„ä»¶çŠ¶æ€ï¼Œç»‘å®šäº‹ä»¶ã€‚</li></ul> <p>æ¯ä¸ªåº”ç”¨åœºæ™¯ï¼Œæˆ‘éƒ½ä¸¾äº†ä¾‹å­ğŸŒ°ğŸŒ°ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¾‹å­æ·±å…¥äº†è§£ä¸€ä¸‹å…¶åŸç†å’Œç”¨é€”ã€‚</p> <h1 id="å››-é«˜é˜¶ç»„ä»¶æºç çº§å®è·µ"><a href="#å››-é«˜é˜¶ç»„ä»¶æºç çº§å®è·µ" class="header-anchor">#</a> å›› é«˜é˜¶ç»„ä»¶æºç çº§å®è·µ</h1> <p><code>hoc</code>çš„åº”ç”¨åœºæ™¯æœ‰å¾ˆå¤šï¼Œä¹Ÿæœ‰å¾ˆå¤šå¥½çš„å¼€æºé¡¹ç›®ï¼Œä¾›æˆ‘ä»¬å­¦ä¹ å’Œå‚è€ƒï¼Œæ¥ä¸‹æ¥æˆ‘çœŸå¯¹ä¸‰ä¸ªæ–¹å‘ä¸Šçš„åŠŸèƒ½ç”¨é€”ï¼Œåˆ†åˆ«ä»æºç è§’åº¦è§£æ<code>HOC</code>çš„ç”¨é€”ã€‚</p> <h2 id="_1-å¼ºåŒ–prop-withroute"><a href="#_1-å¼ºåŒ–prop-withroute" class="header-anchor">#</a> 1 å¼ºåŒ–prop- withRoute</h2> <p>ç”¨è¿‡<code>withRoute</code>çš„åŒå­¦ï¼Œéƒ½æ˜ç™½å…¶ç”¨é€”ï¼Œ<code>withRoute</code>ç”¨é€”å°±æ˜¯ï¼Œå¯¹äºæ²¡æœ‰è¢«<code>Route</code>åŒ…è£¹çš„ç»„ä»¶ï¼Œç»™æ·»åŠ <code>history</code>å¯¹è±¡ç­‰å’Œè·¯ç”±ç›¸å…³çš„çŠ¶æ€ï¼Œæ–¹ä¾¿æˆ‘ä»¬åœ¨ä»»æ„ç»„ä»¶ä¸­ï¼Œéƒ½èƒ½å¤Ÿè·å–è·¯ç”±çŠ¶æ€ï¼Œè¿›è¡Œè·¯ç”±è·³è½¬ï¼Œè¿™ä¸ª<code>HOC</code>ç›®çš„å¾ˆæ¸…æ¥šï¼Œå°±æ˜¯å¼ºåŒ–<code>props</code>,æŠŠ<code>Router</code>ç›¸å…³çš„çŠ¶æ€éƒ½æ··å…¥åˆ°<code>props</code>ä¸­ï¼Œæˆ‘ä»¬çœ‹çœ‹å…·ä½“æ€ä¹ˆå®ç°çš„ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function withRouter(Component) {  const displayName = `withRouter(${Component.displayName || Component.name})`;  const C = props =&gt; {      /*  è·å– */    const { wrappedComponentRef, ...remainingProps } = props;    return (      &lt;RouterContext.Consumer&gt;        {context =&gt; {          return (            &lt;Component              {...remainingProps}              {...context}              ref={wrappedComponentRef}            /&gt;          );        }}      &lt;/RouterContext.Consumer&gt;    );  };
  C.displayName = displayName;  C.WrappedComponent = Component;  /* ç»§æ‰¿é™æ€å±æ€§ */  return hoistStatics(C, Component);}
export default withRouter
</code></pre></div><p><code>withRoute</code>çš„æµç¨‹å®é™…å¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆä»<code>props</code>åˆ†ç¦»å‡º<code>ref</code>å’Œ<code>props</code>,ç„¶åä»å­˜æ”¾æ•´ä¸ª<code>route</code>å¯¹è±¡ä¸Šä¸‹æ–‡<code>RouterContext</code>å–å‡º<code>route</code>å¯¹è±¡,ç„¶åæ··å…¥åˆ°åŸå§‹ç»„ä»¶çš„<code>props</code>ä¸­ï¼Œæœ€åç”¨<code>hoistStatics</code>ç»§æ‰¿é™æ€å±æ€§ã€‚è‡³äº<code>hoistStatics</code>æˆ‘ä»¬ç¨åä¼šè®²åˆ°ã€‚</p> <h2 id="_2-æ§åˆ¶æ¸²æŸ“æ¡ˆä¾‹-connect"><a href="#_2-æ§åˆ¶æ¸²æŸ“æ¡ˆä¾‹-connect" class="header-anchor">#</a> 2 æ§åˆ¶æ¸²æŸ“æ¡ˆä¾‹ connect</h2> <p>ç”±äº<code>connect</code>æºç æ¯”è¾ƒé•¿å’Œéš¾ä»¥ç†è§£ï¼Œæ‰€ä»¥æˆ‘ä»¬æå–ç²¾é«“ï¼Œç²¾ç®€ç²¾ç®€å†ç²¾ç®€, æ€»ç»“çš„æ ¸å¿ƒåŠŸèƒ½å¦‚ä¸‹,<code>connect</code>çš„ä½œç”¨ä¹Ÿæœ‰<code>åˆå¹¶props</code>ï¼Œä½†æ˜¯æ›´é‡è¦çš„æ˜¯æ¥å—<code>state</code>ï¼Œæ¥æ§åˆ¶æ›´æ–°ç»„ä»¶ã€‚ä¸‹é¢è¿™ä¸ªä»£ç ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿å¤§å®¶ç†è§£ï¼Œæˆ‘éƒ½ç»™ç®€åŒ–äº†ã€‚å¸Œæœ›å¤§å®¶èƒ½å¤Ÿç†è§£<code>hoc</code>å¦‚ä½•<strong>æ´¾å‘</strong>å’Œ<strong>æ§åˆ¶</strong>æ›´æ–°æµçš„ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>import store from './redux/store'import { ReactReduxContext } from './Context'import { useContext } from 'react'function connect(mapStateToProps){   /* ç¬¬ä¸€å±‚ï¼šæ¥æ”¶è®¢é˜…stateå‡½æ•° */    return function wrapWithConnect (WrappedComponent){        /* ç¬¬äºŒå±‚ï¼šæ¥æ”¶åŸå§‹ç»„ä»¶ */        function ConnectFunction(props){            const [ , forceUpdate ] = useState(0)            const { reactReduxForwardedRef ,...wrapperProps } = props                        /* å–å‡ºContext */            const { store } = useContext(ReactReduxContext)
            /* å¼ºåŒ–propsï¼šåˆå¹¶ store state å’Œ props  */            const trueComponentProps = useMemo(()=&gt;{                  /* åªæœ‰propsæˆ–è€…è®¢é˜…çš„stateå˜åŒ–ï¼Œæ‰è¿”å›åˆå¹¶åçš„props */                 return selectorFactory(mapStateToProps(store.getState()),wrapperProps)             },[ store , wrapperProps ])
            /* åªæœ‰ trueComponentProps æ”¹å˜æ—¶å€™,æ›´æ–°ç»„ä»¶ã€‚*/            const renderedWrappedComponent = useMemo(              () =&gt; (                &lt;WrappedComponent                  {...trueComponentProps}                  ref={reactReduxForwardedRef}                /&gt;              ),              [reactReduxForwardedRef, WrappedComponent, trueComponentProps]            )            useEffect(()=&gt;{              /* è®¢é˜…æ›´æ–° */               const checkUpdate = () =&gt; forceUpdate(new Date().getTime())               store.subscribe( checkUpdate )            },[ store ])            return renderedWrappedComponent        }        /* React.memo åŒ…è£¹  */        const Connect = React.memo(ConnectFunction)
        /* å¤„ç†hoc,è·å–refé—®é¢˜ */          if(forwardRef){          const forwarded = React.forwardRef(function forwardConnectRef( props,ref) {            return &lt;Connect {...props} reactReduxForwardedRef={ref} reactReduxForwardedRef={ref} /&gt;          })          return hoistStatics(forwarded, WrappedComponent)        }         /* ç»§æ‰¿é™æ€å±æ€§ */        return hoistStatics(Connect,WrappedComponent)    } }export default Index
</code></pre></div><p><code>connect</code> æ¶‰åŠåˆ°çš„åŠŸèƒ½ç‚¹è¿˜çœŸä¸å°‘å‘¢ï¼Œé¦–å…ˆç¬¬ä¸€å±‚æ¥å—è®¢é˜…å‡½æ•°ï¼Œç¬¬äºŒå±‚æ¥æ”¶åŸå§‹ç»„ä»¶ï¼Œç„¶åç”¨<code>forwardRef</code>å¤„ç†<code>ref</code>,ç”¨<code>hoistStatics</code> å¤„ç†é™æ€å±æ€§çš„ç»§æ‰¿ï¼Œåœ¨åŒ…è£…ç»„ä»¶å†…éƒ¨ï¼Œåˆå¹¶<code>props</code>,<code>useMemo</code>ç¼“å­˜åŸå§‹ç»„ä»¶ï¼Œåªæœ‰åˆå¹¶åçš„<code>props</code>å‘ç”Ÿå˜åŒ–ï¼Œæ‰æ›´æ–°ç»„ä»¶ï¼Œç„¶ååœ¨<code>useEffect</code>å†…éƒ¨é€šè¿‡<code>store.subscribe()</code>è®¢é˜…æ›´æ–°ã€‚è¿™é‡Œçœç•¥äº†<code>Subscription</code>æ¦‚å¿µï¼ŒçœŸæ­£çš„<code>connect</code>ä¸­æœ‰ä¸€ä¸ª<code>Subscription</code>ä¸“é—¨è´Ÿè´£è®¢é˜…æ¶ˆæ¯ã€‚</p> <h2 id="_3-èµ‹èƒ½ç»„ä»¶-ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ-keepalivelifecycle"><a href="#_3-èµ‹èƒ½ç»„ä»¶-ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ-keepalivelifecycle" class="header-anchor">#</a> 3 èµ‹èƒ½ç»„ä»¶-ç¼“å­˜ç”Ÿå‘½å‘¨æœŸ keepaliveLifeCycle</h2> <p>ä¹‹å‰ç¬”è€…å†™äº†ä¸€ä¸ª<code>react</code>ç¼“å­˜é¡µé¢çš„å¼€æºåº“<code>react-keepalive-router</code>ï¼Œå¯ä»¥å®ç°<code>vue</code>ä¸­ <code>keepalive</code> + <code>router</code>åŠŸèƒ½ï¼Œæœ€åˆçš„ç‰ˆæœ¬æ²¡æœ‰ç¼“å­˜å‘¨æœŸçš„ï¼Œä½†æ˜¯åæ¥çƒ­å¿ƒè¯»è€…ï¼ŒæœŸæœ›åœ¨è¢«ç¼“å­˜çš„è·¯ç”±ç»„ä»¶ä¸­åŠ å…¥ç¼“å­˜å‘¨æœŸï¼Œç±»ä¼¼<code>activated</code>è¿™ç§çš„ï¼Œåæ¥ç»è¿‡æˆ‘çš„åˆ†ææ‰“ç®—ç”¨<code>HOC</code>æ¥å®ç°æ­¤åŠŸèƒ½ã€‚</p> <p>äºæ˜¯ä¹<code>react-keepalive-router</code>åŠ å…¥äº†å…¨æ–°çš„é¡µé¢ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ <code>actived</code> å’Œ <code>unActived</code>, <code>actived</code> ä½œä¸ºç¼“å­˜è·¯ç”±ç»„ä»¶æ¿€æ´»æ—¶å€™ç”¨ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šé»˜è®¤æ‰§è¡Œä¸€æ¬¡ , <code>unActived</code> ä½œä¸ºè·¯ç”±ç»„ä»¶ç¼“å­˜å®Œæˆåè°ƒç”¨ã€‚ä½†æ˜¯ç”Ÿå‘½å‘¨æœŸéœ€è¦ç”¨ä¸€ä¸ª <code>HOC</code> ç»„ä»¶<code>keepaliveLifeCycle</code> åŒ…è£¹ã€‚</p> <p>ä½¿ç”¨</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>import React   from 'react'import { keepaliveLifeCycle } from 'react-keepalive-router'
@keepaliveLifeCycleclass index extends React.Component&lt;any,any&gt;{
    state={        activedNumber:0,        unActivedNumber:0    }    actived(){        this.setState({            activedNumber:this.state.activedNumber + 1        })    }    unActived(){        this.setState({            unActivedNumber:this.state.unActivedNumber + 1        })    }    render(){        const { activedNumber , unActivedNumber } = this.state        return &lt;div  style={{ marginTop :'50px' }}  &gt;           &lt;div&gt; é¡µé¢ actived æ¬¡æ•°ï¼š{activedNumber} &lt;/div&gt;           &lt;div&gt; é¡µé¢ unActived æ¬¡æ•°ï¼š{unActivedNumber} &lt;/div&gt;        &lt;/div&gt;    }}export default index
</code></pre></div><p>**
**</p> <p><strong>åŸç†</strong></p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>import {lifeCycles} from '../core/keeper'import hoistNonReactStatic from 'hoist-non-react-statics'function keepaliveLifeCycle(Component) {   class Hoc extends React.Component {    cur = null    handerLifeCycle = type =&gt; {      if (!this.cur) return      const lifeCycleFunc = this.cur[type]      isFuntion(lifeCycleFunc) &amp;&amp; lifeCycleFunc.call(this.cur)    }    componentDidMount() {       const {cacheId} = this.props      cacheId &amp;&amp; (lifeCycles[cacheId] = this.handerLifeCycle)    }    componentWillUnmount() {      const {cacheId} = this.props      delete lifeCycles[cacheId]    }     render=() =&gt; &lt;Component {...this.props} ref={cur =&gt; (this.cur = cur)}/&gt;  }  return hoistNonReactStatic(Hoc,Component)}
</code></pre></div><p><code>keepaliveLifeCycle</code> çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡<code>ref</code>æˆ–è·å– <code>class</code> ç»„ä»¶çš„å®ä¾‹,åœ¨ <code>hoc</code> åˆå§‹åŒ–æ—¶å€™<strong>è¿›è¡Œç”Ÿå‘½å‘¨æœŸçš„ç»‘å®š</strong>, åœ¨ <code>hoc</code> é”€æ¯é˜¶æ®µï¼Œå¯¹ç”Ÿå‘½å‘¨æœŸè¿›è¡Œè§£ç»‘, ç„¶åäº¤ç»™<code>keeper</code>ç»Ÿä¸€è°ƒåº¦ï¼Œ<code>keeper</code>é€šè¿‡è°ƒç”¨å®ä¾‹ä¸‹é¢çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ¥å®ç°ç¼“å­˜ç”Ÿå‘½å‘¨æœŸåŠŸèƒ½çš„ã€‚</p> <h1 id="äº”-é«˜é˜¶ç»„ä»¶çš„æ³¨æ„äº‹é¡¹"><a href="#äº”-é«˜é˜¶ç»„ä»¶çš„æ³¨æ„äº‹é¡¹" class="header-anchor">#</a> äº” é«˜é˜¶ç»„ä»¶çš„æ³¨æ„äº‹é¡¹</h1> <h2 id="_1-è°¨æ…ä¿®æ”¹åŸå‹é“¾"><a href="#_1-è°¨æ…ä¿®æ”¹åŸå‹é“¾" class="header-anchor">#</a> 1 è°¨æ…ä¿®æ”¹åŸå‹é“¾</h2> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC (Component){  const proDidMount = Component.prototype.componentDidMount   Component.prototype.componentDidMount = function(){     console.log('åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼šcomponentDidMount')     proDidMount.call(this)  }  return  Component}
</code></pre></div><p>è¿™æ ·åšä¼šäº§ç”Ÿä¸€äº›ä¸è‰¯åæœã€‚æ¯”å¦‚å¦‚æœä½ å†ç”¨å¦ä¸€ä¸ªåŒæ ·ä¼šä¿®æ”¹ <code>componentDidMount</code> çš„ <code>HOC</code> å¢å¼ºå®ƒï¼Œé‚£ä¹ˆå‰é¢çš„ <code>HOC</code> å°±ä¼šå¤±æ•ˆï¼åŒæ—¶ï¼Œè¿™ä¸ª <code>HOC</code> ä¹Ÿæ— æ³•åº”ç”¨äºæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„å‡½æ•°ç»„ä»¶ã€‚</p> <h2 id="_2-ç»§æ‰¿é™æ€å±æ€§"><a href="#_2-ç»§æ‰¿é™æ€å±æ€§" class="header-anchor">#</a> 2 ç»§æ‰¿é™æ€å±æ€§</h2> <p>åœ¨ç”¨å±æ€§ä»£ç†çš„æ–¹å¼ç¼–å†™<code>HOC</code>çš„æ—¶å€™ï¼Œè¦æ³¨æ„çš„æ˜¯å°±æ˜¯ï¼Œé™æ€å±æ€§ä¸¢å¤±çš„é—®é¢˜ï¼Œå‰é¢æåˆ°äº†ï¼Œå¦‚æœä¸åšå¤„ç†ï¼Œé™æ€æ–¹æ³•å°±ä¼šå…¨éƒ¨ä¸¢å¤±ã€‚</p> <h3 id="æ‰‹åŠ¨ç»§æ‰¿"><a href="#æ‰‹åŠ¨ç»§æ‰¿" class="header-anchor">#</a> æ‰‹åŠ¨ç»§æ‰¿</h3> <p>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å°†åŸå§‹ç»„ä»¶çš„é™æ€æ–¹æ³•<code>copy</code>åˆ° <code>hoc</code>ç»„ä»¶ä¸Šæ¥ï¼Œä½†å‰ææ˜¯å¿…é¡»å‡†ç¡®çŸ¥é“åº”è¯¥æ‹·è´å“ªäº›æ–¹æ³•ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>function HOC(Component) {  class WrappedComponent extends React.Component {      /*...*/  }  // å¿…é¡»å‡†ç¡®çŸ¥é“åº”è¯¥æ‹·è´å“ªäº›æ–¹æ³•   WrappedComponent.staticMethod = Component.staticMethod  return WrappedComponent}
</code></pre></div><h3 id="å¼•å…¥ç¬¬ä¸‰æ–¹åº“"><a href="#å¼•å…¥ç¬¬ä¸‰æ–¹åº“" class="header-anchor">#</a> å¼•å…¥ç¬¬ä¸‰æ–¹åº“</h3> <p>è¿™æ ·æ¯ä¸ªé™æ€æ–¹æ³•éƒ½ç»‘å®šä¼šå¾ˆç´¯ï¼Œå°¤å…¶å¯¹äºå¼€æºçš„<code>hoc</code>ï¼Œ<strong>å¯¹åŸç”Ÿç»„ä»¶çš„é™æ€æ–¹æ³•æ˜¯æœªçŸ¥çš„</strong>,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>hoist-non-react-statics</code> è‡ªåŠ¨æ‹·è´æ‰€æœ‰çš„é™æ€æ–¹æ³•:</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>import hoistNonReactStatic from 'hoist-non-react-statics'function HOC(Component) {  class WrappedComponent extends React.Component {      /*...*/  }  hoistNonReactStatic(WrappedComponent,Component)  return WrappedComponent}
</code></pre></div><h2 id="_3-è·¨å±‚çº§æ•è·ref"><a href="#_3-è·¨å±‚çº§æ•è·ref" class="header-anchor">#</a> 3 è·¨å±‚çº§æ•è·ref</h2> <p>é«˜é˜¶ç»„ä»¶çš„çº¦å®šæ˜¯å°†æ‰€æœ‰ <code>props</code> ä¼ é€’ç»™è¢«åŒ…è£…ç»„ä»¶ï¼Œä½†è¿™å¯¹äº <code>refs</code> å¹¶ä¸é€‚ç”¨ã€‚é‚£æ˜¯å› ä¸º <code>ref</code> å®é™…ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ª <code>prop</code> - å°±åƒ <code>key</code> ä¸€æ ·ï¼Œå®ƒæ˜¯ç”± <code>React</code> ä¸“é—¨å¤„ç†çš„ã€‚å¦‚æœå°† <code>ref</code> æ·»åŠ åˆ° <code>HOC</code> çš„è¿”å›ç»„ä»¶ä¸­ï¼Œåˆ™ <code>ref</code> å¼•ç”¨æŒ‡å‘å®¹å™¨ç»„ä»¶ï¼Œè€Œä¸æ˜¯è¢«åŒ…è£…ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>forwardRef</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>/** *  * @param {*} Component åŸå§‹ç»„ä»¶ * @param {*} isRef  æ˜¯å¦å¼€å¯refæ¨¡å¼ */function HOC(Component,isRef){  class Wrap extends React.Component{     render(){        const { forwardedRef ,...otherprops  } = this.props        return &lt;Component ref={forwardedRef}  {...otherprops}  /&gt;     }  }    if(isRef){      return  React.forwardRef((props,ref)=&gt; &lt;Wrap forwardedRef={ref} {...props} /&gt; )    }    return Wrap}
class Index extends React.Component{  componentDidMount(){      console.log(666)  }  render(){    return &lt;div&gt;hello,world&lt;/div&gt;  }}
const HocIndex =  HOC(Index,true)
export default ()=&gt;{  const node = useRef(null)  useEffect(()=&gt;{     /* å°±å¯ä»¥è·¨å±‚çº§ï¼Œæ•è·åˆ° Index ç»„ä»¶çš„å®ä¾‹äº† */     console.log(node.current.componentDidMount)  },[])  return &lt;div&gt;&lt;HocIndex ref={node}  /&gt;&lt;/div&gt;}
</code></pre></div><p><strong>æ‰“å°ç»“æœï¼š</strong></p> <p><img src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="å›¾ç‰‡"></p> <p>å¦‚ä¸Šå°±è§£å†³äº†,<code>HOC</code>è·¨å±‚çº§æ•è·<code>ref</code>çš„é—®é¢˜ã€‚</p> <h2 id="_4-renderä¸­ä¸è¦å£°æ˜hoc"><a href="#_4-renderä¸­ä¸è¦å£°æ˜hoc" class="header-anchor">#</a> 4 renderä¸­ä¸è¦å£°æ˜HOC</h2> <p>ğŸ™…é”™è¯¯å†™æ³•ï¼š</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>class Index extends React.Component{  render(){     const WrapHome = HOC(Home)     return &lt;WrapHome /&gt;  }}
</code></pre></div><p>å¦‚æœè¿™ä¹ˆå†™ï¼Œä¼šé€ æˆä¸€ä¸ªæå¤§çš„é—®é¢˜ï¼Œå› ä¸ºæ¯ä¸€æ¬¡<code>HOC</code>éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„<code>WrapHome</code>,<code>react diff</code>ä¼šåˆ¤å®šä¸¤æ¬¡<strong>ä¸æ˜¯åŒä¸€ä¸ªç»„ä»¶</strong>ï¼Œé‚£ä¹ˆæ¯æ¬¡<code>Index</code> ç»„ä»¶ <code>render</code>è§¦å‘ï¼Œ<code>WrapHome</code>ï¼Œä¼šé‡æ–°æŒ‚è½½ï¼ŒçŠ¶æ€ä¼š<strong>å…¨éƒ½ä¸¢å¤±</strong>ã€‚å¦‚æœæƒ³è¦åŠ¨æ€ç»‘å®š<code>HOC</code>,è¯·å‚è€ƒå¦‚ä¸‹æ–¹å¼ã€‚</p> <p>ğŸ™†æ­£ç¡®å†™æ³•ï¼š</p> <ul><li></li> <li></li> <li></li> <li></li> <li></li> <li></li></ul> <div class="language- extra-class"><pre class="language-text"><code>const WrapHome = HOC(Home)class index extends React.Component{  render(){     return &lt;WrapHome /&gt;  }}
</code></pre></div><h1 id="å…­-æ€»ç»“"><a href="#å…­-æ€»ç»“" class="header-anchor">#</a> å…­ æ€»ç»“</h1> <p>æœ¬æ–‡ä»é«˜é˜¶ç»„ä»¶åŠŸèƒ½ä¸ºåˆ‡å…¥ç‚¹ï¼Œä»‹ç»äºŒç§ä¸åŒçš„é«˜é˜¶ç»„ä»¶å¦‚ä½•ç¼–å†™ï¼Œåº”ç”¨åœºæ™¯ï¼Œä»¥åŠå®è·µã€‚æ¶µç›–äº†å¤§éƒ¨åˆ†è€³ç†Ÿèƒ½è¯¦çš„å¼€æºé«˜é˜¶ç»„ä»¶çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¯å‘ï¼Œæœ€å¥½è¿˜æ˜¯æŒ‰ç…§æ–‡ç« ä¸­çš„<code>demo</code>ï¼Œè·Ÿç€æ•²ä¸€éï¼ŒåŠ æ·±å°è±¡ï¼ŒçŸ¥é“ä»€ä¹ˆåœºæ™¯ç”¨é«˜é˜¶ç»„ä»¶ï¼Œæ€ä¹ˆç”¨é«˜é˜¶ç»„ä»¶ã€‚</p> <p><code>å®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†</code>ï¼Œå¸Œæœ›å¤§å®¶èƒ½æŠŠé«˜é˜¶ç»„ä»¶<code>ç </code>èµ·æ¥ï¼Œç”¨èµ·æ¥ã€‚</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/24/2022, 11:56:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/advanced/Renderå¦‚ä½•å¼ºåˆ¶å®ƒ.html" class="prev">
        ä»€ä¹ˆæ˜¯ React ä¸­çš„ Render ä»¥åŠå¦‚ä½•å¼ºåˆ¶å®ƒï¼Ÿ
      </a></span> <span class="next"><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-1.html">
        ä»mixinåˆ°hocå†åˆ°hook-1
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c06c5691.js" defer></script><script src="/assets/js/2.e21ead49.js" defer></script><script src="/assets/js/10.b9a4c71a.js" defer></script>
  </body>
</html>
