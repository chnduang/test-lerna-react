<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä» mixin åˆ° hoc å†åˆ° hook-3 | duangdongçš„react</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?0088ce24040b03f2947322ab31d23414";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>
    <script>
  var _hmt = _hmt || [];
  _hmt.push(['_requirePlugin', 'UrlChangeTracker', {
    shouldTrackUrlChange: function (newPath, oldPath) {
      newPath = newPath.split('#')[0];
      oldPath = oldPath.split('#')[0];
      return newPath != oldPath;
    }}
  ]);
  </script>
    <meta name="description" content="reactç›¸å…³çŸ¥è¯†å½’çº³æ€»ç»“">
    <meta name="keywords" content="react,reactè¿›é˜¶,reactæ€§èƒ½ä¼˜åŒ–,react-hooks,reactæºç ">
    
    <link rel="preload" href="/assets/css/0.styles.a427ee9b.css" as="style"><link rel="preload" href="/assets/js/app.c06c5691.js" as="script"><link rel="preload" href="/assets/js/2.e21ead49.js" as="script"><link rel="preload" href="/assets/js/13.87a3c5ce.js" as="script"><link rel="prefetch" href="/assets/js/10.b9a4c71a.js"><link rel="prefetch" href="/assets/js/11.f55d2255.js"><link rel="prefetch" href="/assets/js/12.fe15bcdc.js"><link rel="prefetch" href="/assets/js/14.ebf89fa4.js"><link rel="prefetch" href="/assets/js/15.cda0a8ba.js"><link rel="prefetch" href="/assets/js/16.f9dc23dc.js"><link rel="prefetch" href="/assets/js/17.84340ca0.js"><link rel="prefetch" href="/assets/js/18.bd273a95.js"><link rel="prefetch" href="/assets/js/19.81155919.js"><link rel="prefetch" href="/assets/js/20.9fd76e46.js"><link rel="prefetch" href="/assets/js/21.ace06104.js"><link rel="prefetch" href="/assets/js/22.90ade980.js"><link rel="prefetch" href="/assets/js/23.0666abd7.js"><link rel="prefetch" href="/assets/js/24.a72c373a.js"><link rel="prefetch" href="/assets/js/25.b969cb94.js"><link rel="prefetch" href="/assets/js/26.de056b27.js"><link rel="prefetch" href="/assets/js/27.c42084cb.js"><link rel="prefetch" href="/assets/js/28.4837174d.js"><link rel="prefetch" href="/assets/js/29.ff25f8d5.js"><link rel="prefetch" href="/assets/js/3.860eacbd.js"><link rel="prefetch" href="/assets/js/30.713760c5.js"><link rel="prefetch" href="/assets/js/31.7c617c61.js"><link rel="prefetch" href="/assets/js/32.d175bcfe.js"><link rel="prefetch" href="/assets/js/33.74590403.js"><link rel="prefetch" href="/assets/js/34.83533364.js"><link rel="prefetch" href="/assets/js/35.074e3e13.js"><link rel="prefetch" href="/assets/js/36.1ccfc83b.js"><link rel="prefetch" href="/assets/js/37.a396d472.js"><link rel="prefetch" href="/assets/js/38.db4bd748.js"><link rel="prefetch" href="/assets/js/39.df82dded.js"><link rel="prefetch" href="/assets/js/4.8f6f0475.js"><link rel="prefetch" href="/assets/js/40.c748e8b5.js"><link rel="prefetch" href="/assets/js/5.8b87f02a.js"><link rel="prefetch" href="/assets/js/6.2f86309f.js"><link rel="prefetch" href="/assets/js/7.f1cc41de.js"><link rel="prefetch" href="/assets/js/8.9c653580.js"><link rel="prefetch" href="/assets/js/9.af331656.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a427ee9b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">duangdongçš„react</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fiber/" class="nav-link">
  Fiber
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link router-link-active">
  è¿›é˜¶
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fiber/" class="nav-link">
  Fiber
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link router-link-active">
  è¿›é˜¶
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/advanced/" aria-current="page" class="sidebar-link">è¿›é˜¶</a></li><li><a href="/advanced/Renderå¦‚ä½•å¼ºåˆ¶å®ƒ.html" class="sidebar-link">ä»€ä¹ˆæ˜¯ React ä¸­çš„ Render ä»¥åŠå¦‚ä½•å¼ºåˆ¶å®ƒï¼Ÿ</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>hoc</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced/hoc/ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶HOC.html" class="sidebar-link">ä¸€æ–‡åƒé€Reacté«˜é˜¶ç»„ä»¶HOC</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-1.html" class="sidebar-link">ä»mixinåˆ°hocå†åˆ°hook-1</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-2.html" class="sidebar-link">ä» mixin åˆ° hoc å†åˆ° hook-2</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-3.html" class="active sidebar-link">ä» mixin åˆ° hoc å†åˆ° hook-3</a></li><li><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-4.html" class="sidebar-link">ä» mixin åˆ° hoc å†åˆ° hook-4</a></li><li><a href="/advanced/hoc/è¯´è¯´å¯¹é«˜é˜¶ç»„ä»¶çš„ç†è§£.html" class="sidebar-link">è¯´è¯´å¯¹é«˜é˜¶ç»„ä»¶çš„ç†è§£ï¼Ÿåº”ç”¨åœºæ™¯?</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>keys</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/advanced/react-svelteå…¥é—¨.html" class="sidebar-link">å†™ç»™ React å¼€å‘è€…çœ‹çš„ Svelteå…¥é—¨</a></li><li><a href="/advanced/react16å¸¸è§apiä»¥åŠåŸç†å‰–æ.html" class="sidebar-link">react16å¸¸è§apiä»¥åŠåŸç†å‰–æ</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>setstate</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/advanced/äº”åˆ†é’Ÿå¸¦ä½ æŒæ¡ä¼˜å…ˆé˜Ÿåˆ—.html" class="sidebar-link">äº”åˆ†é’Ÿå¸¦ä½ æŒæ¡ä¼˜å…ˆé˜Ÿåˆ—</a></li><li><a href="/advanced/å‰ç«¯æ¶æ„ä¹‹Reacté¢†åŸŸé©±åŠ¨è®¾è®¡.html" class="sidebar-link">å‰ç«¯æ¶æ„ä¹‹ React é¢†åŸŸé©±åŠ¨è®¾è®¡</a></li><li><a href="/advanced/å­¦å¥½è¿™äº›Reactè®¾è®¡æ¨¡å¼.html" class="sidebar-link">å­¦å¥½è¿™äº›Reactè®¾è®¡æ¨¡å¼-èƒ½è®©ä½ çš„ React é¡¹ç›®é£èµ·æ¥</a></li><li><a href="/advanced/æµ…è°ˆReactä¸­çš„XSSæ”»å‡».html" class="sidebar-link">æµ…è°ˆ React ä¸­çš„ XSS æ”»å‡»</a></li><li><a href="/advanced/é”™è¯¯è¾¹ç•Œ.html" class="sidebar-link">é”™è¯¯è¾¹ç•Œï¼ˆError Boundariesï¼‰</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ä»-mixin-åˆ°-hoc-å†åˆ°-hook-3"><a href="#ä»-mixin-åˆ°-hoc-å†åˆ°-hook-3" class="header-anchor">#</a> ä» mixin åˆ° hoc å†åˆ° hook-3</h1> <h2 id="hoc-çš„å®é™…åº”ç”¨"><a href="#hoc-çš„å®é™…åº”ç”¨" class="header-anchor">#</a> HOC çš„å®é™…åº”ç”¨</h2> <p>ä¸‹é¢æ˜¯ä¸€äº›æˆ‘åœ¨å…¬å¸é¡¹ç›®ä¸­å®é™…å¯¹<code>HOC</code>çš„å®é™…åº”ç”¨åœºæ™¯ï¼Œç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œä»£ç ç»è¿‡å¾ˆå¤šç®€åŒ–ï¼Œå¦‚æœ‰é—®é¢˜æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼š</p> <h3 id="æ—¥å¿—æ‰“ç‚¹"><a href="#æ—¥å¿—æ‰“ç‚¹" class="header-anchor">#</a> æ—¥å¿—æ‰“ç‚¹</h3> <p>å®é™…ä¸Šè¿™å±äºä¸€ç±»æœ€å¸¸è§çš„åº”ç”¨ï¼Œå¤šä¸ªç»„ä»¶æ‹¥æœ‰ç±»ä¼¼çš„é€»è¾‘ï¼Œæˆ‘ä»¬è¦å¯¹é‡å¤çš„é€»è¾‘è¿›è¡Œå¤ç”¨ï¼Œ å®˜æ–¹æ–‡æ¡£ä¸­<code>CommentList</code>çš„ç¤ºä¾‹ä¹Ÿæ˜¯è§£å†³äº†ä»£ç å¤ç”¨é—®é¢˜ï¼Œå†™çš„å¾ˆè¯¦ç»†ï¼Œæœ‰å…´è¶£å¯ä»¥ ğŸ‘‡<a href="https://react.docschina.org/docs/higher-order-components.html#%E4%BD%BF%E7%94%A8%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%EF%BC%88hoc%EF%BC%89%E8%A7%A3%E5%86%B3%E6%A8%AA%E5%88%87%E5%85%B3%E6%B3%A8%E7%82%B9" target="_blank" rel="noopener noreferrer">ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰è§£å†³æ¨ªåˆ‡å…³æ³¨ç‚¹<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ã€‚</p> <p>æŸäº›é¡µé¢éœ€è¦è®°å½•ç”¨æˆ·è¡Œä¸ºï¼Œæ€§èƒ½æŒ‡æ ‡ç­‰ç­‰ï¼Œé€šè¿‡é«˜é˜¶ç»„ä»¶åšè¿™äº›äº‹æƒ…å¯ä»¥çœå»å¾ˆå¤šé‡å¤ä»£ç ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">logHoc</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>WrappedComponent<span class="token punctuation">.</span>dispalyName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> æ¸²æŸ“æ—¶é—´ï¼š</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>end <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ms</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">è¿›å…¥</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>WrappedComponent<span class="token punctuation">.</span>dispalyName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">componentWillUnmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>user<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">é€€å‡º</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>WrappedComponent<span class="token punctuation">.</span>dispalyName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å¯ç”¨ã€æƒé™æ§åˆ¶"><a href="#å¯ç”¨ã€æƒé™æ§åˆ¶" class="header-anchor">#</a> å¯ç”¨ã€æƒé™æ§åˆ¶</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">auth</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> visible<span class="token punctuation">,</span> auth<span class="token punctuation">,</span> display <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>visible <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">||</span> <span class="token punctuation">(</span>auth <span class="token operator">&amp;&amp;</span> authList<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>auth<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> display<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>authList</code>æ˜¯æˆ‘ä»¬åœ¨è¿›å…¥ç¨‹åºæ—¶å‘åç«¯è¯·æ±‚çš„æ‰€æœ‰æƒé™åˆ—è¡¨ï¼Œå½“ç»„ä»¶æ‰€éœ€è¦çš„æƒé™ä¸åˆ—è¡¨ä¸­ï¼Œæˆ–è€…è®¾ç½®çš„ <code>visible</code>æ˜¯<code>false</code>ï¼Œæˆ‘ä»¬å°†å…¶æ˜¾ç¤ºä¸ºä¼ å…¥çš„ç»„ä»¶æ ·å¼ï¼Œæˆ–è€…<code>null</code>ã€‚æˆ‘ä»¬å¯ä»¥å°†ä»»ä½•éœ€è¦è¿›è¡Œæƒé™æ ¡éªŒçš„ç»„ä»¶åº”ç”¨<code>HOC</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>  @auth
  <span class="token keyword">class</span> <span class="token class-name">Input</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token operator">...</span>  <span class="token punctuation">}</span>
  @auth
  <span class="token keyword">class</span> <span class="token class-name">Button</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>  <span class="token operator">...</span>  <span class="token punctuation">}</span>

  <span class="token operator">&lt;</span>Button auth<span class="token operator">=</span><span class="token string">&quot;user/addUser&quot;</span><span class="token operator">&gt;</span>æ·»åŠ ç”¨æˆ·<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>Input auth<span class="token operator">=</span><span class="token string">&quot;user/search&quot;</span> visible<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span> <span class="token operator">&gt;</span>æ·»åŠ ç”¨æˆ·<span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span>
</code></pre></div><h3 id="åŒå‘ç»‘å®š"><a href="#åŒå‘ç»‘å®š" class="header-anchor">#</a> åŒå‘ç»‘å®š</h3> <p>åœ¨<code>vue</code>ä¸­ï¼Œç»‘å®šä¸€ä¸ªå˜é‡åå¯å®ç°åŒå‘æ•°æ®ç»‘å®šï¼Œå³è¡¨å•ä¸­çš„å€¼æ”¹å˜åç»‘å®šçš„å˜é‡ä¹Ÿä¼šè‡ªåŠ¨æ”¹å˜ã€‚è€Œ<code>React</code>ä¸­æ²¡æœ‰åšè¿™æ ·çš„å¤„ç†ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¡¨å•å…ƒç´ éƒ½æ˜¯<code>éå—æ§ç»„ä»¶</code>ã€‚ç»™è¡¨å•å…ƒç´ ç»‘å®šä¸€ä¸ªçŠ¶æ€åï¼Œå¾€å¾€éœ€è¦æ‰‹åŠ¨ä¹¦å†™<code>onChange</code>æ–¹æ³•æ¥å°†å…¶æ”¹å†™ä¸º<code>å—æ§ç»„ä»¶</code>ï¼Œåœ¨è¡¨å•å…ƒç´ éå¸¸å¤šçš„æƒ…å†µä¸‹è¿™äº›é‡å¤æ“ä½œæ˜¯éå¸¸ç—›è‹¦çš„ã€‚</p> <p>æˆ‘ä»¬å¯ä»¥å€ŸåŠ©é«˜é˜¶ç»„ä»¶æ¥å®ç°ä¸€ä¸ªç®€å•çš„åŒå‘ç»‘å®šï¼Œä»£ç ç•¥é•¿ï¼Œå¯ä»¥ç»“åˆä¸‹é¢çš„æ€ç»´å¯¼å›¾è¿›è¡Œç†è§£ã€‚</p> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc4.png" alt="image"></p> <p>é¦–å…ˆæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ª<code>Form</code>ç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨äºåŒ…è£¹æ‰€æœ‰éœ€è¦åŒ…è£¹çš„è¡¨å•ç»„ä»¶ï¼Œé€šè¿‡<code>contex</code>å‘å­ç»„ä»¶æš´éœ²ä¸¤ä¸ªå±æ€§ï¼š</p> <ul><li><code>model</code>ï¼šå½“å‰<code>Form</code>ç®¡æ§çš„æ‰€æœ‰æ•°æ®ï¼Œç”±è¡¨å•<code>name</code>å’Œ<code>value</code>ç»„æˆï¼Œå¦‚<code>{name:'ConardLi',pwd:'123'}</code>ã€‚<code>model</code>å¯ç”±å¤–éƒ¨ä¼ å…¥ï¼Œä¹Ÿå¯è‡ªè¡Œç®¡æ§ã€‚</li> <li><code>changeModel</code>ï¼šæ”¹å˜<code>model</code>ä¸­æŸä¸ª<code>name</code>çš„å€¼ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Form</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> childContextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">model</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
    <span class="token literal-property property">changeModel</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">model</span><span class="token operator">:</span> props<span class="token punctuation">.</span>model <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">componentWillReceiveProps</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextProps<span class="token punctuation">.</span>model<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">model</span><span class="token operator">:</span> nextProps<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">changeModel</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>model<span class="token punctuation">,</span> <span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">getChildContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">changeModel</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>changeModel<span class="token punctuation">,</span>
      <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>model <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>model<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">onSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onSubmit<span class="token punctuation">}</span><span class="token operator">&gt;</span>æäº¤<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸‹é¢å®šä¹‰ç”¨äºåŒå‘ç»‘å®šçš„<code>HOC</code>ï¼Œå…¶ä»£ç†äº†è¡¨å•çš„<code>onChange</code>å±æ€§å’Œ<code>value</code>å±æ€§ï¼š</p> <ul><li>å‘ç”Ÿ<code>onChange</code>äº‹ä»¶æ—¶è°ƒç”¨ä¸Šå±‚<code>Form</code>çš„<code>changeModel</code>æ–¹æ³•æ¥æ”¹å˜<code>context</code>ä¸­çš„<code>model</code>ã€‚</li> <li>åœ¨æ¸²æŸ“æ—¶å°†<code>value</code>æ”¹ä¸ºä»<code>context</code>ä¸­å–å‡ºçš„å€¼ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">proxyHoc</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">model</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
      <span class="token literal-property property">changeModel</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> changeModel <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> onChange <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> v_model <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token function">changeModel</span><span class="token punctuation">(</span>v_model<span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> onChange <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">onChange</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> model <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> v_model <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>WrappedComponent
          <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span>
          value<span class="token operator">=</span><span class="token punctuation">{</span>model<span class="token punctuation">[</span>v_model<span class="token punctuation">]</span><span class="token punctuation">}</span>
          onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@proxyHoc
<span class="token keyword">class</span> <span class="token class-name">Input</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢çš„ä»£ç åªæ˜¯ç®€ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œé™¤äº†<code>input</code>ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†<code>HOC</code>åº”ç”¨åœ¨<code>select</code>ç­‰å…¶ä»–è¡¨å•ç»„ä»¶ï¼Œç”šè‡³è¿˜å¯ä»¥å°†ä¸Šé¢çš„<code>HOC</code>å…¼å®¹åˆ°<code>spanã€table</code>ç­‰å±•ç¤ºç»„ä»¶ï¼Œè¿™æ ·åšå¯ä»¥å¤§å¤§ç®€åŒ–ä»£ç ï¼Œè®©æˆ‘ä»¬çœå»äº†å¾ˆå¤šçŠ¶æ€ç®¡ç†çš„å·¥ä½œï¼Œä½¿ç”¨å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Form<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Input v_model<span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Input v_model<span class="token operator">=</span><span class="token string">&quot;pwd&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Form<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="è¡¨å•æ ¡éªŒ"><a href="#è¡¨å•æ ¡éªŒ" class="header-anchor">#</a> è¡¨å•æ ¡éªŒ</h3> <p>åŸºäºä¸Šé¢çš„åŒå‘ç»‘å®šçš„ä¾‹å­ï¼Œæˆ‘ä»¬å†æ¥ä¸€ä¸ªè¡¨å•éªŒè¯å™¨ï¼Œè¡¨å•éªŒè¯å™¨å¯ä»¥åŒ…å«éªŒè¯å‡½æ•°ä»¥åŠæç¤ºä¿¡æ¯ï¼Œå½“éªŒè¯ä¸é€šè¿‡æ—¶ï¼Œå±•ç¤ºé”™è¯¯ä¿¡æ¯ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">validateHoc</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function-variable function">onChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> validator <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>validator <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> validator<span class="token punctuation">.</span>func <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>validator<span class="token punctuation">.</span><span class="token function">func</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> validator<span class="token punctuation">.</span>msg <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>WrappedComponent onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>onChange<span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>error <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> validatorName <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">func</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'è¯·è¾“å…¥æ•°å­—'</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> validatorPwd <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">func</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> val <span class="token operator">&amp;&amp;</span> val<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">6</span><span class="token punctuation">,</span>
  <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'å¯†ç å¿…é¡»å¤§äº6ä½'</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span>HOCInput validator<span class="token operator">=</span><span class="token punctuation">{</span>validatorName<span class="token punctuation">}</span> v_model<span class="token operator">=</span><span class="token string">&quot;name&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>HOCInput<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>HOCInput validator<span class="token operator">=</span><span class="token punctuation">{</span>validatorPwd<span class="token punctuation">}</span> v_model<span class="token operator">=</span><span class="token string">&quot;pwd&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>HOCInput<span class="token operator">&gt;</span>
</code></pre></div><p>å½“ç„¶ï¼Œè¿˜å¯ä»¥åœ¨<code>Form</code>æäº¤çš„æ—¶å€™åˆ¤æ–­æ‰€æœ‰éªŒè¯å™¨æ˜¯å¦é€šè¿‡ï¼ŒéªŒè¯å™¨ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæ•°ç»„ç­‰ç­‰ï¼Œç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œä»£ç è¢«ç®€åŒ–äº†å¾ˆå¤šï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå·±å®ç°ã€‚</p> <h2 id="redux-çš„-connect"><a href="#redux-çš„-connect" class="header-anchor">#</a> Redux çš„ connect</h2> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc11.png" alt="image"></p> <p>redux ä¸­çš„<code>connect</code>ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ª<code>HOC</code>ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆçš„<code>connect</code>å®ç°ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token parameter">WrappedComponent</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">Connect</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> contextTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">store</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>object<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">allProps</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">componentWillMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_updateProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">_updateProps</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> store <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">;</span>
      <span class="token keyword">let</span> stateProps <span class="token operator">=</span> mapStateToProps
        <span class="token operator">?</span> <span class="token function">mapStateToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> dispatchProps <span class="token operator">=</span> mapDispatchToProps
        <span class="token operator">?</span> <span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span>
        <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">allProps</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token operator">...</span>stateProps<span class="token punctuation">,</span>
          <span class="token operator">...</span>dispatchProps<span class="token punctuation">,</span>
          <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>allProps<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> Connect<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>ä»£ç éå¸¸æ¸…æ™°ï¼Œ<code>connect</code>å‡½æ•°å…¶å®å°±åšäº†ä¸€ä»¶äº‹ï¼Œå°†<code>mapStateToProps</code>å’Œ<code>mapDispatchToProps</code>åˆ†åˆ«è§£æ„åä¼ ç»™åŸç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨åŸç»„ä»¶å†…å°±å¯ä»¥ç›´æ¥ç”¨<code>props</code>è·å–<code>state</code>ä»¥åŠ<code>dispatch</code>å‡½æ•°äº†ã€‚</p> <h2 id="ä½¿ç”¨-hoc-çš„æ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨-hoc-çš„æ³¨æ„äº‹é¡¹" class="header-anchor">#</a> ä½¿ç”¨ HOC çš„æ³¨æ„äº‹é¡¹</h2> <h3 id="å‘Šè¯«-é™æ€å±æ€§æ‹·è´"><a href="#å‘Šè¯«-é™æ€å±æ€§æ‹·è´" class="header-anchor">#</a> å‘Šè¯«â€”é™æ€å±æ€§æ‹·è´</h3> <p>å½“æˆ‘ä»¬åº”ç”¨<code>HOC</code>å»å¢å¼ºå¦ä¸€ä¸ªç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬å®é™…ä½¿ç”¨çš„ç»„ä»¶å·²ç»ä¸æ˜¯åŸç»„ä»¶äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‹¿ä¸åˆ°åŸç»„ä»¶çš„ä»»ä½•é™æ€å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>HOC</code>çš„ç»“å°¾æ‰‹åŠ¨æ‹·è´ä»–ä»¬ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">proxyHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  HOCComponent<span class="token punctuation">.</span>staticMethod <span class="token operator">=</span> WrappedComponent<span class="token punctuation">.</span>staticMethod<span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> HOCComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¦‚æœåŸç»„ä»¶æœ‰éå¸¸å¤šçš„é™æ€å±æ€§ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯éå¸¸ç—›è‹¦çš„ï¼Œè€Œä¸”ä½ éœ€è¦å»äº†è§£éœ€è¦å¢å¼ºçš„æ‰€æœ‰ç»„ä»¶çš„é™æ€å±æ€§æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<a href="https://github.com/mridgway/hoist-non-react-statics" target="_blank" rel="noopener noreferrer"><code>hoist-non-react-statics</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬æ‹·è´æ‰€æœ‰é<code>React</code>çš„é™æ€æ–¹æ³•ï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> hoistNonReactStatic <span class="token keyword">from</span> <span class="token string">&quot;hoist-non-react-statics&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">proxyHOC</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">HOCComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">hoistNonReactStatic</span><span class="token punctuation">(</span>HOCComponent<span class="token punctuation">,</span> WrappedComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> HOCComponent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å‘Šè¯«-ä¼ é€’-refs"><a href="#å‘Šè¯«-ä¼ é€’-refs" class="header-anchor">#</a> å‘Šè¯«â€”ä¼ é€’ refs</h3> <p>ä½¿ç”¨é«˜é˜¶ç»„ä»¶åï¼Œè·å–åˆ°çš„<code>ref</code>å®é™…ä¸Šæ˜¯æœ€å¤–å±‚çš„å®¹å™¨ç»„ä»¶ï¼Œè€ŒéåŸç»„ä»¶ï¼Œä½†æ˜¯å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ç”¨åˆ°åŸç»„ä»¶çš„<code>ref</code>ã€‚</p> <p>é«˜é˜¶ç»„ä»¶å¹¶ä¸èƒ½åƒé€ä¼ <code>props</code>é‚£æ ·å°†<code>refs</code>é€ä¼ ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥å®Œæˆ<code>ref</code>çš„ä¼ é€’ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hoc</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function-variable function">getWrappedRef</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>wrappedRef<span class="token punctuation">;</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>WrappedComponent
          ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>wrappedRef <span class="token operator">=</span> ref<span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
@hoc
<span class="token keyword">class</span> <span class="token class-name">Input</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>input<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>input<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Input
        ref<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>inpitRef <span class="token operator">=</span> ref<span class="token punctuation">.</span><span class="token function">getWrappedRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>Input<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>React 16.3</code>ç‰ˆæœ¬æä¾›äº†ä¸€ä¸ª<code>forwardRef API</code>æ¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œ<code>refs</code>ä¼ é€’ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨é«˜é˜¶ç»„ä»¶ä¸Šè·å–çš„<code>ref</code>å°±æ˜¯åŸç»„ä»¶çš„<code>ref</code>äº†ï¼Œè€Œä¸éœ€è¦å†æ‰‹åŠ¨ä¼ é€’ï¼Œå¦‚æœä½ çš„<code>React</code>ç‰ˆæœ¬å¤§äº<code>16.3</code>ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hoc</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">class</span> <span class="token class-name">HOC</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> forwardedRef<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent ref<span class="token operator">=</span><span class="token punctuation">{</span>forwardedRef<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span><span class="token constant">HOC</span> forwardedRef<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="å‘Šè¯«-ä¸è¦åœ¨-render-æ–¹æ³•å†…ä½¿ç”¨é«˜é˜¶ç»„ä»¶"><a href="#å‘Šè¯«-ä¸è¦åœ¨-render-æ–¹æ³•å†…ä½¿ç”¨é«˜é˜¶ç»„ä»¶" class="header-anchor">#</a> å‘Šè¯«â€”ä¸è¦åœ¨ render æ–¹æ³•å†…ä½¿ç”¨é«˜é˜¶ç»„ä»¶</h3> <p><code>React</code> <code>Diff</code>ç®—æ³•çš„åŸåˆ™æ˜¯ï¼š</p> <ul><li>ä½¿ç”¨ç»„ä»¶æ ‡è¯†ç¡®å®šæ˜¯å¸è½½è¿˜æ˜¯æ›´æ–°ç»„ä»¶</li> <li>å¦‚æœç»„ä»¶çš„å’Œå‰ä¸€æ¬¡æ¸²æŸ“æ—¶æ ‡è¯†æ˜¯ç›¸åŒçš„ï¼Œé€’å½’æ›´æ–°å­ç»„ä»¶</li> <li>å¦‚æœæ ‡è¯†ä¸åŒå¸è½½ç»„ä»¶é‡æ–°æŒ‚è½½æ–°ç»„ä»¶</li></ul> <p>æ¯æ¬¡è°ƒç”¨é«˜é˜¶ç»„ä»¶ç”Ÿæˆçš„éƒ½æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç»„ä»¶ï¼Œç»„ä»¶çš„å”¯ä¸€æ ‡è¯†å“åº”çš„ä¹Ÿä¼šæ”¹å˜ï¼Œå¦‚æœåœ¨<code>render</code>æ–¹æ³•è°ƒç”¨äº†é«˜é˜¶ç»„ä»¶ï¼Œè¿™ä¼šå¯¼è‡´ç»„ä»¶æ¯æ¬¡éƒ½ä¼šè¢«å¸è½½åé‡æ–°æŒ‚è½½ã€‚</p> <h3 id="çº¦å®š-ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶"><a href="#çº¦å®š-ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶" class="header-anchor">#</a> çº¦å®š-ä¸è¦æ”¹å˜åŸå§‹ç»„ä»¶</h3> <p>å®˜æ–¹æ–‡æ¡£å¯¹é«˜é˜¶ç»„ä»¶çš„è¯´æ˜ï¼š</p> <blockquote><p>é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ã€‚</p></blockquote> <p>æˆ‘ä»¬å†æ¥çœ‹çœ‹çº¯å‡½æ•°çš„å®šä¹‰ï¼š</p> <blockquote><p>å¦‚æœå‡½æ•°çš„è°ƒç”¨å‚æ•°ç›¸åŒï¼Œåˆ™æ°¸è¿œè¿”å›ç›¸åŒçš„ç»“æœã€‚å®ƒä¸ä¾èµ–äºç¨‹åºæ‰§è¡ŒæœŸé—´å‡½æ•°å¤–éƒ¨ä»»ä½•çŠ¶æ€æˆ–æ•°æ®çš„å˜åŒ–ï¼Œå¿…é¡»åªä¾èµ–äºå…¶è¾“å…¥å‚æ•°ã€‚ è¯¥å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼Œè¾“å…¥å’Œè¾“å‡ºè®¾å¤‡æˆ–æ•°æ®çªå˜ã€‚</p></blockquote> <p>å¦‚æœæˆ‘ä»¬åœ¨é«˜é˜¶ç»„ä»¶å¯¹åŸç»„ä»¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">InputComponent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">componentWillReceiveProps</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nextProps</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre></div><p>è¿™æ ·å°±ç ´åäº†æˆ‘ä»¬å¯¹é«˜é˜¶ç»„ä»¶çš„çº¦å®šï¼ŒåŒæ—¶ä¹Ÿæ”¹å˜äº†ä½¿ç”¨é«˜é˜¶ç»„ä»¶çš„åˆè¡·ï¼šæˆ‘ä»¬ä½¿ç”¨é«˜é˜¶ç»„ä»¶æ˜¯ä¸ºäº†<code>å¢å¼º</code>è€Œé<code>æ”¹å˜</code>åŸç»„ä»¶ã€‚</p> <h3 id="çº¦å®š-é€ä¼ ä¸ç›¸å…³çš„-props"><a href="#çº¦å®š-é€ä¼ ä¸ç›¸å…³çš„-props" class="header-anchor">#</a> çº¦å®š-é€ä¼ ä¸ç›¸å…³çš„ props</h3> <p>ä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä»£ç†æ‰€æœ‰çš„<code>props</code>ï¼Œä½†å¾€å¾€ç‰¹å®šçš„<code>HOC</code>åªä¼šç”¨åˆ°å…¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ª<code>props</code>ã€‚æˆ‘ä»¬éœ€è¦æŠŠå…¶ä»–ä¸ç›¸å…³çš„<code>props</code>é€ä¼ ç»™åŸç»„ä»¶ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">visible</span><span class="token punctuation">(</span><span class="token parameter">WrappedComponent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> Component <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> visible<span class="token punctuation">,</span> <span class="token operator">...</span>props <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>visible <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>WrappedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬åªä½¿ç”¨<code>visible</code>å±æ€§æ¥æ§åˆ¶ç»„ä»¶çš„æ˜¾ç¤ºå¯éšè—ï¼ŒæŠŠå…¶ä»–<code>props</code>é€ä¼ ä¸‹å»ã€‚</p> <h3 id="çº¦å®š-displayname"><a href="#çº¦å®š-displayname" class="header-anchor">#</a> çº¦å®š-displayName</h3> <p>åœ¨ä½¿ç”¨<code>React Developer Tools</code>è¿›è¡Œè°ƒè¯•æ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†<code>HOC</code>ï¼Œè°ƒè¯•ç•Œé¢å¯èƒ½å˜å¾—éå¸¸éš¾ä»¥é˜…è¯»ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code>@visible
<span class="token keyword">class</span> <span class="token class-name">Show</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ ‡ç­¾<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
@visible
<span class="token keyword">class</span> <span class="token class-name">Title</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>æˆ‘æ˜¯ä¸€ä¸ªæ ‡é¢˜<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc5.png" alt="image"></p> <p>ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¸º<code>HOC</code>æŒ‡å®šä¸€ä¸ª<code>displayName</code>ï¼Œå®˜æ–¹æ¨èä½¿ç”¨<code>HOCName(WrappedComponentName)</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">static</span> displayName <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Visible(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>WrappedComponent<span class="token punctuation">.</span>displayName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
</code></pre></div><p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc6.png" alt="image"></p> <p>è¿™ä¸ªçº¦å®šå¸®åŠ©ç¡®ä¿é«˜é˜¶ç»„ä»¶æœ€å¤§ç¨‹åº¦çš„çµæ´»æ€§å’Œå¯é‡ç”¨æ€§ã€‚</p> <h2 id="ä½¿ç”¨-hoc-çš„åŠ¨æœº"><a href="#ä½¿ç”¨-hoc-çš„åŠ¨æœº" class="header-anchor">#</a> ä½¿ç”¨ HOC çš„åŠ¨æœº</h2> <p>å›é¡¾ä¸‹ä¸Šæ–‡æåˆ°çš„ <code>Mixin</code> å¸¦æ¥çš„é£é™©ï¼š</p> <ul><li><code>Mixin</code> å¯èƒ½ä¼šç›¸äº’ä¾èµ–ï¼Œç›¸äº’è€¦åˆï¼Œä¸åˆ©äºä»£ç ç»´æŠ¤</li> <li>ä¸åŒçš„<code>Mixin</code>ä¸­çš„æ–¹æ³•å¯èƒ½ä¼šç›¸äº’å†²çª</li> <li><code>Mixin</code>éå¸¸å¤šæ—¶ï¼Œç»„ä»¶æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ï¼Œç”šè‡³è¿˜è¦ä¸ºå…¶åšç›¸å…³å¤„ç†ï¼Œè¿™æ ·ä¼šç»™ä»£ç é€ æˆæ»šé›ªçƒå¼çš„å¤æ‚æ€§</li></ul> <p><img src="https://lsqimg-1257917459.cos-website.ap-beijing.myqcloud.com/blog/hoc7.png" alt="image"></p> <p>è€Œ<code>HOC</code>çš„å‡ºç°å¯ä»¥è§£å†³è¿™äº›é—®é¢˜ï¼š</p> <ul><li>é«˜é˜¶ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ²¡æœ‰å‰¯ä½œç”¨çš„çº¯å‡½æ•°ï¼Œå„ä¸ªé«˜é˜¶ç»„ä»¶ä¸ä¼šäº’ç›¸ä¾èµ–è€¦åˆ</li> <li>é«˜é˜¶ç»„ä»¶ä¹Ÿæœ‰å¯èƒ½é€ æˆå†²çªï¼Œä½†æˆ‘ä»¬å¯ä»¥åœ¨éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹é¿å…è¿™äº›è¡Œä¸º</li> <li>é«˜é˜¶ç»„ä»¶å¹¶ä¸å…³å¿ƒæ•°æ®ä½¿ç”¨çš„æ–¹å¼å’ŒåŸå› ï¼Œè€Œè¢«åŒ…è£¹çš„ç»„ä»¶ä¹Ÿä¸å…³å¿ƒæ•°æ®æ¥è‡ªä½•å¤„ã€‚é«˜é˜¶ç»„ä»¶çš„å¢åŠ ä¸ä¼šä¸ºåŸç»„ä»¶å¢åŠ è´Ÿæ‹…</li></ul> <h2 id="hoc-çš„ç¼ºé™·"><a href="#hoc-çš„ç¼ºé™·" class="header-anchor">#</a> HOC çš„ç¼ºé™·</h2> <ul><li><code>HOC</code>éœ€è¦åœ¨åŸç»„ä»¶ä¸Šè¿›è¡ŒåŒ…è£¹æˆ–è€…åµŒå¥—ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨<code>HOC</code>ï¼Œå°†ä¼šäº§ç”Ÿéå¸¸å¤šçš„åµŒå¥—ï¼Œè¿™è®©è°ƒè¯•å˜å¾—éå¸¸å›°éš¾ã€‚</li> <li><code>HOC</code>å¯ä»¥åŠ«æŒ<code>props</code>ï¼Œåœ¨ä¸éµå®ˆçº¦å®šçš„æƒ…å†µä¸‹ä¹Ÿå¯èƒ½é€ æˆå†²çªã€‚</li></ul> <p>æ–‡ä¸­å¦‚æœ‰é”™è¯¯ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡æ­£ï¼Œè°¢è°¢é˜…è¯»ã€‚</p> <p>Last Updated: 8/4/2019, 10:35:29 AM</p> <p>â† <a href="http://www.conardli.top/blog/article/React%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97/%E4%BB%8EMixin%E5%88%B0HOC%E5%86%8D%E5%88%B0Hook%EF%BC%88%E4%BA%8C%EF%BC%89.html" target="_blank" rel="noopener noreferrer">ä» Mixin åˆ° HOC å†åˆ° Hookï¼ˆäºŒï¼‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><a href="http://www.conardli.top/blog/article/React%E6%B7%B1%E5%85%A5%E7%B3%BB%E5%88%97/%E4%BB%8EMixin%E5%88%B0HOC%E5%86%8D%E5%88%B0Hook%EF%BC%88%E5%9B%9B%EF%BC%89.html" target="_blank" rel="noopener noreferrer">ä» Mixin åˆ° HOC å†åˆ° Hookï¼ˆå››ï¼‰ <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>â†’</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°:</span> <span class="time">5/24/2022, 11:56:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-2.html" class="prev">
        ä» mixin åˆ° hoc å†åˆ° hook-2
      </a></span> <span class="next"><a href="/advanced/hoc/ä»mixinåˆ°hocå†åˆ°hook-4.html">
        ä» mixin åˆ° hoc å†åˆ° hook-4
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c06c5691.js" defer></script><script src="/assets/js/2.e21ead49.js" defer></script><script src="/assets/js/13.87a3c5ce.js" defer></script>
  </body>
</html>
